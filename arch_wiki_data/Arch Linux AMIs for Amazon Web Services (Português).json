{
  "title": "Arch Linux AMIs for Amazon Web Services (Português)",
  "url": "https://wiki.archlinux.org/title/Arch_Linux_AMIs_for_Amazon_Web_Services_(Portugu%C3%AAs)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article is being considered for redirection to Arch Linux AMIs for Amazon Web Services.** This article is being considered for redirection to Arch Linux AMIs for Amazon Web Services.\n\nThis article is being considered for redirection to Arch Linux AMIs for Amazon Web Services.\n\n"
    },
    {
      "title": "AMIs",
      "level": 3,
      "content": "Arch Linux AMIs are listed here: http://arch-ami-list.drzee.net/\n\nAMIs are build twice a month (the 1st and the 15th - 2:00am UTC) and are available for all regions that to do not explicitly require 'Opt-in' - see Region List. If an AMI is needed in a region where its currently not available, an AMI can be copied to that region.\n\nThe AMIs are EBS HVM AMIs and are available with two different kernels:\n\n- std - using the Standard Arch Linux Kernel from the default Arch repositories configured with the necessary modules for EC2 usage. The scheduler and I/O is not optimized for Cloud usage reducing performance.\n- ec2 - using an EC2 optimized kernel of the Standard Arch Linux Kernel created by UplinkLabs and hosted in a dedicated repository: https://arch-linux-ami.s3.amazonaws.com/repo/$arch[link inativo 2022-09-17 ⓘ] (see also https://git.uplinklabs.net/steven/ec2-packages.git)\n\nBoth kernels have been tested on many different EC2 instance types (t2, t3, t3a, m/r/c5, m/r/c6 and advanced hardware with GPUs) and are booting fine.\n\nNote: **ec2** \n\nAMIs with LTS kernels are not build.\n\n"
    },
    {
      "title": "REST API to List AMIs",
      "level": 3,
      "content": "An REST API is available to get a JSON of available AMIs:\n\n- Get all AMIs: https://5nplxwo1k1.execute-api.eu-central-1.amazonaws.com/prod\n- Get list of latest AMI in each region: https://5nplxwo1k1.execute-api.eu-central-1.amazonaws.com/prod/latest (this produces the same list as http://arch-ami-list.drzee.net/ but in JSON)\n- Get all AMIs in region: https://5nplxwo1k1.execute-api.eu-central-1.amazonaws.com/prod/region - replace region with the desired region: eu-north-1, eu-west-1, us-east-1 etc.\n- Get all AMIs in region for CPU architecture: https://5nplxwo1k1.execute-api.eu-central-1.amazonaws.com/prod/region/arch - replace arch with x86_64\n- Get all AMIs in region for CPU architecture and kernel-type: https://5nplxwo1k1.execute-api.eu-central-1.amazonaws.com/prod/region/arch/type - replace type with std or ec2\n- Get Latest AMI in region for in region for CPU architecture and kernel-type: https://5nplxwo1k1.execute-api.eu-central-1.amazonaws.com/prod/region/arch/type/latest - replace region, arch and type\n\n"
    },
    {
      "title": "First Run",
      "level": 3,
      "content": "After booting the AMI it is recommended/required to execute the following steps to initialize pacman and select fast local repositories:\n\n```\n# pacman-key --init\n# pacman-key --populate\n# reflector --country \"ISO 3166-1 Alpha-2 Country Code\" --protocol https,http --score 20 --sort rate --save /etc/pacman.d/mirrorlist\n# pacman -Syu\n```\n\nThe Reflector package is preinstalled in the AMIs.\n\nIt is recommended to set a proper configuration for reflector in /etc/xdg/reflector/reflector.conf and enable the timer services to regularly refresh the mirror list. For details see the Reflector package documentation.\n\nAlternative provide your own mirrorlist and do not use the reflector package.\n\n"
    },
    {
      "title": "Build process",
      "level": 3,
      "content": "The entire build process runs on AWS and is fully automated.\n\nOverall the automated build procedure is managed by a AWS Step Function that is executed at regular intervals using a Amazon EventBridge timed event.\n\nThe step function will initiate the build process and uses a combination of native calls and AWS Lambda functions for more complex elements.\n\nA new set of AMIs is build, by booting an EC2 instance with the previous AMI and using it as the work or build machine. The build machine is bootstrapped with a special build script that largely follows the steps outlined here: http://mathcom.com/arch.aws.ami.html[link inativo 2023-04-22 ⓘ] with some minor modifications, tweaks and additions. Step 7.4 is skipped as we do not need a dedicated firewall.\n\nFollowing the build of the AMI the new AMI is test booted on an EC2 instance to verify that it start up correctly. If successful the AMI is distributed to the regions and registered in a DynamoDB database. The database can be queried using the API REST endpoint. Old AMIs are deleted from the regions and the DynamoDB database.\n\n"
    },
    {
      "title": "Credits",
      "level": 3,
      "content": "Thanks to Steven from UplinkLabs for helping to understand the build process and test the initial quality of the images. Also thanks to Mathcom for the guide[link inativo 2023-04-22 ⓘ], which accelerate putting the basic build process together.\n\nYou may send comments and suggestions (without any promise that they will be looked at) to: arch-ami 'at' drzee.net\n\n"
    },
    {
      "title": "Wishlist",
      "level": 3,
      "content": "- Create official EC2/Cloud optimized kernels in the Standard Arch Linux repositories.\n- Add the AWS CLI v2 to the Standard Arch Linux repositories (v1 is available, but may be discontinued in the future) - Thanks to yan12125 for adding aws-cli-v2AUR\n\n"
    },
    {
      "title": "Building Arch AMIs",
      "level": 2,
      "content": "You can also build your own Arch Linux AMI. Here are some guides:\n\n- linux-ec2AUR[link quebrado: package not found] compiles the Arch Linux kernel for AWS with Xen modules enabled and the XSAVE patch applied. Note that at least some instance types will also work with the stock Arch Linux kernel.\n- Uplink Labs has a manual on the build process.\n- Another tutorial on building your own AMIs can be found at https://gitlab.com/anemos-io/archlinux-ec2\n- Mathcom publishes a detailed guide that uses only core Arch tools, at http://mathcom.com/arch.aws.ami.html[link inativo 2023-04-22 ⓘ]\n\n"
    },
    {
      "title": "AMI Images from Uplink Labs",
      "level": 2,
      "content": "Note: **This article or section is out of date.** This article or section is out of date.\n\nThis article or section is out of date.\n\nUplink Labs creates new images approximately twice a month. Images are being built for a number of regions, and cover the following configurations:\n\n- ebs hvm x86_64 lts\n- s3 hvm x86_64 lts\n- ebs hvm x86_64 stable\n- s3 hvm x86_64 stable\n\nAMI links and more information are available at https://www.uplinklabs.net/projects/arch-linux-on-ec2/ .\n\n"
    }
  ]
}