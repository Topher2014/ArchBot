{
  "title": "Whonix",
  "url": "https://wiki.archlinux.org/title/Whonix",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Whonix is a desktop operating system setup designed for advanced security and privacy. This page describes how an Arch user may use a Whonix Gateway to route all traffic through Tor and receive many other the security benefits from compartmentalization as described below.\n\n"
    },
    {
      "title": "Background on Whonix and Tor",
      "level": 2,
      "content": "The Whonix setup works by compartmentalizing two separate operating systems running inside of two separate virtual machines for greater security, while simultaneously routing all traffic through Tor. This greater security model provides several benefits:\n\n- Only connections through Tor are permitted.\n- Servers can be run, and applications used, anonymously over the internet.\n- DNS leaks are impossible.\n- Malware with root privileges cannot discover the user's real IP address.\n- Threats posed by misbehaving applications and user error are minimized.\n\nThe Whonix wiki provides many specific examples of attacks and software flaws that would normally pose a security and/or privacy problem, but are thwarted by this compartmentalization model. It also describes where this model may still fail so it is an important page to understand.\n\nThe first operating system is \"The Workstation\" and is the OS you perform your normal everyday tasks in. The second is \"The Gateway\" that forces all traffic from the Workstation through Tor while providing the additional security benefits listed above.\n\nThe main Whonix team provides both a Gateway and Workstation running on top of Debian, but Arch users may enjoy using Arch as their main Workstation OS. This page describes how that can to be done.\n\n"
    },
    {
      "title": "Downloading and Installing Whonix Gateway",
      "level": 2,
      "content": "You will not use the Gateway for everyday tasks. It only serves to compartmentalize your Workstation activity from the internet while routing all traffic through Tor.\n\n"
    },
    {
      "title": "Download and install the Whonix Gateway",
      "level": 3,
      "content": "Go to the Whonix VirtualBox page, download the \"Whonix-Gateway\" using one of the download options available, then verify download using one of the methods described on that page. Make sure you also have VirtualBox installed.\n\nNext, import the Whonix-Gateway inside VirtualBox by going to, File > Import Appliance > Whonix-Gateway-<version>.ova, to select the Gateway file just downloaded, then agree to the conditions that describe system requirements and security considerations for using Whonix. It may be helpful to follow the instructions provided on the Whonix download page previously linked . There are also video tutorials available demonstrating this process.\n\nAfter the appliance has been installed, start the Gateway using the start icon.\n\n"
    },
    {
      "title": "Update the Whonix Gateway",
      "level": 3,
      "content": "Before we start Arch, we need to agree to the terms and ensure our Whonix Gateway has all up-to-date security patches. As with importing the appliance above, the terms you must agree to state that you understand the security considerations for running Whonix. After booting up the Gateway agree to these terms, state that you intend on using the stable repository and check \"I am ready to enable TOR\". After this, open a terminal. It will present you with information how to login as either root or a normal user.\n\nLog in inside of this terminal as root and run:\n\n```\n# apt-get update\n```\n\n```\n# apt-get dist-upgrade\n```\n\nThen reboot your Whonix Gateway. After rebooting, open a terminal and this time log in as the normal user. Run the whonix check:\n\n```\n$ whonixcheck\n```\n\nYou may also run nyx:\n\n```\n$ nyx\n```\n\nTo monitor traffic through the gateway.\n\n"
    },
    {
      "title": "Starting Arch inside VirtualBox",
      "level": 3,
      "content": "After you have installed the Whonix-Gateway, and while the Gateway is running, install an instance of Arch inside a separate VirtualBox instance. This is installation process is done as normal, save a few important steps described below, and so one should follow the Installation guide.\n\nAfter creating the Arch instance, and before starting, three important settings need to be selected. First, the network has to point to the running Whonix-Gateway. To do this, select Settings > Network > Attached to > Internal Network > Whonix to select networking through Whonix.\n\nAlso it is best if PAE is enabled so select Settings > System > Processor > Extended Features > Enable PAE/NX.\n\nLastly, select the Arch installation iso you downloaded as your boot storage by going to Settings > Storage > Empty > Optical Drive > Choose Virtual Optical Disk File > archlinux-<version>.iso.\n\nAfter these three settings have been selected, start your Arch VirtualBox instance.\n\n"
    },
    {
      "title": "Connecting to internet during Arch install",
      "level": 3,
      "content": "Note: **This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.** This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nThis article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nWhen connecting a non-preset Workstation to the internet through a Whonix Gateway a few settings must be set manually as described here. The address must be set to 10.152.152.50, the netmask to 255.255.192.0, the gateway to 10.152.152.10 and the nameserver to 10.152.152.10. First, find your interface by running:\n\n```\n# ip a\n```\n\nand look for your ethernet interface. Something like eth0 or enp0s3 is common. Next, deactivate the interface with:\n\n```\n# ip link set interface down\n```\n\nWhere interface is replaced with the name of the interface found above. Next we must configure the static network connection to use the values shown above. Perhaps the easiest way is to copy the static example file:\n\n```\n# cp /etc/netctl/examples/ethernet-static /etc/netctl/whonix\n```\n\nThen replace the contents of that file with:\n\n```\n/etc/netctl/whonix\n```\n\n```\nDescription='Whonix static ethernet connection'\nInterface=enp0s3\nConnection=ethernet\nIP=static\nAddress=('10.152.152.50/18')\nGateway='10.152.152.10'\n```\n\nWhere you should use replace enp0s3 with your interface found above. The /18 is CIDR notation for the above netmask. Then edit /etc/resolv.conf:\n\n```\n/etc/resolv.conf:\n```\n\n```\nnameserver 10.152.152.10\n```\n\nThen edit /etc/environment to prevent potential Tor over Tor problems:\n\n```\n/etc/environment\n```\n\n```\nTOR_SKIP_LAUNCH=1\nTOR_NO_DISPLAY_NETWORK_SETTINGS=1\nTOR_SKIP_CONTROLPORTTEST=1\n```\n\nNow enable the Whonix network connection:\n\n```\n# netctl start whonix\n```\n\nAnd bring your interface back up:\n\n```\n# ip link set interface up\n```\n\nWhere once again interface should be replaced with your interface. Next, confirm that the address 10.152.152.50/18 now shows up under your interface using:\n\n```\n# ip a\n```\n\nIf that checks out, try loading your favorite website such as:\n\n```\n# lynx www.google.com\n```\n\nIf lynx successfully loads a website, then the internet is working through Whonix. Running \"nyx\" inside the Gateway as described above will further confirm that the packets are being sent across the Gateway.\n\n"
    },
    {
      "title": "Mapping files over to your arch-chroot installation environment",
      "level": 3,
      "content": "Once these files have been edited and your internet is working, proceed with the normal Arch installation process. Preparing drives, formatting, etc. Then after you run pacstrap, but before you arch-chroot into your installation chroot, you need to copy the files you created above over.\n\n```\n# cp /etc/netctl/whonix /mnt/etc/netctl/whonix\n```\n\n```\n# cp /etc/resolv.conf /mnt/etc/resolv.conf\n```\n\n```\n# cp /etc/environment /mnt/etc/environment\n```\n\nThen perform the standard arch-chroot and enable your network settings there:\n\n```\n# arch-chroot /mnt\n```\n\n```\n# netctl enable whonix\n```\n\nMake sure you are still connected to the internet, and complete your Arch installation as you would normally. Set up root password, boot loader, etc. It is important that you set your timezone to UTC to match the Gateway. Once the installation is done, reboot.\n\n"
    },
    {
      "title": "Tor Check",
      "level": 3,
      "content": "Once your installation is completed, you have rebooted into Arch, and verified the Whonix Gateway is running, you should be able to access the internet routed through Tor. You can verify traffic is being routed through Tor by installing your favorite web browser and performing the Tor Check. This Tor Check should explicitly say you are using Tor.\n\n"
    },
    {
      "title": "Installing Tor Browser",
      "level": 3,
      "content": "The standard web-browsers one would install in Arch will be forced to route all traffic through Tor and will receive all the benefits of Whonix compartmentalization. This can easily easily be checked by performing the Tor Check as well as other DNS tests described below.\n\nHowever, some might like to use the official Tor browser that comes with extra add-ons and security audits for use with Tor. To install the Tor browser, download the browser from here and extract it into ~/.tb as follows.\n\n```\n$ mkdir -p ~/.tb\n```\n\n```\n$ tar -xf tor-browser-version.tar.xz\n```\n\n```\n$ mv tor-browser_version ~/.tb/tor-browser\n```\n\nAfter the Tor Browser is installed we need to set the configuration to access Tor properly through the Whonix Gateway which is done by editing the following file:\n\n```\n~/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/user.js\n```\n\n```\nuser_pref(\"extensions.torbutton.use_privoxy\", false);\nuser_pref(\"extensions.torbutton.settings_method\", \"custom\");\nuser_pref(\"extensions.torbutton.socks_host\", \"10.152.152.10\");\nuser_pref(\"extensions.torbutton.socks_port\", 9100);\nuser_pref(\"network.proxy.socks\", \"10.152.152.10\");\nuser_pref(\"network.proxy.socks_port\", 9100);\nuser_pref(\"extensions.torbutton.custom.socks_host\", \"10.152.152.10\");\nuser_pref(\"extensions.torbutton.custom.socks_port\", 9100);\nuser_pref(\"extensions.torlauncher.control_host\", \"10.152.152.10\");\nuser_pref(\"extensions.torlauncher.control_port\", 9052);\n```\n\nNow start the Tor Browser.\n\n```\n$ cd ~/.tb/tor-browser\n```\n\n```\n$ ./start-tor-browser.desktop\n```\n\nThe Tor Check should verify both that you are using Tor and the Tor Browser.\n\n"
    },
    {
      "title": "DNS Leak Tests",
      "level": 3,
      "content": "There are several Leak Tests one can preform to verify no traffic is leaking outside of tor:\n\n- DNS Leak Test\n- dnsleak.com\n\nThese are also helpful for verifying that no location or other identifying information is being leaked.\n\nThe Whonix DNS Leak Test Wiki has other helpful leak tests that can be performed in addition to checking websites.\n\n"
    },
    {
      "title": "Familiarize yourself with the strengths and weaknesses of both the Whonix model and Tor",
      "level": 3,
      "content": "As suggested above, familiarize yourself with how the Whonix model works, the specific cases it provides extra security and privacy benefits in comparison with other approaches, how Tor works along with the benefits it provides, and the Tor project suggestions for making Tor work more reliably.\n\nThere is no silver bullet to security and privacy, but understanding these concepts may bring many additional benefits when used properly.\n\n"
    }
  ]
}