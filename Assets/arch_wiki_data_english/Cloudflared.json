{
  "title": "Cloudflared",
  "url": "https://wiki.archlinux.org/title/Cloudflared",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Cloudflared may be used to run a local DNS over HTTPS server (DoH), i.e., a stub resolver.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the cloudflared package.\n\n"
    },
    {
      "title": "Usage",
      "level": 2,
      "content": "Run cloudflared proxy-dns to run a DNS over HTTPS proxy server.\n\nUse the --address and --port options to specify the address and port cloudflared listens to. They default to localhost and 53 respectively. For a list of available command line options, see here.\n\nYou can create a systemd service file, for example:\n\n```\n/etc/systemd/system/cloudflared.service\n```\n\n```\n[Unit]\nDescription=DNS over HTTPS proxy client\nWants=network-online.target nss-lookup.target\nBefore=nss-lookup.target\n\n[Service]\nAmbientCapabilities=CAP_NET_BIND_SERVICE\nCapabilityBoundingSet=CAP_NET_BIND_SERVICE\nDynamicUser=yes\nExecStart=/usr/bin/cloudflared proxy-dns --port 54\n\n[Install]\nWantedBy=multi-user.target\n```\n\nAfter starting the service, you can test that it works by using drill(1) (provided by the ldns package):\n\n```\n$ drill archlinux.org @127.0.0.1 -p 54\n```\n\n"
    },
    {
      "title": "Checking",
      "level": 2,
      "content": "Use 1.1.1.1/help to check if browser is using Cloudflare DoH.\n\n"
    },
    {
      "title": "Endpoints",
      "level": 2,
      "content": "By default cloudflared uses https://1.1.1.1/dns-query and https://1.0.0.1/dns-query, i.e. Cloudflare's DNS over HTTPS servers, as upstream endpoint URLs.\n\nYou can specify different upstream endpoint URLs with the --upstream option.\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Official guide\n- Command line options\n- Running a DNS over HTTPS Client - Cloudflare Resolver\n- Introducing 1.1.1.1 for families\n\n"
    }
  ]
}