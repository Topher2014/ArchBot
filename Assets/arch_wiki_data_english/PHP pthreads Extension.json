{
  "title": "PHP pthreads Extension",
  "url": "https://wiki.archlinux.org/title/PHP_pthreads_Extension",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "If you wish to have POSIX multi-threading you will need the pthreads extension (or the parallel extension for PHP 7.4+). To install the pthreads or parallel extension using pecl you are required to use a compiled version of PHP with the thread safety support flag --enable-maintainer-zts. Currently, the most clean way to do this would be to rebuild the original package with the proper flag.\n\nCheck what packages depend on the php package, for example:\n\n```\n$ pacman -Qii php\n```\n\n```\n:: php-apache: requires php\n:: php-apcu: requires php\n:: php-pear: requires php\n```\n\nUninstall all those including php.\n\nUse the ABS to acquire the build files for each of them, modify the PKGBUILD in their folder to add --enable-maintainer-zts, next to the other extensions. It should look like:\n\n```\n...\n--with-xsl=shared \\\n--with-zip=shared \\\n--with-zlib \\\n--enable-maintainer-zts\n...\n```\n\nMake the new packages with makepkg, then install the rebuild version of the packages you had previously removed:\n\n```\n# pacman -U \\\nphp-version-release-x86_64.pkg.tar.zstd \\\nphp-apache-version-release-x86_64.pkg.tar.zstd \\\nphp-pear-version-release-x86_64.pkg.tar.zstd \\\n```\n\nOn some versions of PHP, php-pearAUR is missing and it is needed to run pecl. As adding --with-pear in the file above does not solve it, you will need to install it separately.\n\nThen install pthreads:\n\n```\n$ pecl install pthreads\n```\n\nor install parallel for recent PHP versions:\n\n```\n$ pecl install parallel\n```\n\nIf you installed parallel, you will need to edit /etc/php/php.ini and add the parallel extension, it should look like:\n\n```\n...\n;extension=odbc\n;zend_extension=opcache\nextension=parallel\n;extension=pdo_dblib\n...\n```\n\nInstall the php-apcu package for APC support back.\n\n"
    }
  ]
}