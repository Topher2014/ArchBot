{
  "title": "TIM",
  "url": "https://wiki.archlinux.org/title/TIM",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "QQ is an instant messaging software developed by Tencent, an imitation of ICQ, and a popular IM software in China. This page lists various solutions for Arch Linux using QQ.\n\n"
    },
    {
      "title": "Native Linux version",
      "level": 2,
      "content": "The official Linux version powered by Electron is already available. To use it, install linuxqqAUR.\n\n"
    },
    {
      "title": "Virtual machine",
      "level": 2,
      "content": "You can run a complete Windows system in a virtual machine and run QQ in this. Compared with other schemes, this scheme has the smallest chance of error. The disadvantage is that it takes up more resources.\n\nNote: **seamless mode** \n\n- According to the license terms[dead link 2024-10-12 ⓘ], running Windows on each virtual device requires a separate authorization. But you can choose to use the virtual machine dedicated system provided by Microsoft[dead link 2024-01-13 ⓘ] (free to use).\n- If you use VirtualBox, it is recommended that you enable seamless mode, this feature allows you to seamlessly operate the window in the virtual machine under the host desktop.\n\n"
    },
    {
      "title": "Wine",
      "level": 2,
      "content": "Note: **This article or section is out of date.** This article or section is out of date.\n\nThis article or section is out of date.\n\nWine is a \"compatibility layer\" that runs Microsoft Windows programs under UNIX-like systems, and it can be used to simulate QQ environment to run QQ/TIM.\n\n"
    },
    {
      "title": "Deepin QQ/TIM",
      "level": 3,
      "content": "Deepin QQ/TIM is a relatively mature solution in wine. Almost out of the box, with fewer bugs.\n\nYou can install the normal QQ: deepin-wine-qqAUR or TIM: com.qq.tim.sparkAUR from Spark Store, also from Arch Linux CN source install the normal QQ: deepin.com.qq.im or TIM: deepin.com.qq.office。\n\nOr you can install the Light version: deepin.com.qq.im.lightAUR。\n\nFor the KDE/Plasma desktop, see Deepin-wine#Deepin-wine applications fails to start.\n\n"
    },
    {
      "title": "Crossover",
      "level": 3,
      "content": "You can use CrossOver to run QQ, TM2013 and TIM. For more details, please refer to CrossOver's compatibility list.\n\n"
    },
    {
      "title": "AppImage",
      "level": 3,
      "content": "AppImage is a format for packaging applications into a single file. You can download the packaged Wine QQ/TIM in [1].Only need to give executable permissions to use. Since the AppImage format comes with the dependencies required by the program, this method is least affected by the versions of other components in the system.\n\n"
    },
    {
      "title": "Teacher Qingfeng's Wine QQ program",
      "level": 3,
      "content": "You can also use the Wine QQ program provided by Teacher Qingfeng.\n\n"
    },
    {
      "title": "QQ light chat version",
      "level": 4,
      "content": "Install winetricks and wine. Created qqlight.verb as follows:\n\n```\nw_metadata qqlight apps \\\n title=\"QQ Light\" \\\n publisher=\"Tencent\" \\\n year=\"2015\" \\\n media=\"download\" \\\n file1=\"QQ6.7Light.exe\" \\\n installed_exe1=\"$W_PROGRAMS_X86_WIN/Tencent/QQ/Bin/QQ.exe\" \\\n homepage=\"https://www.qq.com\" \\\n unattended=\"no\"\n\nload_qqlight()\n{\n    w_download https://dldir1.qq.com/qqfile/qq/QQ6.7Light/13466/QQ6.7Light.exe e1e1ff2bf6461c08047d0a01927a43c5a0746bdf\n\n    if w_workaround_wine_bug 29636 \"Installing native riched20 to work around crash bug\"\n    then\n        w_call riched20\n    fi\n\n    if w_workaround_wine_bug 34566 \"Installing native ctf to work around crash\"\n    then\n        w_call msctf\n    fi\n\n    # Make sure chinese fonts are available\n    w_call fakechinese\n\n    # uses mfc42u.dll\n    w_call mfc42\n\n    cd \"$W_CACHE/$W_PACKAGE\"\n    w_try \"$WINE\" \"$file1\"\n\n    # fix crash after login\n    mkdir -p ~/.local/share/wineprefixes/qqlight/drive_c/users/$LOGNAME/Application\\ Data/Tencent/QQ/Misc/com.tencent.wireless/SDK\n    chmod 000 ~/.local/share/wineprefixes/qqlight/drive_c/users/$LOGNAME/Application\\ Data/Tencent/QQ/Misc/com.tencent.wireless/SDK\n\n    w_declare_exe \"$W_PROGRAMS_X86_WIN\\\\Tencent\\\\QQ\\\\Bin\" QQ.exe\n}\n```\n\nRun winetricks to install:\n\n```\n$ winetricks qqlight.verb\n```\n\nAfter installation, start it through wineconsole:\n\n```\n$ wineconsole .wine/drive_c/run-qqlight.bat\n```\n\n"
    },
    {
      "title": "TIM",
      "level": 4,
      "content": "Install wine, wine-gecko and wine-mono.\n\nExecute winetricks riched20, or use winecfg to set function library substitution.\n\nYou may need to configure Chinese font display, see #Font configuration.\n\nInstall TIM.\n\nThe installed TIM may not have generated an icon in the program list. To add icons by yourself, create a new tim.desktop file and write the following:\n\n```\ntim.desktop\n```\n\n```\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1\nName=TIM\nComment=Tencent TIM\nExec=wine '~/.wine/drive_c/Program Files/Tencent/TIM/Bin/TIM.exe'\nIcon=~/.wine/drive_c/Program Files/Tencent/TIM/TIMUninst.ico\nTerminal=false\nType=Application\nCategories=Network;\n```\n\nMove tim.desktop to ~/.local/share/applications or /usr/share/applications.\n\n"
    },
    {
      "title": "HiDPI support",
      "level": 3,
      "content": "On the HiDPI display, the QQ/TIM interface may be too small. Support for HiDPI has been added to the newer version of QQ/TIM. Just manually adjust Wine's DPI.\n\nExecute winecfg, switch to the display tab in the opened window and adjust the DPI.\n\n"
    },
    {
      "title": "Awesome",
      "level": 4,
      "content": "Wine QQ/TM may be out of control under the tiled window manager, and some configuration is required.\n\nThe following configuration has these effects:\n\n- Set all TM windows to float.\n\n- Clear unnecessary window borders to prevent the focus from moving to the menu when the menu pops up.\n\n- When using tabbed conversation window, increased use of digital switches Alt+Number shortcut key, need to install xdotool.\n\n- Automatically close the pop-up news window.\n\nAdd the following to the Awesome configuration:\n\n```\nfunction myfocus_filter(c)\n  if awful.client.focus.filter(c) then\n    -- This works with tooltips and some popup-menus\n    if c.class == 'Wine' and c.above == true then\n      return nil\n    elseif c.class == 'Wine'\n      and c.type == 'dialog'\n      and c.skip_taskbar == true\n      and c.size_hints.max_width and c.size_hints.max_width < 160\n      then\n      -- for popup item menus of Photoshop CS5\n      return nil\n    else\n      return c\n    end\n  end\nend\n\nawful.rules.rules = {\n  -- All clients will match this rule.\n  {\n    rule = { },\n    properties = {\n      -- we use our own function\n      focus = myfocus_filter,\n      -- The following is the default part\n      border_width = beautiful.border_width,\n      border_color = beautiful.border_normal,\n      keys = clientkeys,\n      buttons = clientbuttons,\n    }\n  }, {\n    rule_any = { \n      instance = {'TM.exe', 'QQ.exe'},\n    },\n    properties = {\n      -- This, together with myfocus_filter, make the popup menus flicker taskbars less\n      -- Non-focusable menus may cause TM2013preview1 to not highlight menu\n      -- items on hover and crash.\n      focusable = true,\n      floating = true,\n      -- remove the border\n      border_width = 0,\n    }\n  }, {\n    -- Other rules\n  }\n}\n\nalt_switch_keys = awful.util.table.join(\n    -- it's easier for a vimer to manage this than figuring out a nice way to loop and concat\n    awful.key({'Mod1'}, 1, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+1') end),\n    awful.key({'Mod1'}, 2, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+2') end),\n    awful.key({'Mod1'}, 3, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+3') end),\n    awful.key({'Mod1'}, 4, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+4') end),\n    awful.key({'Mod1'}, 5, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+5') end),\n    awful.key({'Mod1'}, 6, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+6') end),\n    awful.key({'Mod1'}, 7, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+7') end),\n    awful.key({'Mod1'}, 8, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+8') end),\n    awful.key({'Mod1'}, 9, function(c) awful.util.spawn('xdotool key --window ' .. c.window .. ' ctrl+9') end)\n)\nfunction bind_alt_switch_tab_keys(client)\n    client:keys(awful.util.table.join(client:keys(), alt_switch_keys))\nend -- }}}\n\nclient.connect_signal(\"manage\", function (c, startup)\n  -- other configuration\n\n  if c.instance == 'TM.exe' then\n    -- add Alt+n support\n    bind_alt_switch_tab_keys(c)\n    -- close all kinds of news notification small windows\n    if c.name and c.name:match('^腾讯') and c.above then\n      c:kill()\n    end\n  end\n\n  -- other configuration\nend)\n```\n\nYou can also look at the complete Awesome configuration.\n\n"
    },
    {
      "title": "i3",
      "level": 4,
      "content": "In the native configuration, when qq2012 is started, it will be maximized automatically, and the border is not beautiful. The following two rules can be set in the i3 config setting to improve:\n\n```\nfor_window [instance=\"QQ.exe\"] floating enable\nfor_window [instance=\"QQ.exe\"] border none\n```\n\n"
    },
    {
      "title": "Font configuration",
      "level": 3,
      "content": "If you have problems displaying Chinese, you can try to execute winetricks fakechinese first.\n\nSee also fonts and Font configuration#Applications without Fontconfig support.\n\n"
    },
    {
      "title": "File is occupied",
      "level": 3,
      "content": "Just kill the process of QQ or TIM. After exiting QQ/TIM, some related processes are still running in the background. You can also use the following script to start QQ/TIM, it will first find the existing process, kill the process and start a new QQ/TIM.\n\n```\nstart-tim.sh\n```\n\n```\n#!/bin/sh\n# script to start TIM\n# kill TIM before start TIM\nfor pid in `pgrep TIM.exe`; do\n\tif [ -n ${pid} ]; then\n\t\tkill ${pid}\n\tfi\ndone\n# start TIM\nwine '~/.wine/drive_c/Program Files/Tencent/TIM/Bin/TIM.exe'\n```\n\nThe above example is applicable to TIM, and can be applied to QQ after a little modification.\n\n"
    },
    {
      "title": "Unable to input emoticons under xfce4 (xfwm4)",
      "level": 3,
      "content": "Open the Settings Manager-Window manager tuning-focus, uncheck the ICCCM focus prompt to activate focus anti-theft and follow the standard.\n\nThe reason is that incompatibility occurs when the emoji window gains focus.\n\n"
    },
    {
      "title": "Cannot enter Chinese under non-Chinese locale",
      "level": 3,
      "content": "Modify the Exec of the .desktop file, which is usually located in /usr/share/applications/, but must be copied to ~/.local/share/applications/ in order to not get overwritten.\n\nAdd env LC_ALL=zh_CN.UTF-8 to the Exec line. For example, the original Exec was:\n\n```\nExec=\".wine/drive_c/Program Files/QQ/Bin/QQ.exe\"\n```\n\nShould be changed to:\n\n```\nExec=env LC_ALL=zh_CN.UTF-8 wine \".wine/drive_c/Program Files/QQ/Bin/QQ.exe\"\n```\n\n"
    },
    {
      "title": "Screen flicker when using a monitor with high refresh rate",
      "level": 3,
      "content": "See Chromium#Chromium rendering at 60 FPS despite using a display with a higher refresh rate.\n\n"
    },
    {
      "title": "Hot updates of the native Linux version",
      "level": 3,
      "content": "The native Linux version of QQ sometimes notifies the user to download hot updates. These updates are downloaded to ~/.config/QQ/versions/, and can be applied quickly with a restart of the application. However, this mechanism frequently runs into issues on Arch Linux.\n\n"
    },
    {
      "title": "Empty login page after a hot update",
      "level": 4,
      "content": "If QQ shows an empty login page after a hot update, remove ~/.config/QQ/versions/version/libssh2.so.1 and restart QQ. If it doesn't help, try #Rolling back from a hot update\n\n"
    },
    {
      "title": "Rolling back from a hot update",
      "level": 4,
      "content": "If you want to roll back from a hot update version for any reason, add the current version to onErrorVersions in ~/.config/QQ/versions/config.json and change curVersion to the last good version, and then restart QQ. Next time, QQ will launch with the version specified in curVersion, and will not ask for updates in onErrorVersions.\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- openSUSE wiki\n- QQ group space on the web side When the QQ client used does not support group space, this service can be used instead.\n- IM QQ-QQ mobile version Mobile end is also an alternative.\n- hillwoodroc/winetricks-zh hillwoodroc/winetricks-zh\n\n"
    }
  ]
}