{
  "title": "Snort",
  "url": "https://wiki.archlinux.org/title/Snort",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "From the project website:\n\n"
    },
    {
      "title": "Preamble",
      "level": 2,
      "content": "- A Snort setup that sniffs WAN <-> LAN is more difficult to use. It does not show you which computer triggered the alert, and it requires you to set HOME_NET as your WAN IP address, which can change if your modem uses DHCP.\n- Snort will bridge the two interfaces for you, you will not need to configure this.\n\nYou can use Snort to sniff wireless traffic with two routers. For simplicity the router with DHCP on and wireless off will be called \"router A\" and the router with wireless on and DHCP off \"router B\".\n\n- Ensure the routers do not have the same IP address, but are on the same subnet.\n- If the machine running Snort is configured for inline mode, you will need 3 network interface cards. One for management, one for incoming traffic, and one for outgoing traffic.\n- Connect a ethernet cord from router B to a spare NIC on the Snort machine.\n- Connect another ethernet cord from router A to a spare NIC on the Snort machine.\n- Once Snort is running traffic should flow from router B <-> Snort machine <-> router A <-> internet.\n- If you are not using inline mode, then the traffic will need to be forwarded to the Snort machine, see: Port Mirroring\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the snortAUR package.\n\nCisco Telos team also provides a Docker image: [1]\n\n"
    },
    {
      "title": "Configuration",
      "level": 2,
      "content": "The main configuration file is located at /etc/snort/snort.lua.\n\nLocal configuration can be set in /etc/snort/local.lua. It is recommended to use pulledporkAUR to download your rule set. By default the rules are stored under, $RULE_PATH/snort.rules.\n\nHome network can be set in /etc/snort/homenet.lua. If required, let Snort know what network (or networks) you want to monitor.\n\n```\nHOME_NET = [[ 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 ]]\n```\n\n"
    },
    {
      "title": "Inline mode",
      "level": 3,
      "content": "Inline mode means that packets pass through snort, rather than being diverted to snort. In this mode, snort can drop packets and abort exploitation attempts in real-time. In this mode, snort acts as an intrusion prevention system (IPS).\n\nBy default, snort runs in inline mode, which is defined as under in /etc/snort/local.lua:\n\n```\ndaq =\n{\n   modules =\n   {\n       {\n           name = 'afpacket',\n           \n           --For netfilter (NFQUEUE) based IPS\n           --name = 'nfq',\n           \n           mode = 'inline',\n       },\n   },\n   module_dirs =\n   {\n       '/usr/lib/daq',\n   },\n}\n\nips =\n{\n   mode = inline,\n   ...\n}\n```\n\n"
    },
    {
      "title": "IDS mode",
      "level": 3,
      "content": "Note: **This article or section is out of date.** This article or section is out of date.\n\nThis article or section is out of date.\n\nIn intrusion detection mode (IDS), packets are diverted to snort. Snort can not drop packets, which means that it can only notify you that a exploitation attempt is occuring, or have already occured.\n\nIn IDS mode start snort@ens1.\n\n"
    },
    {
      "title": "Updating the rules with Pulledpork",
      "level": 2,
      "content": "Install pulledporkAUR.\n\n"
    },
    {
      "title": "Configuration",
      "level": 3,
      "content": "The configuration files are located in /etc/pulledpork\n\nEdit /etc/pulledpork/pulledpork.conf and uncomment the rules you want to use. You will need an \"oinkcode\" to download some of the rules.\n\n- dropsid.conf any rules matched in this file will have its traffic dropped.\n- enablesid.conf is used to enable signatures. All signatures seem to be enabled by default, no need to edit this file.\n- disablesid.conf is used to completely remove a signature from Snort.\n\nThe current categories that are within your rule set can be found by running the following:\n\n```\n$ pulledpork.pl -c /etc/snort/pulledpork.conf -Pw\n$ zgrep -E '\\.rules' /var/tmp/*.gz | cut -d'/' -f3 | sort -u | perl -lne '/(.*).rules/ && print $1' > rules.`date +%F`\n```\n\n"
    },
    {
      "title": "Drop traffic with Pulledpork",
      "level": 3,
      "content": "If you want to drop all traffic that matches a Snort signature instead of just alerting, add the following to your dropsid.conf:\n\n```\npcre:.\n```\n\nOr if you want to drop all traffic matching an entire category:\n\n```\npolicy-social\npolicy-other\nfile-other\n```\n\nIf you only want to drop a single rule:\n\n```\n118:7\n```\n\n"
    },
    {
      "title": "Disabling rules with Pulledpork",
      "level": 3,
      "content": "If you want to disable a single signature add its gen_id and sig_id to /etc/pulledpork/disablesid.conf\n\n```\n118:22\n```\n\nIf you want to disable an entire category:\n\n```\ndeleted\nprotocol-icmp\npolicy-social\npolicy-other\n```\n\n"
    },
    {
      "title": "Running Pulledpork",
      "level": 3,
      "content": "This will pull the new rules and write them to /etc/snort/rules/snort.rules\n\n```\npulledpork.pl -c /etc/pulledpork/pulledpork.conf  -P\n```\n\n"
    },
    {
      "title": "Update the rules: Oinkmaster",
      "level": 2,
      "content": "There are two sets of rules distributed by Snort: \"Community Ruleset\" and \"Snort Subscriber Rule Set\". The former one is freely available to all of the users. The latter one is made available to subscribed and registered users. Paid subscribers receive rulesets in real-time as they are released. Registered users will receive rulesets 30 days after the subscribers. Registration is free and available at: Snort: Sign up.\n\nThe oinkmasterAUR package is available.\n\n"
    },
    {
      "title": "Oinkmaster setup",
      "level": 3,
      "content": "Edit /etc/oinkmaster.conf and look for the URL section and uncomment the 2.4 line. Make sure to replace <oinkcode> by the Oink code you generated after logging into your Snort account. For Bleeding Snort rules, uncomment the appropriate line.\n\nWhen you log into your new account, create an \"Oink code\". Another thing to change is\n\n```\nuse_external_bins=1 # 1 uses wget, tar, gzip instead of Perl modules\n```\n\nThe rest of the configuration file is fine.\n\n"
    },
    {
      "title": "Oinkmaster usage",
      "level": 3,
      "content": "```\noinkmaster.pl -o /etc/snort/rules\n```\n\nCreate an executable script with the exact command and place it in /etc/cron.daily to update the rules daily automatically.\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Simple stateful firewall\n- Router\n\n"
    }
  ]
}