{
  "title": "Lenovo ThinkPad T14 (AMD) Gen 3",
  "url": "https://wiki.archlinux.org/title/Lenovo_ThinkPad_T14_(AMD)_Gen_3",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article or section does not follow the Laptop page guidelines.** This article or section does not follow the Laptop page guidelines.\n\nThis article or section does not follow the Laptop page guidelines.\n\nTable content:\nHardware | PCI/USB ID | Working?\nGPU | 1002:1681 | Yes\nWireless | 17cb:1103 | Yes\nBluetooth | 17cb:1103 | Yes\nWebcam | 04f2:b74f | Yes\nTrackPoint |  | Yes\nTouchpad | 06cb:00f9 | Yes\nFingerprint reader |  | Yes\nSmartcard reader | 058f:9540 | Yes\nMobile broadband | 2c7c:030a | Yes\n\nThis article covers the installation and configuration of Arch Linux on a Lenovo Thinkpad T14 (AMD) Gen 3 21CFCT01WW laptop. Everything seems to work pretty much out the box with linux≥5.19.0, except the keyboard does not feel the same as the first generation and the battery life is not great.\n\nFor a general overview of laptop-related articles and recommendations, see Laptop.\n\n"
    },
    {
      "title": "Firmware",
      "level": 2,
      "content": "Note: **do not** \n\n- If you run system firmware version 0.1.17 do not set the suspend mode in UEFI setup to Linux (S3). This sleep mode is not supported by the CPU. If you set S3 mode and upgrade the system firmware you need to do a downgrade to 0.1.17 to change it back, because the option is removed in newer firmware. If you set S3 mode nevertheless and try to suspend to mem/S3 mode the system will crash and you need to reset it by holding the power button for a few seconds. s2Idle works even in S3 mode but the power consumption is much higher with 4W instead of 0.5W and would drain the battery very fast.\n\n- If you already set the firmware to S3 mode and upgrade to a newer firmware, you can find the older firmware upgrade iso image on the lenovo support page for your device under bios. There you need to click on the small document symbol named \"details\" to see the older versions. Before you can do a downgrade you have do disable the UEFI rollback prevention under security in the UEFI setup.\n\n- If you are on firmware version 0.1.49 or above, you will NOT be able to downgrade prior to 0.1.49, which includes firmware version 0.1.17. This is due to \"AMD Secure Processor Rollback protection\" being enabled, which disallows a user to downgrade to a system firmware once you have one with a security vulnerability fix, even if you have \"Secure Rollback Prevention\" disabled in the UEFI setup. There's currently no known way to disable it.\n\n"
    },
    {
      "title": "fwupd",
      "level": 3,
      "content": "fwupd supports the UEFI BIOS, the webcam, the touchpad, the CPU/GPU, TPM and the NVMe controller.\n\n"
    },
    {
      "title": "Sleep to idle (s2idle, S0ix)",
      "level": 2,
      "content": "According to Lenovo staff the CPU generation in this device only supports s2idle and not S3 sleep.\n\nSee Power management/Suspend and hibernate#Changing suspend method.\n\n"
    },
    {
      "title": "Suspend/Hibernate",
      "level": 2,
      "content": "There is a known bug in the ath11k kernel module that could block the resume process, freeze the graphics interface and cause loss of wireless card interface. A manual fix is to disable the ath11k_pci module before hibernate and re-enable it after resume.\n\nThis also seems to fix an intermittent issue causing the laptop to immediately wake up after suspend.\n\nSee Dell XPS 13 (9310)#Wi-Fi for a systemd service to automate this procedure.\n\nThis can be automated via sleep hooks - if the module is unloaded before hibernating or suspending it unloads immediately with no delay, and the resume kernel bug does not happen:\n\n```\n/etc/systemd/system/ath11k-suspend.service\n```\n\n```\n[Unit]\nDescription=Suspend: rmmod ath11k_pci\nBefore=sleep.target\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/rmmod ath11k_pci\n\n[Install]\nWantedBy=sleep.target\n```\n\n```\n/etc/systemd/system/ath11k-resume.service\n```\n\n```\n[Unit]\nDescription=Resume: modprobe ath11k_pci\nAfter=suspend.target suspend-then-hibernate.target hibernate.target hybrid-sleep.target\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/modprobe ath11k_pci\n\n[Install]\nWantedBy=suspend.target suspend-then-hibernate.target hibernate.target hybrid-sleep.target\n```\n\nYou need to enable ath11k-suspend.service and ath11k-resume.service.\n\n"
    },
    {
      "title": "Disable wakeup from sleep on touchpad activity",
      "level": 2,
      "content": "Use the following to disable wake-up events caused by the touchpad. Note that this only applies to the touchpad itself and the integrated buttons for left/right click at its bottom, not the 3 buttons at its top or any other input.\n\n```\n/etc/udev/rules.d/99-disable-touchpad-wakeup.rules\n```\n\n```\nKERNEL==\"i2c-ELAN0678:00\", SUBSYSTEM==\"i2c\", ATTR{power/wakeup}=\"disabled\"\n```\n\n"
    },
    {
      "title": "Quectel EM05-G 4G LTE Modem",
      "level": 2,
      "content": "The integrated modem is supported by default, but you need a custom FCC unlock script for ModemManager. This script should be located at /usr/share/ModemManager/fcc-unlock.available.d/2c7c and has to be linked from /etc/ModemManager/fcc-unlock.d/2c7c:030a\n\n```\n/usr/share/ModemManager/fcc-unlock.available.d/2c7c\n```\n\n```\n#!/bin/bash\n\n# SPDX-License-Identifier: CC0-1.0\n# 2022 Leah Oswald <mail@leahoswald.de>\n#\n# Queltec EM05-G FCC unlock mechanism\n#\n\n# require program name and at least 2 arguments\n[ $# -lt 2 ] && exit 1\n\n# first argument is DBus path, not needed here\nshift\n\n# second and next arguments are control port names\nfor PORT in \"$@\"; do\n  # match port name\n  echo \"$PORT\" | grep -q cdc-wdm && {\n    CDC_WDM_PORT=$PORT\n    break\n  }\ndone\n\n# fail if no cdc-wdm port exposed\n[ -n \"$CDC_WDM_PORT\" ] || exit 2\n\n# run mbimcli operation\nmbimcli --device-open-proxy --device=\"/dev/$CDC_WDM_PORT\" --quectel-set-radio-state=on\nexit $?\n```\n\nThen link them:\n\n```\n# ln -s /usr/share/ModemManager/fcc-unlock.available.d/2c7c /etc/ModemManager/fcc-unlock.d/2c7c:030a\n```\n\nAfter that everything should work normal.\n\nThere is an issue at the ModemManager Gitlab to add this script to make this obsolete in the future.\n\n"
    },
    {
      "title": "Function keys",
      "level": 2,
      "content": "Table content:\nKey | Visible?1 | Marked?2 | Effect\nFn | Yes | No | XF86WakeUp\nFn+Esc | No | Yes | Toggles the Fn lock\nFn+F1 | Yes | Yes | XF86AudioMute\nFn+F2 | Yes | Yes | XF86AudioLowerVolume\nFn+F3 | Yes | Yes | XF86AudioRaiseVolume\nFn+F4 | Yes | Yes | XF86AudioMicMute\nFn+F5 | Yes | Yes | XF86MonBrightnessDown\nFn+F6 | Yes | Yes | XF86MonBrightnessUp\nFn+F7 | Yes | Yes | XF86Display\nFn+F8 | Yes | Yes | XF86WLAN\nFn+F9 | Yes | Yes | XF86NotificationCenter\nFn+F10 | Yes | Yes | XF86PickupPhone\nFn+F11 | Yes | Yes | XF86HangupPhone\nFn+F12 | Yes | Yes | XF86Favorites\nFn+End | Yes | No | Insert\nFn+4 | Yes | No | XF86Sleep\nFn+Tab | Yes | No | XF86FullScreen\nFn+s | Yes | No | Alt_L Alt_L+Sys_Req\nFn+d | No | No | Toggles the PrivacyGuard feature\nFn+k | Yes | No | Scroll_Lock\nFn+p | Yes | No | Pause\nFn+b | Yes | No | Pause\nFn+Right Shift | Yes | No | XF86FnRightShift\nFn+Space | No | Yes | Controls the keyboard backlight\nFn+Print | Yes | No | XF86SelectiveScreenshot\nFn+Left Arrow | Yes | No | Home\nFn+Right Arrow | Yes | No | End\n\n1. The key is visible to xev and similar tools\n1. The physical key has a symbol on it, which describes its function\n\n"
    },
    {
      "title": "Mute Mic LED always on",
      "level": 2,
      "content": "There is an issue where the LED light on the mic button is always on.\n\nUsing alsamixer(1) from alsa-utils:\n\n- Select the Realtek ALCXXX sound card (with F6). The card label may be HD-Audio Generic (it should have 5 channels).\n- Disable Auto-Mute Mode.\n- Use Fn+F4 to test the mute/unmute functionality for your microphone. The LED should now properly toggle on and off as expected. If it doesn’t work, try rebooting.\n- Keep the state of Auto-Mute Mode disabled, do not re-enable it.\n\n"
    },
    {
      "title": "Audio",
      "level": 2,
      "content": "Install sof-firmware.\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Youtube install playlist\n- An issue coming out of Hibernate\n- Impossible to downgrade bios even when \"Secure Rollback Prevention\" is turned off\n\n"
    }
  ]
}