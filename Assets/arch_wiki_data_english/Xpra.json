{
  "title": "Xpra",
  "url": "https://wiki.archlinux.org/title/Xpra",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "From Xpra's README:\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the package xpra or xpra-gitAUR, on the server and the clients.\n\n"
    },
    {
      "title": "Run application \"single shot\"",
      "level": 3,
      "content": "To run an application remotely over SSH without starting an xpra server on the host it is running on in advance, you can simply use this command on your client machine:\n\n```\n$ xpra start ssh:user@host --exit-with-children --start-child=\"command\"\n```\n\nWhere \"command\" is the command you would start on the remote hosts shell. This will start xpra remotely and shuts down the xpra server when the command exits.\n\nIf you see Public Key not accepted by remote side, .ssh/config not used correctly, try to use your normal system ssh client instead of the integrated Paramiko SSH client:\n\n```\n$ xpra start --ssh=\"ssh\" ssh:user@host --exit-with-children --start-child=\"command\"\n```\n\n"
    },
    {
      "title": "Run applications in a persistent xpra server on the remote host",
      "level": 3,
      "content": "If you want to have a persistent server on the remote machine, you can start an xpra server on the machine where you want to run the applications (we are using display number 7 here):\n\n```\n$ xpra start :7\n```\n\nNow you can start an application, e.g. firefox:\n\n```\n$ DISPLAY=:7 firefox\n```\n\nOr, if you want to start a screen session and execute the programs from there to be able to close the console:\n\n```\n$ DISPLAY=:7 screen\n[screen starts]\n$ firefox\n```\n\nNote that if you start screen like this you do not have to specify the display number when executing programs. They will be running on the xpra display automatically.\n\nAfter running these commands, you do not see any windows yet. To actually see the applications on your display, you have to connect to the xpra server. If you are connecting to an xpra display on the same machine, start the xpra client like this:\n\n```\n$ xpra attach :7\n```\n\nOr, if you are connecting to a remote machine over ssh:\n\n```\n$ xpra attach ssh:user@example.com:7\n```\n\nAfter starting the client, any programs running on the remote server display are displayed on your local screen. To detach, type ctrl-c or use the command:\n\n```\n$ xpra detach ssh:user@example.com:7\n```\n\nPrograms continue to run on the server and you can reattach again later.\n\nYou can stop the server with:\n\n```\n$ xpra stop :7\n```\n\non the machine where the server is running, or remotely:\n\n```\n$ xpra stop ssh:user@example.com:7\n```\n\n"
    },
    {
      "title": "Run whole desktop environment",
      "level": 3,
      "content": "To run whole desktop (on the server side):\n\n```\n$ xpra start-desktop :7 --start-child=xfce4-session --exit-with-children\n```\n\nwhere:\n\n- :7 is a number of xorg DISPLAY session\n- --start-child=xfce4-session run xfce4 session as child on xpra server\n- --exit-with-children mean that server will be closed after session logout (children exit)\n\nTo attach it (on the server side):\n\n```\n$ xpra attach :7\n```\n\nTo attach it (on the client side):\n\n```\n$ xpra attach ssh:user@example.com:7\n```\n\nTo detach press ctrl+c on terminal or run:\n\n```\n$ xpra detach :7\n```\n\n"
    },
    {
      "title": "Shadow remote desktop",
      "level": 3,
      "content": "To clone:\n\n- display must be auth by this same user as ssh login to\n- display must be shown on remote screen\n\nTo shadow desktop run this on the client side:\n\n```\n$ xpra shadow ssh:DISPLAY_user@example.com:DISPLAY_number\n```\n\n"
    },
    {
      "title": "As xorg sandbox",
      "level": 3,
      "content": "Sandboxing can be achieved with firejail:\n\n- for application sandbox (change eth0 to your interface name or to none): $ firejail --x11=xpra --net=eth0 firefox\n- xpra attach, etc: $ firejail --net=eth0 xpra [...]\n\n```\n$ firejail --x11=xpra --net=eth0 firefox\n```\n\n```\n$ firejail --net=eth0 xpra [...]\n```\n\n"
    },
    {
      "title": "More",
      "level": 3,
      "content": "For a complete manual, see xpra(1).\n\n"
    },
    {
      "title": "Server",
      "level": 4,
      "content": "It is possible to start the xpra server at boot using a systemd unit.\n\nCreate the unit file:\n\n```\n/etc/systemd/system/xpra@.service\n```\n\n```\n[Unit]\nDescription=xpra display\n\n[Service]\nType=simple\nUser=%i\nEnvironmentFile=/etc/conf.d/xpra\nExecStart=/usr/bin/xpra --no-daemon start ${%i}\n\n[Install]\nWantedBy=multi-user.target\n```\n\nNow create the configuration, adding a line for each username you want to have an xpra display:\n\n```\n/etc/conf.d/xpra\n```\n\n```\nmyusername=:7\n```\n\nEnable the service for each username that owns a display. In this example, the service would be xpra@myusername.service.\n\n"
    },
    {
      "title": "Client",
      "level": 4,
      "content": "Add to your ~/.xinitrc file the line necessary to start the connection, adding an & at the end of the line.\n\nMake sure to add such line before the exec line.\n\nFor example, on a remote client it could be:\n\n```\n~/.xinitrc\n```\n\n```\nxpra attach ssh:user@example.com:7 &\n```\n\nConfigure your session to use systemd user session. Read Systemd/User for details.\n\nNote: **systemd user session** \n\nCreate the following service unit:\n\n```\n~/.config/systemd/user/xpra-client@.service\n```\n\n```\n[Unit]\nDescription=xpra client\n\n[Service]\nType=simple\nEnvironmentFile=%h/.config/conf/xpra_client\nExecStart=/usr/bin/xpra attach %i $OPTS\n\n[Install]\nWantedBy=default.target\n```\n\nCreate the configuration file, using the options you want:\n\n```\n~/.config/conf/xpra_client\n```\n\n```\nOPTS=--encoding=jpeg --quality=90\n```\n\nThe service name would be in the format of xpra-client@ssh:username@hostname:<display number>.service.\n\nExample: xpra-client@ssh:myuser@example.com:7.service\n\nEnable that service as a user unit.\n\n"
    },
    {
      "title": "Error: Only console users are allowed to run the X server",
      "level": 3,
      "content": "If the execution fails with this error message in the log file you need to make the following changes:\n\nCreate the following:\n\n```\n/etc/X11/Xwrapper.config\n```\n\n```\nallowed_users=anybody\n```\n\n"
    },
    {
      "title": "Error: failed to connect to display :100",
      "level": 3,
      "content": "Sometimes this errors are produced:\n\n```\n/run/user/1000/xpra/:100.log\n```\n\n```\n(EE) Fatal server error:\n(EE) parse_vt_settings: Cannot open /dev/tty0 (Permission denied)\n(EE) Server terminated with error (1). Closing log file.\n```\n\nTo solve it is necessary run with --xvfb=/usr/bin/Xorg. Example:\n\n```\n$ xpra start ssh://$USER@$SERVER/100 --start-child=/usr/bin/terminator --xvfb=/usr/bin/Xorg\n```\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Xpra website\n\n"
    }
  ]
}