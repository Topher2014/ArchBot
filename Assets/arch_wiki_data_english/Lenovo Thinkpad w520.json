{
  "title": "Lenovo Thinkpad w520",
  "url": "https://wiki.archlinux.org/title/Lenovo_Thinkpad_w520",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article or section is a candidate for merging with Laptop/Lenovo#W series.** This article or section is a candidate for merging with Laptop/Lenovo#W series.\n\nThis article or section is a candidate for merging with Laptop/Lenovo#W series.\n\nNote: **This article or section does not follow the Laptop page guidelines.** This article or section does not follow the Laptop page guidelines.\n\nThis article or section does not follow the Laptop page guidelines.\n\n"
    },
    {
      "title": "GPT / MBR Partition Table",
      "level": 2,
      "content": "I was unable to get the most recent version of the BIOS to boot from a GPT partition table. Everything worked fine once I tried an MBR (\"msdos\" in gparted) partition table.\n\n"
    },
    {
      "title": "Wi-Fi issues",
      "level": 2,
      "content": "- Random Disconnection The output from running dmesg | grep wlan0 as root will include \"wlan0: deauthenticating from MAC by local choice (reason=3)\" Disable power management of pci-express in BIOS\n\n- The output from running dmesg | grep wlan0 as root will include \"wlan0: deauthenticating from MAC by local choice (reason=3)\"\n- Disable power management of pci-express in BIOS\n\n"
    },
    {
      "title": "Bumblebee",
      "level": 3,
      "content": "nVidia Optimus works nicely with a standard bumblebee setup, using the proprietary NVIDIA drivers. For further information refer to the NVIDIA Optimus article.\n\n"
    },
    {
      "title": "Multimonitor",
      "level": 3,
      "content": "The digital and analog video outputs are hardwired to the nVidia chip and are thus unvailable in a standard bumblebee setup, since the X Server is run by the Intel GPU. Unlike earlier Thinkpad W Models, the VGA-Output is not connected to the integrated chip. There are several workarounds available.\n\nUsing intel-virtual-output works really well with little tweaking necessary\n\n```\n$ intel-virtual-output -f\n```\n\nIt is needed to enable virtual outputs for intel graphic card xorg.conf.d.\n\n```\n20-intel.conf\n```\n\n```\nSection \"Device\"\n    Identifier \"intelgpu0\"\n    Driver \"intel\"\n    Option \"VirtualHeads\" \"2\"\nEndSection\n```\n\nsee also Stackexchange for troubleshooting with virtual outputs\n\n```\nmultiscreen_enable.sh\n```\n\n```\n#!/bin/bash\n# Initializes Bumblebee for multi-screen functionality.\n\n#modprobe bbswitch # probably not needed \noptirun true\nintel-virtual-output\n#following line needs to be adapted to the according sceanrio\nxrandr --output LVDS1 --auto --pos 0x0 --output VIRTUAL8 --mode VIRTUAL8.740-1920x1200 --pos 1920x-60\n```\n\n```\nmultiscreen_term.sh\n```\n\n```\n#!/bin/bash\n# Initializes Bumblebee for multi-screen functionality.\nxrandr --output VIRTUAL8 --off  \nxorg_process=$(ps aux | grep 'Xorg :8' | awk '{print $2}')\nkill -15 $xorg_process\nsleep 1\nrmmod nvidia_modeset\nsleep 1\nrmmod nvidia\n```\n\n```\nmultiscreen_reinit.sh\n```\n\n```\n#!/bin/bash\n# Restarts Bumblebee for multi-screen functionality.\n\ntee /proc/acpi/bbswitch <<<ON\nmodprobe bbswitch\nmodprobe nvidia-modeset\noptirun true\nintel-virtual-output\nxrandr --output LVDS1 --auto --pos 0x0 --output VIRTUAL8 --mode VIRTUAL8.740-1920x1200 --pos 1920x-60\n```\n\nFor the nvidia card to recognize external monitors, some lines have to be commented out of the default config file at /etc/bumblebee/xorg.conf.nvidia.\n\n```\nxorg.conf.nvidia\n```\n\n```\n...\n #   Option \"UseEDID\" \"false\"\n #   Option \"UseDisplayDevice\" \"none\"\n...\n```\n\nsee also: Phoronix Nvidia Forums\n\n"
    },
    {
      "title": "Ultranav - Trackpoint and Touchpad",
      "level": 2,
      "content": "Note: **This article or section is a candidate for merging with TrackPoint.** This article or section is a candidate for merging with TrackPoint.\n\nThis article or section is a candidate for merging with TrackPoint.\n\nTrackpoint and Touchpad will work out of the box, but some tweaking is required for further configuration.\n\n- Set up trackpoint scrolling by adding a new config in xorg.conf.d.\n\n```\n20-trackpoint.conf\n```\n\n```\nSection \"InputClass\"\n         Identifier      \"Trackpoint Wheel Emulation\"\n         MatchProduct    \"TPPS/2 IBM TrackPoint|DualPoint Stick|Synaptics Inc. Composite TouchPad / TrackPoint\"\n         MatchDevicePath \"/dev/input/event*\"\n         Option          \"EmulateWheel\"                \"true\"\n         Option          \"EmulateWheelButton\"  \"2\"\n         Option          \"Emulate3Buttons\"     \"false\"\n         Option          \"XAxisMapping\"                \"6 7\"\n         Option          \"YAxisMapping\"                \"4 5\"\nEndSection\n```\n\n- Trackpoint sensitivity and speed can be set up using an udev rule in /etc/udev/rules.d/ (the add-rule will work around the configuration not being applied when the trackpoint hasn't been loaded, alternatively a wait-for can be used, which comes with the added drawback of added unresponsiveness of the trackpoint some time after boot)\n\n```\n82-trackpoint.rules\n```\n\n```\n# Set the trackpoint speed and sensitivity\nACTION==\"add\",SUBSYSTEM==\"input\",ATTR{name}==\"TPPS/2 IBM TrackPoint\",ATTR{device/sensitivity}=\"240\"\n```\n\n- Touchpad can be used after installing xf86-input-synaptics\n\n"
    },
    {
      "title": "Boot up issue with UDEV timeout",
      "level": 3,
      "content": "```\n# dmesg | grep -i pci\n```\n\n```\nudevd[169]: seq 1352 '/devices/pci0000:00/0000:00:1c.1/0000:03:00.0' killed\n```\n\nSimilar issue at FS#27938.\n\n"
    },
    {
      "title": "System beep",
      "level": 3,
      "content": "See PC speaker#Disabling the PC speaker.\n\n"
    },
    {
      "title": "Screen brightness",
      "level": 3,
      "content": "video.use_native_backlight is enabled by default, unfortunately this setting does not work well for the W520, disabling it should solve the issue:\n\n```\nvideo.use_native_backlight=0\n```\n\nThe following kernel parameters may also be necessary to get backlight control working in X sessions with NVIDIA drivers:\n\n```\nacpi_backlight=video\n```\n\nand create the file:\n\n```\n/usr/share/X11/xorg.conf.d/10-nvidia-brightness.conf\n```\n\n```\nSection \"Device\"\n    Identifier     \"Device0\"\n    Driver         \"nvidia\"\n    VendorName     \"NVIDIA Corporation\"\n    BoardName      \"Quadro 1000M\"\n    Option         \"RegistryDwords\" \"EnableBrightnessControl=1\"\nEndSection\n```\n\n"
    },
    {
      "title": "FAN Settings with Thinkfan",
      "level": 2,
      "content": "Default temperature management allows only a limited fan speed. This inherently leads to overheating since the laptop is designed to run with unregulated fan speed under full load.\n\nThinkfan.conf:\n\n```\nthinkfan.conf\n```\n\n```\nSection\nhwmon /sys/devices/virtual/thermal/thermal_zone0/temp\n# Fan   Temp1   Temp2\n(0,     0,      35)\n(1,     30,     40)\n(2,     35,     45)\n(3,     40,     50)\n(4,     45,     55)\n(5,     50,     60)\n(6,     55,     65)\n(7,     60,     70)\n(127,   65,     32767)\n# last line is unregulated/max speed.  Like this the Laptop will be ~ at 60\nEndSection\n```\n\n"
    }
  ]
}