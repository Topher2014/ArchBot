{
  "title": "Offline Installation of Packages",
  "url": "https://wiki.archlinux.org/title/Offline_Installation_of_Packages",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "This article provides instructions on installing Arch Linux on a system without an Internet connection. To do this, another system with a working Internet connection is required.\n\nFirst, follow the Installation guide, skipping the steps requiring an internet connection (e.g. Installation guide#Connect to the internet), then continue with this guide instead of following Installation guide#Install essential packages.\n\n"
    },
    {
      "title": "Prepare local repository",
      "level": 2,
      "content": "Follow Pacman/Tips and tricks#Installing packages from a CD/DVD or USB stick for instructions on preparing a local repository with the necessary files on a separate host installation.\n\nAt the very least, for a functioning system, the following packages are recommended:\n\n```\n# pacman -Syw --cachedir . --dbpath /tmp/blankdb base linux linux-firmware\n```\n\nCreate your custom offline repository:\n\n```\n# repo-add ./custom.db.tar.zst ./*[^sig]\n```\n\nNote: **The factual accuracy of this article or section is disputed.** The factual accuracy of this article or section is disputed.\n\nThe factual accuracy of this article or section is disputed.\n\n"
    },
    {
      "title": "Mount and configure",
      "level": 2,
      "content": "Note: **This article or section needs expansion.** This article or section needs expansion.\n\nThis article or section needs expansion.\n\nOnce the repository is prepared, connect the external media to the new installation, and mount it on the newly created root filesystem:\n\n```\n# mount --mkdir /dev/sdxy /mnt/repo\n```\n\nEdit your archiso /etc/pacman.conf and add a new section:\n\n```\n/etc/pacman.conf\n```\n\n```\n[custom]\nSigLevel = Optional\nServer = file:///mnt/repo/\n```\n\nComment out [core] and [extra] so that pacman does not fail on the default repositories.\n\n"
    },
    {
      "title": "Pacstrap",
      "level": 2,
      "content": "You can now continue to pacstrap your locally-available packages to the new installation:\n\n```\n# pacstrap -K /mnt base linux linux-firmware\n```\n\n"
    },
    {
      "title": "Install from file",
      "level": 3,
      "content": "In case the offline installation process was only temporary, but requires manual installation of some packages before being able to access a network, see pacman#Additional commands to learn how to install local packages.\n\nShell globbing can be used to install many packages at once:\n\n```\n# pacman -U /package/folder/*.tar.zst\n```\n\n"
    },
    {
      "title": "Offline cache",
      "level": 3,
      "content": "You can put the required files into /var/lib/pacman/sync and /var/cache/pacman/pkg, so as to make pacman think it has everything it needs to do searches, updates, and installs. The following method is based on two forum threads: [1][2].\n\nThe steps are:\n\n1. downloading the up to date package databases on a computer with internet access,\n1. transferring them to the offline computer,\n1. generating the list of packages required from the offline computer to update it,\n1. downloading them with their signature on a computer with internet access,\n1. transferring them to the pacman cache of the offline computer,\n1. installing the updates.\n\nThe following script will download the updated package databases. If needed, change MIRROR to any mirror from the mirror status list.\n\n```\ndownload_databases.sh\n```\n\n```\n#!/bin/sh\n\nARCH=\"x86_64\"\nMIRROR=\"https://mirrors.kernel.org/archlinux/\"\n\nwget \"${MIRROR}/core/os/${ARCH}/core.db\"\nwget \"${MIRROR}/extra/os/${ARCH}/extra.db\"\nwget \"${MIRROR}/multilib/os/${ARCH}/multilib.db\"\n\n# and possibly -uncomment- (if customized in /etc/pacman.conf or pacman.conf.d):\n\n#wget \"${MIRROR}/core-testing/os/${ARCH}/core-testing.db\"\n#wget \"${MIRROR}/extra-testing/os/${ARCH}/extra-testing.db\"\n#wget \"${MIRROR}/multilib-testing/os/${ARCH}/multilib-testing.db\"\n\n# and -additionally- debug and staging packages.\n```\n\nMake the script executable and run it. You will obtain multiple .db files.\n\nThe following steps will be transferring the .db files to the offline PC, making it so you are working with up-to-date package lists (as if you ran pacman -Sy), then generating a list of package required for the update:\n\n```\n# cp *.db /var/lib/pacman/sync/\n# pacman -Sup --noconfirm > pkglist\n```\n\nYou will also need to download the corresponding package signatures, so prepare the list of signatures to download:\n\n```\n# sed -e 's/\\.zst$/.zst.sig/' ../pkglist > ../siglist\n```\n\nNext, bring the two lists with you to a place where you have internet and download the listed packages in an empty directory:\n\n```\n# wget -nv -i ../pkglist\n# wget -nv -i ../siglist\n```\n\nTake all the *.pkg.tar.zst and *.pkg.tar.zst.sig files back home, put them in /var/cache/pacman/pkg and finally run:\n\n```\n# pacman -Su\n```\n\n"
    },
    {
      "title": "Local repository",
      "level": 3,
      "content": "In case the new system is expected to remain offline or airgapped, it should be configured to expect only local repositories.\n\n"
    },
    {
      "title": "Complete repository",
      "level": 4,
      "content": "After chrooting into your new installation, edit the new /etc/pacman.conf in the same way as previously (but without the /mnt prefix):\n\n```\n/etc/pacman.conf\n```\n\n```\n[custom]\nSigLevel = Optional\nServer = file:///repo/\n```\n\nComment out all other repositories and save. Continue configuring the new system as usual.\n\nFrom now on any updates to the offline system can be made by bringing an up to date copy of the local repository, mounting it to /repo and running pacman commands as usual.\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Help:Browsing#Offline viewing: for browsing ArchWiki offline.\n\n"
    }
  ]
}