{
  "title": "Gitea",
  "url": "https://wiki.archlinux.org/title/Gitea",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Related articles\n\n- Gogs\n- Git\n\nGitea is a community managed fork of Gogs, lightweight code hosting solution written in Go and published under the MIT license.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the gitea or gitea-gitAUR package. There is also a package for the gitea fork forgejo.\n\nGitea requires the use of a database backend, the following are supported:\n\n- MariaDB/MySQL\n- PostgreSQL\n- SQLite\n- MSSQL\n\n"
    },
    {
      "title": "Configuration",
      "level": 2,
      "content": "The user configuration file is located at /etc/gitea/app.ini.\n\nSee the Gitea docs for more configuration examples.\n\n"
    },
    {
      "title": "PostgreSQL",
      "level": 3,
      "content": "Install and configure PostgreSQL.\n\nChoose between TCP or UNIX Socket, and jump to the corresponding section.\n\n"
    },
    {
      "title": "With TCP socket",
      "level": 4,
      "content": "Create the new user while connecting to the server as postgres user (you will be prompted for a password for the new user):\n\n```\n[postgres]$ createuser -P gitea\n```\n\nCreate the Gitea database, owned by gitea user:\n\n```\n[postgres]$ createdb -O gitea gitea\n```\n\nPostgreSQL#Configure PostgreSQL to be accessible from remote hosts\n\nVerify it works:\n\n```\n$ psql --host=ip_address --dbname=gitea --username=gitea --password\n```\n\nConfigure Gitea either through the first-run installer or update app.ini:\n\n```\n/etc/gitea/app.ini\n```\n\n```\nDB_TYPE             = postgres\nHOST                = hostadress:port\nNAME                = gitea\nUSER                = gitea\n; Use PASSWD = `your password` for quoting if you use special characters in the password.\nPASSWD              = password\n```\n\n"
    },
    {
      "title": "With Unix socket",
      "level": 4,
      "content": "Create the new user while connecting to the server as postgres user:\n\n```\n[postgres]$ createuser gitea\n```\n\nCreate the Gitea database, owned by gitea user:\n\n```\n[postgres]$ createdb -O gitea gitea\n```\n\nSetup the Unix socket by adding the following line to /var/lib/postgres/data/pg_hba.conf:\n\n```\n/var/lib/postgres/data/pg_hba.conf\n```\n\n```\nlocal    gitea           gitea           peer\n```\n\nRestart postgresql.service.\n\nVerify it works:\n\n```\n[gitea]$ psql --dbname=gitea --username=gitea\n```\n\nConfigure Gitea either through the first-run installer or update app.ini:\n\n```\n/etc/gitea/app.ini\n```\n\n```\nDB_TYPE             = postgres\nHOST                = /run/postgresql/\nNAME                = gitea\nUSER                = gitea\nPASSWD              =\n```\n\n"
    },
    {
      "title": "MariaDB/MySQL",
      "level": 3,
      "content": "The following is an example of setting up MariaDB, setting your desired password:\n\n```\n$ mysql -u root -p\n```\n\n```\nmysql> CREATE DATABASE `gitea` DEFAULT CHARACTER SET `utf8mb4` COLLATE `utf8mb4_unicode_ci`;\nmysql> CREATE USER `gitea`@'localhost' IDENTIFIED BY 'password';\nmysql> GRANT ALL PRIVILEGES ON `gitea`.* TO `gitea`@`localhost`;\nmysql> FLUSH PRIVILEGES;\nmysql> \\q\n```\n\nTry connecting to the new database with the new user:\n\n```\n$ mysql -u gitea -p -D gitea\n```\n\nConfigure MariaDB either through the first-run installer or update app.ini:\n\n```\n/etc/gitea/app.ini\n```\n\n```\nDB_TYPE  = mysql\nHOST     = 127.0.0.1:3306Â ; or /var/run/mysqld/mysqld.sock\nNAME     = gitea\nUSER     = gitea\nPASSWD   = password\n```\n\n"
    },
    {
      "title": "Usage",
      "level": 2,
      "content": "Start/enable gitea.service, the webinterface should listen on http://localhost:3000.\n\nWhen running Gitea for the first time, it should redirect to http://localhost:3000/install.\n\n- You might want to configure a reverse proxy to access remotely, e.g. nginx.\n- If you want Gitea to listen on all interfaces, set HTTP_ADDR = 0.0.0.0 in /etc/gitea/app.ini.\n\n"
    },
    {
      "title": "Local Shell Client (tea)",
      "level": 3,
      "content": "With tea you can use the official cli-client of gitea. More information can be found at https://gitea.com/gitea/tea\n\n"
    },
    {
      "title": "Enable SSH Support",
      "level": 3,
      "content": "Make sure SSH is properly configured and running.\n\n"
    },
    {
      "title": "Setup your domain",
      "level": 4,
      "content": "You might want to set SSH_DOMAIN, e.g.:\n\n```\n/etc/gitea/app.ini\n```\n\n```\nSSH_DOMAIN                 = git.domain.tld\n```\n\n"
    },
    {
      "title": "Configure SSH",
      "level": 4,
      "content": "By default, Gitea will run as the user gitea; this account will also be used for ssh repository access. For ssh access to work, you have to enable PAM. Alternatively, you might have to unlock service account.\n\n```\n/etc/ssh/sshd_config\n```\n\n```\n...\nUsePAM yes\n...\n```\n\nIf you use AllowUsers in your SSH configuration, add AllowUsers gitea to it, e.g.:\n\n```\n/etc/ssh/sshd_config\n```\n\n```\n...\nAllowUsers archie gitea\n...\n```\n\nRestart sshd.service if you use it (nothing to do if you use sshd.socket).\n\n"
    },
    {
      "title": "Disable HTTP protocol",
      "level": 3,
      "content": "By default, the ability to interact with repositories by HTTP protocol is enabled. You may want to disable HTTP-support if using SSH, by setting DISABLE_HTTP_GIT to true.\n\n"
    },
    {
      "title": "Binding on restricted ports",
      "level": 3,
      "content": "If you use the built-in SSH server and want Gitea to bind it on port 22, or if you want to bind Gitea webserver directly on ports 80/443 (that is in a setup without proxy), you will need to add a drop-in systemd unit override:\n\n```\n/etc/systemd/system/gitea.service.d/override.conf\n```\n\n```\n[Service]\nAmbientCapabilities=CAP_NET_BIND_SERVICE\nCapabilityBoundingSet=CAP_NET_BIND_SERVICE\nPrivateUsers=false\n```\n\n"
    },
    {
      "title": "Enable Dark Theme",
      "level": 3,
      "content": "In the ui section, you can set the DEFAULT_THEME to arc-green for making the web interface use a dark background.\n\n"
    },
    {
      "title": "Customize the appearance of Gitea",
      "level": 3,
      "content": "See the Gitea docs[1] for more detail.\n\nThe appearance of gitea is highly customizable using Go templates. First, create the /var/lib/gitea/custom directory. Templates can be overridden by editing files in /var/lib/gitea/custom/templates. The default templates can be found in the Gitea source code under the templates directory. For instance, to customize the home page, copy templates/home.tmpl from the source code to /var/lib/gitea/custom/templates/home.tmpl and edit the template as desired.\n\nIn addition, the logo and favicon can be changed by creating the following files: /var/lib/gitea/custom/public/img/logo.svg and /var/lib/gitea/custom/public/img/favicon.svg\n\nGitea needs to be restarted after any changes to these files.\n\n"
    },
    {
      "title": "Configure reverse proxy",
      "level": 3,
      "content": "For additional information and examples, see the Reverse Proxies section on the Gitea documentation website [2].\n\n"
    },
    {
      "title": "nginx",
      "level": 4,
      "content": "The following is an example of using nginx as reverse proxy for Gitea over unix socket (you need to provide the SSL certificate):\n\n```\n/etc/nginx/servers-available/gitea.conf\n```\n\n```\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name git.domain.tld;\n\n    ssl_certificate /path/to/fullchain.pem;\n    ssl_certificate_key /path/to/privkey.pem;\n\n    location / {\n        client_max_body_size 512M;\n        proxy_pass http://unix:/run/gitea/gitea.socket;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n```\n\nUpdate the [server] and [session] section of app.ini:\n\n```\n/etc/gitea/app.ini\n```\n\n```\n[server]\nPROTOCOL                   = unix\nDOMAIN                     = git.domain.tld\nROOT_URL                   = https://git.domain.tld\nHTTP_ADDR                  = /run/gitea/gitea.socket\nLOCAL_ROOT_URL             =\n\n[session]\nCOOKIE_SECURE              = true\n```\n\n"
    },
    {
      "title": "Apache HTTP Server",
      "level": 4,
      "content": "The following is an example of using the Apache HTTP Server as reverse proxy for Gitea over unix socket. To forward domain.tld to the gitea server, use\n\n```\n/etc/httpd/conf/httpd.conf\n```\n\n```\nProxyPreserveHost On\nProxyRequests off\nAllowEncodedSlashes NoDecode\nProxypass / unix:/run/gitea/gitea.socket|http://domain.tld nocanon\nProxypassReverse / unix:/run/gitea/gitea.socket|http://domain.tld nocanon\n```\n\nwhere domain.tld should be replaced by your domain name (this entry is only passed as a header to the proxy, and does not seem to matter for this setup).\n\n```\n/etc/gitea/app.ini\n```\n\n```\n[server]\nPROTOCOL                   = unix\nDOMAIN                     = domain.tld\nROOT_URL                   = https://domain.tld\nHTTP_ADDR                  = /run/gitea/gitea.socket\nLOCAL_ROOT_URL             =\n```\n\nTo forward a subpath such as domain.tld/git to the gitea server, use\n\n```\n/etc/httpd/conf/httpd.conf\n```\n\n```\n<Proxy *>\n  Order allow,deny\n  Allow from all\n</Proxy>\nAllowEncodedSlashes NoDecode\nProxypass /git unix:/run/gitea/gitea.socket|http://domain.tld nocanon\nProxypassReverse /git unix:/run/gitea/gitea.socket|http://domain.tld nocanon\n```\n\n```\n/etc/gitea/app.ini\n```\n\n```\n[server]\nPROTOCOL                   = unix\nDOMAIN                     = domain.tld\nROOT_URL                   = https://git.domain.tld\nHTTP_ADDR                  = /run/gitea/gitea.socket\nLOCAL_ROOT_URL             =\n```\n\n"
    },
    {
      "title": "Setup for custom data directory",
      "level": 3,
      "content": "As of now, you cannot use a custom path like /srv/gitea as your server home, since the shipped gitea.service unit file marks everything read-only.\n\nTo enable these custom paths, create a drop-in snippet with your server home directory as a new ReadWriteDirectories directive:\n\n```\n/etc/systemd/system/gitea.service.d/data-directory.conf\n```\n\n```\n[Service]\nReadWriteDirectories=/srv/gitea\n```\n\nThen do a daemon-reload and restart gitea.service for the changes to take effect.\n\n"
    },
    {
      "title": "Database error on startup after upgrade to 1.5.0",
      "level": 3,
      "content": "A problem can appear after the upgrade to 1.5.0. The service will not start, and the following error is present in the logs:\n\n```\n/var/log/gitea/gitea.log\n```\n\n```\n2018/08/21 16:11:12 [...itea/routers/init.go:60 GlobalInit()] [E] Failed to initialize ORM engine: migrate: do migrate: Sync2: Error 1071: Specified key was too long; max key length is 767 bytes\n```\n\nTo fix this problem, run the following command as the `root` user on your MySQL/MariaDB server\n\n```\n$ mysql -u root -p\n```\n\n```\nMariaDB> set global innodb_large_prefix = `ON`;\n```\n\ngitea should stop complaining about key size and startup properly.\n\n"
    },
    {
      "title": "Service failing with permission denied",
      "level": 3,
      "content": "If you manually create the gitea user with a usual home folder /home/gitea the gitea service will not start and output an error like :\n\n```\nSep 04 04:44:32 systemd[1]: gitea.service: Failed with result 'exit-code'.\nSep 04 04:44:32 systemd[1]: gitea.service: Main process exited, code=exited, status=200/CHDIR\nSep 04 04:44:32 (gitea)[30727]: gitea.service: Failed at step CHDIR spawning /usr/bin/gitea: Permission denied\nSep 04 04:44:32 (gitea)[30727]: gitea.service: Changing to the requested working directory failed: Permission denied\n```\n\nThe service needs the home folder of the user to be the main gitea folder, the default being /var/lib/gitea a fix would be:\n\n```\n$ usermod -d /var/lib/gitea gitea\n```\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Gitea Documentation\n\n"
    }
  ]
}