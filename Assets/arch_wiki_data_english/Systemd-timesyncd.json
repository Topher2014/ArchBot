{
  "title": "Systemd-timesyncd",
  "url": "https://wiki.archlinux.org/title/Systemd-timesyncd",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Related articles\n\n- systemd-networkd\n- systemd\n- System time\n\nFrom the systemd mailing list:\n\n"
    },
    {
      "title": "Configuration",
      "level": 2,
      "content": "When starting, systemd-timesyncd will read the configuration file from /etc/systemd/timesyncd.conf, which looks like this:\n\n```\n/etc/systemd/timesyncd.conf\n```\n\n```\n[Time]\n#NTP=\n#FallbackNTP=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org\n#...\n```\n\nTo add time servers or change the provided ones, uncomment the relevant line and list their host name or IP separated by a space. Alternatively, you can use a configuration snippet in /etc/systemd/timesyncd.conf.d/*.conf, see timesyncd.conf(5).\n\nFor example, you can use any servers provided by the NTP pool project or use the default Arch ones (also provided by the NTP pool project):\n\n```\n/etc/systemd/timesyncd.conf or /etc/systemd/timesyncd.conf.d/local.conf\n```\n\n```\n[Time]\nNTP=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org\nFallbackNTP=0.pool.ntp.org 1.pool.ntp.org 0.fr.pool.ntp.org\n```\n\nTo verify your configuration:\n\n```\n$ timedatectl show-timesync --all\n```\n\n```\nLinkNTPServers=\nSystemNTPServers=\nFallbackNTPServers=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org\nServerName=0.arch.pool.ntp.org\nServerAddress=103.47.76.177\nRootDistanceMaxUSec=5s\nPollIntervalMinUSec=32s\nPollIntervalMaxUSec=34min 8s\nPollIntervalUSec=1min 4s\nNTPMessage={ Leap=0, Version=4, Mode=4, Stratum=2, Precision=-21, RootDelay=177.398ms, RootDispersion=142.196ms, Reference=C342F10A, OriginateTimestamp=Mon 2018-07-16 13:53:43 +08, ReceiveTimestamp=Mon 2018-07-16 13:53:43 +08, TransmitTimestamp=Mon 2018-07-16 13:53:43 +08, DestinationTimestamp=Mon 2018-07-16 13:53:43 +08, Ignored=no PacketCount=1, Jitter=0 }\nFrequency=22520548\n```\n\nFurther to the daemon configuration, NTP servers may also be provided via a systemd-networkd configuration with a NTP= option or, dynamically, via a DHCP server (when the UseNTP option is enabled in the [DHCPv4] or [DHCPv6] section of a .network file).\n\nThe NTP server to be used will be determined using the following rules:\n\n- Any per-interface NTP servers obtained from systemd-networkd.service(8) configuration or via DHCP take precedence.\n- The NTP servers defined in /etc/systemd/timesyncd.conf will be appended to the per-interface list at runtime and the daemon will contact the servers in turn until one is found that responds.\n- If no NTP server information is acquired after completing those steps, the NTP server host names or IP addresses defined in FallbackNTP= will be used.\n\n- The service writes to a local file /var/lib/systemd/timesync/clock with every synchronization and every 60 seconds. This location is hard-coded and cannot be changed.\n- This writing may be problematic for running off read-only root partition or trying to minimize writes to an SD card.\n- The number of writes can be minimized with a configuration like PollIntervalMinSec=1d and SaveIntervalSec=infinity.\n\n"
    },
    {
      "title": "Enable and start",
      "level": 3,
      "content": "To enable and start it, simply run:\n\n```\n# timedatectl set-ntp true\n```\n\nAlternatively (e.g. when running in chroot), start/enable systemd-timesyncd.service.\n\n"
    },
    {
      "title": "Check service",
      "level": 3,
      "content": "The synchronization process might be noticeably slow. This is expected, one should wait a while before determining there is a problem. To check the service status, use:\n\n```\n$ timedatectl status\n```\n\n```\nLocal time: Thu 2015-07-09 18:21:33 CEST\n           Universal time: Thu 2015-07-09 16:21:33 UTC\n                 RTC time: Thu 2015-07-09 16:21:33\n                Time zone: Europe/Amsterdam (CEST, +0200)\nSystem clock synchronized: yes\n              NTP service: active\n          RTC in local TZ: no\n```\n\n"
    },
    {
      "title": "Check verbose",
      "level": 3,
      "content": "To see verbose service information, use:\n\n```\n$ timedatectl timesync-status\n```\n\n```\nServer: 103.47.76.177 (0.arch.pool.ntp.org)\nPoll interval: 2min 8s (min: 32s; max 34min 8s)\n         Leap: normal\n      Version: 4\n      Stratum: 2\n    Reference: C342F10A\n    Precision: 1us (-21)\nRoot distance: 231.856ms (max: 5s)\n       Offset: -19.428ms\n        Delay: 36.717ms\n       Jitter: 7.343ms\n Packet count: 2\n    Frequency: +267.747ppm\n```\n\n"
    },
    {
      "title": "View non default config",
      "level": 3,
      "content": "To see the non default configuration options set and files from which those options are being derived, use:\n\n```\n$ systemd-analyze cat-config systemd/timesyncd.conf --tldr\n```\n\n```\n# /etc/systemd/timesyncd.conf\n[Time]\n\n# /etc/systemd/timesyncd.conf.d/local.conf\n[Time]\nNTP=0.nl.pool.ntp.org 1.nl.pool.ntp.org 2.nl.pool.ntp.org 3.nl.pool.ntp.org\nRootDistanceMaxSec=0.1\nPollIntervalMinSec=1d\nPollIntervalMaxSec=4w\nSaveIntervalSec=infinity\n```\n\n"
    },
    {
      "title": "View log",
      "level": 3,
      "content": "To view the last 24 hours of logged events, use:\n\n```\n# journalctl -u systemd-timesyncd --no-hostname --since \"1 day ago\"\n```\n\n```\nJan 19 15:14:20 systemd[1]: Stopping Network Time Synchronization...\nJan 19 15:14:20 systemd[1]: systemd-timesyncd.service: Deactivated successfully.\nJan 19 15:14:20 systemd[1]: Stopped Network Time Synchronization.\nJan 19 15:14:20 systemd[1]: Starting Network Time Synchronization...\nJan 19 15:14:20 systemd[1]: Started Network Time Synchronization.\nJan 19 15:14:20 systemd-timesyncd[1023]: Contacted time server 178.215.228.24:123 (0.nl.pool.ntp.org).\nJan 19 15:14:20 systemd-timesyncd[1023]: Initial clock synchronization to Fri 2024-01-19 15:14:20.393865 CET.\n```\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Forum: systemd-timesyncd is not syncing time\n- Forum: Using systemd-timesync instead of NTP\n- Source code of timesyncd\n- systemd-timesyncd(8)\n- timesyncd.conf(5)\n\n"
    }
  ]
}