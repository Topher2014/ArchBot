{
  "title": "Binfmt misc for Java",
  "url": "https://wiki.archlinux.org/title/Binfmt_misc_for_Java",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Related articles\n\n- /Wrapper examples\n\nFrom Wikipedia:\n\nIn plain language, this allows you to take a file such as a Java jar or Mono exe that you would ordinarily run via a line such as\n\n```\n$ java -jar /path/to/MyProgram.jar\n$ mono /path/to/MyProgram.exe\n```\n\nand instead run it simply with\n\n```\n$ MyProgram.jar\n$ MyProgram.exe\n```\n\nas long as the executables are in the $PATH.\n\nThe information in this article is almost entirely taken from the files binfmt_misc.txt and java.txt in the Documentation sub-directory of the Linux kernel source tree.\n\n"
    },
    {
      "title": "Mounting binfmt_misc",
      "level": 3,
      "content": "For an ad-hoc mount:\n\n```\n# mount binfmt_misc -t binfmt_misc /proc/sys/fs/binfmt_misc\n```\n\nFor a persistent mount via fstab add the line:\n\n```\nnone  /proc/sys/fs/binfmt_misc binfmt_misc defaults 0 0\n```\n\n"
    },
    {
      "title": "Registering file type with binfmt_misc",
      "level": 3,
      "content": "Filetype registration on Arch is handled by systemd-binfmt.service (provided by systemd).\n\nBinfmt registration lines can be placed in a file in /etc/binfmt.d.\n\nThe contents of the line is explained in the Documentation/admin-guide/binfmt-misc.rst file of the kernel source tree.\n\nThe following lines will create registration files for running Java binaries without having to explicitly call the java command (you still need to have it installed). The first two work by redirecting Java class and jar files to a set of 'wrapper' scripts described in the next section. The final entry runs Java applets in the usual way.\n\n```\n# binfmt_misc support for Java applications:\necho ':Java:M::\\xca\\xfe\\xba\\xbe::/usr/local/bin/javawrapper:' > /etc/binfmt.d/Java.conf\n# binfmt_misc support for executable Jar files:\necho ':ExecutableJAR:E::jar::/usr/local/bin/jarwrapper:' > /etc/binfmt.d/ExecutableJAR.conf\n# binfmt_misc support for Java Applets:\necho ':Applet:E::html::/opt/java/bin/appletviewer:' > /etc/binfmt.d/Applet.conf\n```\n\nRestart systemd-binfmt.service to register the new handlers. Registered binfmt handlers show up as files in /proc/sys/fs/binfmt_misc. Viewing this file should show the name of the registered wrapper script and either the magic bytes or file extension used to recognize that file type.\n\n"
    },
    {
      "title": "Wrapper scripts",
      "level": 3,
      "content": "Please see /Wrapper_examples for jarwrapper and javawrapper scripts and related programs.\n\n"
    },
    {
      "title": "A simple solution",
      "level": 2,
      "content": "This simple solution is suitable in most cases, no bugs are detected during execution. Create file /etc/binfmt.d/java.conf:\n\n```\n:Java:E::class::/usr/local/bin/javawrapper:\n```\n\nCreate file /usr/local/bin/javawrapper:\n\n```\n#!/bin/sh\nfile=${1%%.class}\nfile=${file/.\\//}\njava $file\n```\n\nDo not forget to make it executable\n\nRestart systemd-binfmt.service. Now you can test!\n\n"
    },
    {
      "title": "Testing",
      "level": 2,
      "content": "Create a simple HelloWorld.java program such as the following:\n\n```\nclass HelloWorld {\n    public static void main(String args[]) {\n        System.out.println(\"Hello World!\");\n    }\n}\n```\n\nCompile it as normal and make the .class file executable.\n\nYou should then be able to run it by simply entering:\n\n```\n$ ./HelloWorld.class\n```\n\n"
    },
    {
      "title": "Notes",
      "level": 2,
      "content": "- Some of the material on binfmt_misc refers to it as a module but Arch builds it into the standard kernel.\n- The setup given here works with both the Sun JRE & openjdk6.\n- binfmt_misc can be used for other file types as well. For example, to be able to run DOS/Windows files without having to explicitly specify the wine program, add the following registration entry:\n\n```\n# binfmt_misc support for DOS / Windows applications via Wine\necho ':DOSWin:M::MZ::/usr/bin/wine:' > /proc/sys/fs/binfmt_misc/register\n```\n\n"
    }
  ]
}