{
  "title": "Packaging Brother printer drivers",
  "url": "https://wiki.archlinux.org/title/Packaging_Brother_printer_drivers",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article or section is out of date.** This article or section is out of date.\n\nThis article or section is out of date.\n\nBrother supplies Linux drivers for its printers, but they are provided as .rpm and/or .deb packages only. This article explains what adjustments to the contents of the DEB and RPM packages supplied by Brother will need to be made to create a PKGBUILD for the printer driver. Additional example PKGBUILDs for Brother printers can be found by searching in the AUR.\n\nCUPS handles printers using a .ppd file and a filter binary. Once those two files are installed, the printer can be added in CUPS.\n\n"
    },
    {
      "title": "Creating a PKGBUILD from a .deb",
      "level": 2,
      "content": "Brother is offering a \"Driver Install Tool\" as well as two .deb packages.\n\nOne is the LPR driver and the other one a CUPS wrapper (running on top of LPR driver). Both can be found on Brother's \"Support & Downloads\" page (e.g. for HL-L9200CDW).\n\nIt is possible to create a PKGBUILD that will automatically download and install the .deb packages directly from the URL provided by Brother. Therefore you will need to obtain the direct download links for both .deb packages from brothers website (e.g. for HL-L9200CDW you have the LPR driver and the CUPS wrapper).\n\nOnce you have obtained the download URLs for both .deb packages, use existing PKGBUILD files from brother-hll8360cdw-lpr-binAUR and brother-hll8360cdw-cups-binAUR as templates. You will need to adjust the package name. Change url= to the URL of Brother's support page for your specific printer model, source= needs to be adjusted to the URL of the .deb package. The following PKGBUILD example has been based on brother-hll8360cdw-cups-binAUR but has been adjusted for HL-L9200CDW LPR printer driver:\n\n```\n# Maintainer: John Doe <joe@example.com>\npkgname=brother-hll9200cdw-lpr-bin\npkgver=1.1.2\npkgrel=1\npkgdesc=\"LPR driver for Brother HL-L9200CDW(T) printer\"\narch=(\"i686\" \"x86_64\")\nurl=\"https://support.brother.com/g/b/producttop.aspx?c=ca&lang=en&prod=hll9200cdw_us_as_cn\"\nlicense=(\"EULA\")\nsource=(\"http://www.brother.com/pub/bsc/linux/packages/hll9200cdwlpr-1.1.2-1.i386.deb\")\nmd5sums=(\"30124df7d49362906a2a118eff3c710e\")\npackage() {\n        tar -xf data.tar.gz -C \"${pkgdir}\"\n}\n```\n\nDo not forget to update the md5sum. The pkgver version should be the same version as Brother's printer drivers (please note versions might differ for LPR and CUPS wrapper). Create the PKGBUILD file for the CUPS wrapper, too:\n\n```\n# Maintainer: John Doe <joe@example.com>\npkgname=brother-hll9200cdw-cups-bin\npkgver=1.1.3\npkgrel=1\npkgdesc=\"CUPS wrapper for Brother HL-L9200CDW(T) printer\"\narch=(\"i686\" \"x86_64\")\nurl=\"https://support.brother.com/g/b/producttop.aspx?c=ca&lang=en&prod=hll9200cdw_us_as_cn\"\nlicense=(\"EULA\")\nsource=(\"http://www.brother.com/pub/bsc/linux/packages/hll9200cdwcupswrapper-1.1.3-1.i386.deb\")\nmd5sums=(\"0a802088aac7236a3c309b2b46b37f11\")\npackage() {\n       tar -xf data.tar.gz -C \"${pkgdir}\"\n}\n```\n\nFinally, use makepkg to test/install your newly created PKGBUILD file(s). If everything works, do not forget to publish your new driver to AUR. See AUR submission guidelines for the details.\n\n"
    },
    {
      "title": "Creating a PKGBUILD from a .rpm",
      "level": 2,
      "content": "Unfortunately, Brother's drivers have some issues:\n\n- The CUPS driver is built on top of the lpr driver.\n- The CUPS driver package contains a single installation shell script with an embedded ppd and filter. It is executed by rpm during installation. It extracts the ppd and filter, and performs some installation procedures in a Red Hat-specific way.\n- The CUPS driver package uses paths that are not compliant with the Arch packaging standards.\n\nThese issues can be worked around.\n\n- The lpr driver does not need to be installed, so the PKGBUILD can just extract the files in the lpr driver's RPM package.\n- The CUPS driver's RPM should contain a single shell script. For instance, for the brother-hl2030AUR package, the PKGBUILD changes three things: The paths are changed. All commands are disabled except \"cat <<EOF\" or \"echo > ...\" or whatever there is that emits *.ppd or filter to separate file. It was done by wrapping irrelevant instructions by if false; then ... fi. The target file names for the ppd and filter are changed so they are installed into the same directory as the PKGBUILD. Note that paths to the embedded filter where also changed.\n- To fix the paths to conform to the Arch packaging standards, sed or similar can be used on all text files unpacked from both the lpr and CUPS drivers. Look at the patch in the brother-hl2030AUR package to check which files are affected.\n\n1. The paths are changed.\n1. All commands are disabled except \"cat <<EOF\" or \"echo > ...\" or whatever there is that emits *.ppd or filter to separate file. It was done by wrapping irrelevant instructions by if false; then ... fi.\n1. The target file names for the ppd and filter are changed so they are installed into the same directory as the PKGBUILD. Note that paths to the embedded filter where also changed.\n\nEffectively after the changes described above the script will just output a ppd and a filter to some known location. The PKGBUILD will then copy them to the proper directories in $pkgdir:\n\n```\ninstall -m 644 -D ppd \"${pkgdir}/usr/share/cups/model/HL2030.ppd\"\ninstall -m 755 -D filter  \"${pkgdir}/usr/lib/cups/filter/brlpdwrapperHL2030\"\n```\n\nThe lpr driver files will also need to be copied into $pkgdir!\n\n"
    },
    {
      "title": "Other changes",
      "level": 3,
      "content": "Edit the installation script:\n\n```\n-#PSTOPSFILTER=`which pstops`\n+PSTOPSFILTER='/usr/lib/cups/filter/pstops'\n```\n\nAs pstops is not installed in a standard location, the path will need to be hard-coded.\n\nNote: **The factual accuracy of this article or section is disputed.** The factual accuracy of this article or section is disputed.\n\nThe factual accuracy of this article or section is disputed.\n\nThis may also need to be added.\n\n```\n+[psconvert2]\n+pstops=/usr/lib/cups/filter/pstops\n```\n\n"
    },
    {
      "title": "x86_64",
      "level": 2,
      "content": "Because some of the supplied binaries are 32 bit only, on an x86_64 system some additional multilib packages such as a 32 bit version of glibc (lib32-glibc) may need to be installed.\n\n"
    }
  ]
}