{
  "title": "Lenovo ThinkPad X13 Gen 2 (AMD)",
  "url": "https://wiki.archlinux.org/title/Lenovo_ThinkPad_X13_Gen_2_(AMD)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Table content:\nHardware | PCI/USB ID | Working?\nTouchpad |  | Yes\nJ-Mouse |  | Yes\nVideo |  | Yes\nWebcam | 5986:213c | Yes\nBluetooth |  | No\nBluetooth (Realtek) | 0bda:4852 | Yes\nAudio | 1022:15e3 | Yes\nWireless |  | Yes\nFingerprint reader | 27c6:6594 | Yes\nTPM |  | Untested\n\n"
    },
    {
      "title": "Accessibility",
      "level": 2,
      "content": "The BIOS offers two modes of operation, GUI and Simple Text.\n\nThe GUI can be navigated to some degree via the keyboard. Left and Right arrow keys to move the selection and Space to activate.\n\nFor full keyboard support switching to simple text would likely be better.\n\nThat can be accomplished by:\n\n- Selecting and activating Config on the left side under Setup\n- Right arrowing until the drop down to the right of Setup UI is selected\n- active the drop down and select Simple Text\n- F10 (save and exit)\n\n"
    },
    {
      "title": "Bluetooth",
      "level": 3,
      "content": "Bluetooth doesn't appear to work with the stock Qualcomm Wi-Fi 6E QCNFA765 modem. The modem is an M.2 2230 form factor and not soldered (on the AMD variant of the X13 Gen 2), and can be replaced easily with an Intel AX210.NGW.\n\n"
    },
    {
      "title": "Brightness control",
      "level": 4,
      "content": "As of kernel 5.9 use the native brightness controller, use the acpi_backlight=native kernel parameter.\n\n"
    },
    {
      "title": "Audio",
      "level": 3,
      "content": "PulseAudio seems to work fine without manual intervention, but the ALSA audio device chosen by default may not be correct. You may need to change the default device.\n\n```\n/etc/asound.conf\n```\n\n```\ndefaults.pcm.card 2\ndefaults.ctl.card 2\n```\n\nYou should remember to unmute the volume.\n\n"
    },
    {
      "title": "NVME / Oculink",
      "level": 3,
      "content": "The NVME port complies with the 4x PCIE 4.0 standard. It accepts other types of peripherals, including e-gpu solutions with Oculink standard for connecting an external NVIDIA or AMD GPU (Intel's Arc GPU does not work at present, for unknown reasons).\n\nCurrently tested: Nvidia GTX 1650 (Low profile) with EXP GDC 10.6 connected via Oculink on the NVME port: Note! Final Fantasy VII Rebirth successfully launched, as the GTX 16XX series is the only GTX to support meshes shaders 6.6 and the laptop CPU supports AVX2 instructions. Note that the Renoir GPU integrated into the AMD APU does not support meshe shaders 6.6, and it will be impossible to launch a new-generation game depending on it. Pyroveil (https://github.com/ValveSoftware/Proton/issues/8408#issuecomment-2657340142) must be used with the dedicated Nvidia fix to get around the poor support for meshes shaders 6.6 provided by proprietary drivers, as things stand. Optiscaler was tested too for enabling DLSS + FSR3 replacement and frame generation support.\n\nNo bandwidth problems noted in any of these situations, whether connecting a monitor directly to the external gpu, or using the display managed by the APU's integrated AMD GPU, on the laptop screen or an external monitor, while taking advantage of the external gpu.\n\n"
    },
    {
      "title": "Firmware",
      "level": 2,
      "content": "fwupd does not support this device yet.\n\n"
    },
    {
      "title": "UEFI",
      "level": 3,
      "content": "It is recommended to run the latest UEFI version.\n\nThe \"BIOS update\" can be downloaded as an ISO image from the X13 support page and loaded to a USB stick.\n\nAdditionally, there is a UEFI option for customizing the Power profile that by default is tuned to Windows 10. See #Power Management.\n\n"
    },
    {
      "title": "Power Management",
      "level": 2,
      "content": "The UEFI provides two choices for the sleep mode in Config > Power > Sleep State. The Windows 10 mode (s2idle) is recommended, and results in about a 0.5%/hour drain while sleeping. Using the Linux mode (s3) may help if you are running an older kernel.\n\nSee Power management/Suspend and hibernate#Changing suspend method.\n\n"
    },
    {
      "title": "Function keys",
      "level": 2,
      "content": "Table content:\nKey | Visible?1 | Marked?2 | Effect\nFn | Yes | No | XF86WakeUp\nFn+Esc | No | Yes | Enables Fn lock\nFn+F1 | Yes | Yes | XF86AudioMute\nFn+F2 | Yes | Yes | XF86AudioLowerVolume\nFn+F3 | Yes | Yes | XF86AudioRaiseVolume\nFn+F4 | Yes | Yes | XF86AudioMicMute\nFn+F5 | No | Yes | XF86MonBrightnessDown\nFn+F6 | No | Yes | XF86MonBrightnessUp\nFn+F7 | Yes | Yes | XF86Display\nFn+F8 | Yes | Yes | XF86WLAN3\nFn+F9 | No | Yes | \nFn+F10 | No | Yes | \nFn+F11 | No | Yes | \nFn+F12 | Yes | Yes | XF86Favorites\nFn+Space | No | Yes | Enables/disables keyboard backlight\nFn+4 | Yes | No | XF86Sleep3\nFn+B | Yes | No | Ctrl_L + Break\nFn+P | Yes | No | Pause\nFn+K | Yes | No | Scroll Lock\nFn+Left | Yes | No | Home\nFn+Right | Yes | No | End\nFn+S | Yes | No | Alt_L + SysRq\nFn+End | Yes | Yes | Ins\n\n1. The key is visible via xev and similar tools\n1. The physical key has a symbol on it, which describes its function\n1. systemd-logind handles this by default\n\n"
    },
    {
      "title": "Gaming",
      "level": 2,
      "content": "Note: **This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.** This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nThis article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nThe APU incorporates a RENOIR from AMD GPU. It is possible to make a few optimizations to be able to run recent games that would otherwise have great difficulty.\n\nTo do this, you need a few tools and configurations:\n\n-znver3 Linux kernel: Available via chaotic-aur or AUR, required for WineFSync support and other optimisations.\n\n-ProtonUP: to install a customised version of Proton/DXVK with FSR support.\n\n-Proton-GE: proton fork with native FSR support.\n\n-Steam: to launch your games\n\n-Heroic: to launch your games\n\n-LACT: to manually specify the GPU frequency, which is necessary for certain games that don't push it to the limit, with a clear degradation in performance in this case.\n\nIf you only want a game machine, you can optimise the launch parameters via /etc/default/grub wich removing mitigations too (enable it if you prefer security by removing mitigations=off) :\n\n```\n/etc/default/grub\n```\n\n```\nGRUB_CMDLINE_LINUX_DEFAULT=\"apparmor=0 security=apparmor lsm=landlock,lockdown,yama,integrity,apparmor,bpf udev. log_priority=3 clearcpuid=514 module_blacklist=pcspkr,snd_pcsp tsc=unstable mitigations=off iommu=pt amd_pstate=active amdgpu.abmlevel=0 idle=nomwait rcu_nocbs=0-$(($(nproc)-1)) processor.max_cstate=5’\n```\n\nEditing environment variables :\n\n```\n/etc/environment\n```\n\n```\nWINEFSYNC=1\n#DX12 support\nVKD3D_DEBUG=none\nVKD3D_SHADER_COMPILE_OPTIONS=fast_math\nVKD3D_FRAME_RATE=24 # choose 24 or 30fps max \n#Enable FSR for Proton-GE or Wine-GE, works only with DXVK\nWINE_FULLSCREEN_FSR=1\nWINE_FULLSCREEN_FSR_MODE=performance # choose performance, medium, quality\n#Choose global config file for directx 9/10/11 support with DXVK. (Alternatively, you can comment this line and include this file next to the executable in each game)\nDXVK_CONFIG_FILE=/home/youruser/.config/dxvk.conf\n#Force using radeon vulkan support\nVK_ICD_FILENAMES=/usr/share/vulkan/icd.d/radeon_icd.i686.json:/usr/share/vulkan/icd.d/radeon_icd.x86_64.json\n#Correcting Bug texture with AMD\nAMD_DEBUG=dpc\nRADV_PERFTEST=video_decode\n#MESA_LOADER_DRIVER_OVERRIDE=zink # Enable only for OpenGL support via Vulkan. GDM will only launch under Wayland, no longer with X.\n\n#Various optimisations and HUD display for Vulkan.\nVK_INSTANCE_LAYERS=VK_LAYER_MESA_overlay VK_LAYER_MESA_OVERLAY_CONFIG=fps,frame_timing=0,device=0,format=0 VK_LAYER_KHRONOS_validation VK_LAYER_L>\nVK_LAYER_KHRONOS_validation=0\nMESA_VK_WSI_PRESENT_MODE=mailbox\nVK_SWAPCHAIN_COLORS=bt709\nvblank_mode=0\nVK_LAYER_LUNARG_standard_validation=0\nMESA_NO_ERROR=1\nVK_LOADER_DISABLE_EXTENSIONS=VK_EXT_debug_marker,VK_KHR_surface\n```\n\nEdit /home/youruser/.config/dxvk.conf or your dxvk.conf next to the game executable :\n\n```\ndxvk.conf\n```\n\n```\n----------Various---------\ndxgi.syncInterval = 0\nd3d11.relaxedBarriers = True\nd3d11.apitrace = False\n\nEnable HUD---------\ndxvk.hud = api,fps,memory,gpuload,version\n\nOptimisation---------\n\nd3d11.ignoreGraphicsBarriers = True\n\nHDR---------\ndxgi.enableHDR = False\ndxgi.enableUe4Workarounds = False\n\n\nFix framerate 24 or 30---------\ndxgi.maxFrameLatency = 2\nd3d9.maxFrameLatency = 2\n\ndxgi.maxFrameRate = 24\nd3d9.maxFrameRate = 24\n\ndxgi.numBackBuffers = 2\nd3d9.numBackBuffers =2\n\n\n\nFast Vsync-----\ndxvk.tearFree = False\n\nVsync-----\ndxgi.syncInterval = -1\nd3d9.presentInterval = -1\n\n\nDisable Anisotropic Fltering---------\n(0-16)-------\nd3d11.samplerAnisotropy  = 0\ndxgi.samplerAnisotropy  = 0\nd3d9.samplerAnisotropy  = 0\n\nTexture sharpening \n( -2-1)--------\nd3d11.samplerLodBias = 0.1\ndxgi.samplerLodBias = 0.1\nd3d9.samplerLodBias = 0.1\nd3d11.clampNegativeLodBias = True\nd3d9.clampNegativeLodBias = True\n\nSupersampling---------\n(True-False)--------------\nd3d11.forceSampleRateShading = False\nd3d9.forceSampleRateShading = False\n\nOptimisation--------------\n\nd3d11.dcSingleUseMode = True\nd3d11.maxFeatureLevel = 11_0\nd3d11.maxTessFactor = 8\nd3d11.relaxedBarriers = False\n\nVram max 2048 or 4096--------------\ndxgi.maxDeviceMemory = 2048\ndxgi.maxSharedMemory = 2048\n```\n\nNow if your on Gnome, on login screen, choose Wayland which offers a much smoother gaming experience when the frame rate drops.\n\nLaunch Proton-Up and choose lateste version of Proton-GE for Steam/Heroic, and config them to using this version.\n\nIn Gnome, don't forget to set power to performance in settings.\n\nLaunch LACT tool for AMD GPU, and choose in \"OC\" TAB to enable service, then reboot system.\n\nLaunch LACT again, and in OC Tab, choose Highest Clocks. This will increase the GPU's capacity to its maximum. Note that this is not overclocking.\n\nLaunch your game and enjoy. :-)\n\nYou can optimize config file for engines too.\n\nExample of Engine.ini for Unreal Engine 4 (here for Final Fantasy VII Remake Intergrade, but could works for others games too) :\n\n```\nEngine.ini\n```\n\n```\n[SystemSettings]\n\nr.VSync=0\nr.SetRes=1920x1080f\n#r.FramerateLimit=30\n#r.MaxFrameRate=30\n\nr.TextureStreaming=1\nr.DynamicRes.OperationMode=0\nr.DynamicRes.MinScreenPercentage=100\nr.DynamicRes.MaxScreenPercentage=100\nr.PostProcess.ScreenResolution=60\nr.MaxAnisotropy=16\nr.PostProcess.AntiAliasingQuality=2\n\nr.Shadow.Quality=0\nr.Shadow.MaxResolution=512\nr.Shadow.MaxCSMResolution=1024\nr.Shadow.RadiusThreshold=0.06\nr.Shadow.DistanceScale=0.8\n\nr.Effects.Quality=1\nr.Foliage.Quality=0\nr.DistanceFieldQuality=0\nr.Water.Quality=0\nr.Particle.Quality=0\n\nr.MotionBlurQuality=0\nr.DepthOfFieldQuality=0\nr.BloomQuality=2\n\nr.TextureQuality=2\nr.Texture.LODBias=-0.5\nr.Streaming.MipBias=1\n\ntessellation.MaxDisplacement=0\n\nr.ParticleLODBias=2\nr.ParticleLightQuality=0\n\nr.ViewDistanceScale=0.9\n\nr.AmbientOcclusionLevels=0\nr.AmbientOcclusionRadiusScale=0.5\n\nr.SkeletalMeshLODBias=2\n\nr.DefaultFeature.MotionBlur=0\n\nr.AllowAsyncCompute=0\nr.AsyncComputeBudget=4\n\nr.FastVRam.BokehDOF=1\nr.FastVRam.CombineLUTs=1\nr.FastVRam.DistanceFieldAODownsampledBentNormal=1\nr.FastVRam.DistanceFieldAOHistory=1\nr.FastVRam.DistanceFieldAOScreenGridResources=1\nr.FastVRam.DistanceFieldCulledObjectBuffers=1\nr.FastVRam.DistanceFieldNormal=1\nr.FastVRam.DistanceFieldShadows=1\nr.FastVRam.DistanceFieldTileIntersectionResources=1\nr.FastVRam.DistortHistory=1\nr.FastVRam.Distortion=1\nr.FastVRam.DOFPostfilter=1\nr.FastVRam.DOFReduce=1\nr.FastVRam.DOFSetup=1\nr.FastVRam.Downsample=1\nr.FastVRam.EyeAdaptation=1\nr.FastVRam.ForwardLightingCullingResources=1\nr.FastVRam.Histogram=1\nr.FastVRam.HistogramReduce=1\nr.FastVRam.HZB=1\nr.FastVRam.LPV=1\nr.FastVRam.MotionBlur=1\nr.FastVRam.PostProcessMaterial=1\nr.FastVRam.SceneColor=1\nr.FastVRam.SceneDepth=1\nr.FastVRam.ScreenSpaceShadowMask=1\nr.FastVRam.ScreenSpaceShadowMask=1\nr.FastVRam.ShadowCSM=1\nr.FastVRam.ShadowPerObject=1\nr.FastVRam.Tonemap=1\nr.FastVRam.Upscale=1\nr.FastVRam.VelocityFlat=1\nr.FastVRam.VelocityMax=1\nr.FastVRam.VolumetricFog=1\n\n[RenderSettings]\nr.Shadow.Quality=0\nr.Effects.Quality=1\nr.Foliage.Quality=0\nr.DistanceFieldQuality=0\nr.Water.Quality=0\nr.Particle.Quality=0\n```\n\nOr Unreal Engine 5 (here for Dragon Ball Sparking Zero, but could works for other games) add in Engine.ini :\n\n```\nEngine.ini\n```\n\n```\n[Engine.Engine]\n; Limit Max FPS\nbSmoothFrameRate=True\nMinSmoothedFrameRate=30\nMaxSmoothedFrameRate=30\n\n[/script/engine.engine]\nFixedFrameRate=30\n\n[SystemSettings]\nbUseFixedFrameRate=True\nbSmoothFrameRate=False\nFixedFrameRate=30\nFrameRateLimit=30\n\n; Resolution and details\nr.ScreenPercentage=75             ; Renders the game at 75% of the native resolution for an FPS boost\nr.ViewDistanceScale=1.5           ; Reduces the view distance\nr.StaticMeshLODDistanceScale=1.5  ; Increases the use of LOD (Low-Detail Objects)\nr.SkeletalMeshLODBias=1           ; Reduces character quality at a distance\n\n; Shadows\nr.ShadowQuality=1                 ; Reduces shadow quality\nr.Shadow.MaxResolution=128        ; Limits shadow resolution\nr.Shadow.RadiusThreshold=0.05     ; Reduces shadows on small objects\nr.Shadow.DistanceScale=0.5        ; Decreases shadow range\n\n; Lighting and visual effects\nr.VolumetricFog=0                 ; Disables volumetric fog\nr.VolumetricCloud=0               ; Disables volumetric clouds\nr.MotionBlurQuality=0             ; Disables motion blur\nr.BloomQuality=0                  ; Disables bloom\nr.LensFlareQuality=0              ; Disables lens flares\nr.SceneColorFringeQuality=0       ; Disables chromatic aberration\nr.DepthOfFieldQuality=0           ; Disables depth of field\n\n; Textures and streaming\nr.TextureStreaming=1              ; Enables texture streaming\nr.Streaming.PoolSize=768          ; Texture pool size (for 12 GB of system RAM)\nr.MaxAnisotropy=16                ; Limits anisotropic filtering to 4x\n\n; Anti-aliasing\nr.TemporalAACurrentFrameWeight=0.2 ; Reduces temporal anti-aliasing artifacts\nr.TemporalAASamples=0             ; Adjusts temporal anti-aliasing samples\n\n; FPS optimization\nr.HZBOcclusion=0                  ; Disables hierarchical occlusion\nr.DistanceFieldShadowing=0        ; Disables distance field shadows\nr.GenerateMeshDistanceFields=0    ; Disables the generation of distance fields\n```\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Specifications: https://psref.lenovo.com/syspool/Sys/PDF/ThinkPad/ThinkPad_x13_Gen_2_AMD/ThinkPad_x13_Gen_2_AMD_Spec.PDF\n- Official service manual: https://download.lenovo.com/pccbbs/mobiles_pdf/t14s_gen2_x13_gen2_hmm_en.pdf\n- https://ubuntu.com/certified/202107-29283\n\n"
    }
  ]
}