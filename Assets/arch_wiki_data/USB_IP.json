{
  "title": "USB/IP",
  "url": "https://wiki.archlinux.org/title/USB/IP",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "From the USB/IP site:\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the usbip package.\n\n"
    },
    {
      "title": "Server setup",
      "level": 3,
      "content": "The server should have the physical USB device connected to it, and the usbip_host USB/IP kernel module loaded. Then start and enable the USB/IP systemd service usbipd.service. The daemon will accept connections on TCP port 3240.\n\nList the connected devices:\n\n```\n$ usbip list -l\n```\n\nBind the required device. For example, to share the device having busid 1-1.5:\n\n```\n# usbip bind -b 1-1.5\n```\n\nTo unbind the device:\n\n```\n# usbip unbind -b 1-1.5\n```\n\nAfter binding, the device can be accessed from the client.\n\n"
    },
    {
      "title": "Binding with systemd service",
      "level": 4,
      "content": "In order to make binding persistent following systemd template unit file can be used:\n\n```\n/etc/systemd/system/usbip-bind@.service\n```\n\n```\n[Unit]\nDescription=USB-IP Binding on bus id %I\nAfter=network-online.target usbipd.service\nWants=network-online.target\nRequires=usbipd.service\n#DefaultInstance=1-1.5\n\n[Service]\nType=simple\nExecStart=/usr/bin/usbip bind -b %i\nRemainAfterExit=yes\nExecStop=/usr/bin/usbip unbind -b %i  \nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n```\n\nSo, e.g., to share the device having busid 1-1, one should start/enable usbip-bind@1-1.service.\n\n"
    },
    {
      "title": "Client setup",
      "level": 3,
      "content": "Make sure the vhci-hcd kernel module is loaded.\n\nThen list devices available on the server:\n\n```\n$ usbip list -r server_IP_address\n```\n\nAttach the required device. For example, to attach the device having busid 1-1.5:\n\n```\n$ usbip attach -r server_IP_address -b 1-1.5\n```\n\n"
    },
    {
      "title": "Disconnecting devices",
      "level": 3,
      "content": "A device can be disconnected only after detaching it on the client.\n\nList attached devices:\n\n```\n$ usbip port\n```\n\nDetach the device:\n\n```\n$ usbip detach -p port_number\n```\n\nUnbind the device on the server:\n\n```\n$ usbip unbind -b busid\n```\n\n"
    },
    {
      "title": "Binding by vendor/device ID",
      "level": 3,
      "content": "If bus ids are inconsistent and dynamically assigned at each system boot, binding by vendor/device ID can be used alternatively:\n\n```\n/etc/systemd/system/usbip-bind@.service\n```\n\n```\n[Unit]\nDescription=USB-IP Binding device id %I\nAfter=network-online.target usbipd.service\nWants=network-online.target\nRequires=usbipd.service\n\n[Service]\nType=simple\nExecStart=/bin/sh -c \"/usr/sbin/usbip bind --$(/usr/sbin/usbip list -p -l | grep '#usbid=%i#' | cut '-d#' -f1)\"\nRemainAfterExit=yes\nExecStop=/bin/sh -c \"/usr/sbin/usbip unbind --$(/usr/sbin/usbip list -p -l | grep '#usbid=%i#' | cut '-d#' -f1)\"\nRestart=on-failure\n \n[Install]\nWantedBy=multi-user.target\n```\n\nSo, e.g., to share the device having vendor/device ID 0924:3d68, one should start/enable usbip-bind@0924:3d68.service.\n\nThen client setup will be like this:\n\n- Linux clients\n\n```\n$ usbip attach -r server_IP_address --$(/usr/sbin/usbip list -p -r server_IP_address | grep '#usbid=0924:3d68#' | cut '-d#' -f1)\n```\n\n```\n$ usbip attach -r server_IP_address -b $(/usr/sbin/usbip list -p -r server_IP_address | grep '0924:3d68' | cut '-d:' -f1 | awk '{print $1}')\n```\n\n- Windows clients\n\n```\nc:\\> for /f \"tokens=1 delims=:, \" %a in ('usbip list -r server_IP_address ^| findstr /r /c:\"0924:3d68\"') do start usbip attach -r server_IP_address -b %a\n```\n\n"
    },
    {
      "title": "Sharing devices configured with files in /etc/..",
      "level": 3,
      "content": "usbip-systemdAUR provides systemd service files for binding by vendor/device id and for connecting by hostname and vendor/device id.\n\n"
    },
    {
      "title": "Server setup",
      "level": 4,
      "content": "For each device create a device.conf in /etc/usbip/bind-devices/ with USBIP_DEVICE set to the vendor/product id, e.g.:\n\n```\n/etc/usbip/bind-devices/example-device.conf\n```\n\n```\nUSBIP_DEVICE=0924:3d68\n```\n\nTo bind a cofigured device start/enable the service usbip-bind@example-device.service\n\n"
    },
    {
      "title": "Client setup",
      "level": 4,
      "content": "For each host/device create a device.conf in /etc/usbip/remote-devices/ with HOST set and USBIP_DEVICE set to the vendor/product id, e.g.:\n\n```\n/etc/usbip/remote-devices/example-device.conf\n```\n\n```\nUSBIP_HOST=example-host\nUSBIP_DEVICE=0924:3d68\n```\n\nMake sure your server is running and the configured device is bound, then start or stop the service usbip@example-device.service\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Official USB/IP project site\n- Linux Kernel \"README for usbip-utils\"\n- \"How To Setup and use USB/IP\"\n- \"USB/IP for Windows\"\n- usbip(8)\n- usbipd(8)\n\n"
    }
  ]
}