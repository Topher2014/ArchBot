{
  "title": "Systemd-repart",
  "url": "https://wiki.archlinux.org/title/Systemd-repart",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "systemd-repart(8) is a tool for manipulating GUID Partition Tables (GPTs).\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "systemd-repart is part of systemd. It is also present on the Arch Linux installation ISO.\n\n"
    },
    {
      "title": "During Arch Linux Installation",
      "level": 3,
      "content": "systemd-repart can be used to create the necessary partitions during the Arch Linux installation process. Follow the steps below to set up your partitions.\n\nFirst, create the required repart.d(5) configuration files. The following examples illustrate how to define partitions; adjust the parameters as needed for your specific setup.\n\nCreate the directory for the repart configuration files:\n\n```\n# mkdir /etc/repart.d\n```\n\nThen, create the configuration files for each partition:\n\n```\n/etc/repart.d/00-esp.conf\n```\n\n```\n[Partition]\nType=esp\nSizeMinBytes=1G\nSizeMaxBytes=1G\nFormat=vfat\n```\n\n```\n/etc/repart.d/10-root.conf\n```\n\n```\n[Partition]\nType=root\nSizeMinBytes=23G\nEncrypt=tpm2\nFormat=btrfs\n```\n\n```\n/etc/repart.d/30-swap.conf\n```\n\n```\n[Partition]\nType=swap\nSizeMinBytes=4G\nSizeMaxBytes=4G\nEncrypt=tpm2\n```\n\n```\n/etc/repart.d/50-home.conf\n```\n\n```\n[Partition]\nType=home\nFormat=btrfs\n```\n\nAfter creating the configuration files, you can check the proposed changes by running:\n\n```\n# systemd-repart --empty=allow /dev/disk\n```\n\nIf the output meets your expectations, you can apply the changes by executing:\n\n```\n# systemd-repart --dry-run=no --empty=allow /dev/disk\n```\n\nThis command will create the partitions as specified in your configuration files, and automatically encrypt and/or format them if required. Ensure that you have backed up any important data before proceeding, as this operation may overwrite existing data on the specified disk.\n\nFor more advanced configurations, refer to repart.d(5).\n\nThen, mount the required partitions and proceed with the rest of the installation:\n\n```\n# cryptsetup open /dev/disk/by-partlabel/root-x86-64 root\n# mount /dev/mapper/root /mnt\n# mount -m /dev/disk/by-partlabel/esp /mnt/boot\n```\n\n"
    }
  ]
}