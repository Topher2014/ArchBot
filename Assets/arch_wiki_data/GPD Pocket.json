{
  "title": "GPD Pocket",
  "url": "https://wiki.archlinux.org/title/GPD_Pocket",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article or section does not follow the Laptop page guidelines.** This article or section does not follow the Laptop page guidelines.\n\nThis article or section does not follow the Laptop page guidelines.\n\nNotes for the GPD Pocket.\n\n"
    },
    {
      "title": "Specs",
      "level": 2,
      "content": "- Display: 7inch IPS 1920x1200\n- CPU: Intel Atom X7-Z8750\n- RAM: 8GB LPDDR3-1600\n- Storage: 128GB eMMC SSD (non-replaceable)\n- Battery: 7000mAh\n- WiFi: Broadcom 4356 802.11ac\n- Bluetooth: Broadcom 2045\n- Audio: Realtek ALC5645\n- Ports: 1 x USB 3 type A, 1 x MicroHDMI, 1 x USB 3 type C, 1 x 3.5mm Headphone Jack\n\n"
    },
    {
      "title": "Backlight and KMS",
      "level": 4,
      "content": "Change /etc/mkinitcpio.conf to match the following:\n\n```\n/etc/mkinitcpio.conf\n```\n\n```\n...\nMODULES=(i915 pwm-lpss-platform)\n...\n```\n\nThis will enable backlight control, and fix a black screen on resume from suspend.\n\n"
    },
    {
      "title": "Screen rotation",
      "level": 4,
      "content": "Thanks to a kernel patch, the linux kernel should automatically hint screen rotation for the GPD pocket. If it does not, or if you do not use a desktop manager, follow instructions below.\n\n"
    },
    {
      "title": "Wayland",
      "level": 4,
      "content": "To rotate the touchscreen, create:\n\n```\n/etc/udev/rules.d/99-goodix-touch.rules\n```\n\n```\nACTION==\"add|change\", KERNEL==\"event[0-9]*\", ATTRS{name}==\"Goodix Capacitive TouchScreen\", ENV{LIBINPUT_CALIBRATION_MATRIX}=\"0 1 0 -1 0 1\"\n```\n\nUnlike Xorg, under which right click emulation can be enabled by the standard Xorg configuration files, under Wayland, such configuration is supposed to be exposed by the compositor, and unfortunately, some compositors (e.g. GNOME Wayland) do not expose these configurations properly. However, the regarding functionality is still available in libinput. Since these compositors normally load /etc/profile.d, LD_PRELOAD can be used to hook into libinput and force apply these configurations.\n\nA sample implementation of this approach is available here.\n\n"
    },
    {
      "title": "Xorg",
      "level": 4,
      "content": "Create /etc/X11/xorg.conf.d/30-monitor.conf to rotate the monitor:\n\n```\n/etc/X11/xorg.conf.d/30-monitor.conf\n```\n\n```\nSection \"Monitor\"\n  Identifier \"DSI-1\"\n  Option     \"Rotate\" \"right\"\nEndSection\n```\n\nEdit ~/.config/monitors.xml (this file might not be present by default):\n\n```\n~/.config/monitors.xml\n```\n\n```\n<monitors version=\"2\">\n  <configuration>\n    <logicalmonitor>\n      <x>0</x>\n      <y>0</y>\n      <scale>2</scale>\n      <primary>yes</primary>\n      <transform>\n        <rotation>right</rotation>\n        <flipped>no</flipped>\n      </transform>\n      <monitor>\n        <monitorspec>\n          <connector>DSI-1</connector>\n          <vendor>unknown</vendor>\n          <product>unknown</product>\n          <serial>unknown</serial>\n        </monitorspec>\n        <mode>\n          <width>1200</width>\n          <height>1920</height>\n          <rate>60.384620666503906</rate>\n        </mode>\n      </monitor>\n    </logicalmonitor>\n  </configuration>\n</monitors>\n```\n\nThis sets the correct rotation (<rotation>right</rotation>) and a scale factor of 2 (<scale>2</scale>). For fractional scaling, see HiDPI#GNOME.\n\nFor GDM, copy the above ~/.config/monitors.xml to /var/lib/gdm/.config/monitors.xml to set the correct rotation.\n\nIn System Settings > Display and Monitor, change Orientation to 90Â° Clockwise, and Scale Display to a comfortable size.\n\nCreate /etc/X11/xorg.conf.d/50-trackpoint.conf to scroll while holding right click:\n\n```\n/etc/X11/xorg.conf.d/50-trackpoint.conf\n```\n\n```\nSection \"InputClass\"\n  Identifier      \"GPD trackpoint\"\n  MatchProduct    \"SINO WEALTH Gaming Keyboard\"\n  MatchIsPointer  \"on\"\n  Driver          \"libinput\"\n  Option          \"MiddleEmulation\" \"1\"\n  Option          \"ScrollButton\" \"3\"\n  Option          \"ScrollMethod\" \"button\"\nEndSection\n```\n\nTo change the DPI to be readable, append the following lines to /usr/share/sddm/scripts/Xsetup:\n\n```\n/usr/share/sddm/scripts/Xsetup\n```\n\n```\n# Set DPI  \nxrandr --dpi 168\"\n```\n\nInstall touchegg, then edit the following line in /usr/share/touchegg/touchegg.conf:\n\n```\n/usr/share/touchegg/touchegg.conf\n```\n\n```\n...\n<action type=\"SCROLL\">SPEED=7:INVERTED=true</action>\n...\n```\n\nCreate the following file:\n\n```\n/etc/X11/xinit/xinitrc.d/01_touchegg\n```\n\n```\n#!/bin/sh\n\n# starts touchegg application\nPREFIX=\"$HOME/.config/touchegg/.run\"\nmkdir -p \"$PREFIX\"\nPIDFILE=\"$PREFIX/touchegg.$USER$DISPLAY.pid\"\nLOCK=\"$PREFIX/touchegg.$USER$DISPLAY.lock\"\n\nstart_touchegg() {\n        (\n                flock -n 9 || exit 1\n                touchegg 2>/dev/null >/dev/null &\n                PID=$!\n                echo \"$!\" >\"$PIDFILE\"\n                wait $PID\n        ) 9>\"$LOCK\"\n}\n\nstart_touchegg &\n```\n\nAnd make it executable.\n\n"
    },
    {
      "title": "Fan",
      "level": 4,
      "content": "With the latest kernel, your fan should work out of the box.\n\n```\n# modprobe -r gpd-pocket-fan\n# modprobe gpd-pocket-fan temp_limits=40000,40001,40002\n```\n\nOnce this has been completed, you should hear your fan start up at 40c. If you hear a clicking sound, power off the device, remove the back panel and very gently push the fan around a few times. Then re-attach the panel and power on the device, running the above commands again once logged in. It seems to be an issue with some devices that the fan cannot start properly when it has not been powered on in a while.\n\nOnce you have completed these steps and the fan is working properly, you should then either reboot or reload the fan kernel module in order to return the temperature limits to default:\n\n```\n# modprobe -r gpd-pocket-fan\n# modprobe gpd-pocket-fan\n```\n\n"
    },
    {
      "title": "Power Saving",
      "level": 4,
      "content": "Install tlp and then edit following lines in /etc/default/tlp:\n\n```\n/etc/default/tlp\n```\n\n```\n...\n# improve disk IO\nDISK_DEVICES=\"mmcblk0\"\nDISK_IOSCHED=\"deadline\"\n...\n# disable wifi power saving mode (wifi speed drops MASSIVELY!)\nWIFI_PWR_ON_AC=off\nWIFI_PWR_ON_BAT=off\n...\n```\n\n"
    },
    {
      "title": "Audio",
      "level": 4,
      "content": "PulseAudio needs to be installed for the sound card.\n\nAppend the following lines into /etc/pulse/default.pa:\n\n```\n/etc/pulse/default.pa\n```\n\n```\nset-card-profile alsa_card.platform-cht-bsw-rt5645 HiFi\nset-default-sink alsa_output.platform-cht-bsw-rt5645.HiFi__hw_chtrt5645_0__sink\nset-sink-port alsa_output.platform-cht-bsw-rt5645.HiFi__hw_chtrt5645_0__sink [Out] Speaker\n```\n\nTurn off realtime scheduling by editing /etc/pulse/daemon.conf:\n\n```\n/etc/pulse/daemon.conf\n```\n\n```\nrealtime-scheduling = no\n```\n\n"
    },
    {
      "title": "Charge control",
      "level": 4,
      "content": "It is possible to control the charge current, charge end voltage and a few more settings.\n\nSee this reddit post for more information and an example script.\n\n"
    },
    {
      "title": "Known Issues",
      "level": 2,
      "content": "Note: **This article or section is out of date.** This article or section is out of date.\n\nThis article or section is out of date.\n\n"
    },
    {
      "title": "Wifi not seeing channels 12/13/14",
      "level": 3,
      "content": "As of May 2021 with current kernel and firmware versions, the Broadcom 4356 adapter no longer accesses networks on channels beyond the globally-allowed 1-11 range. Setting the regulatory domain with iw reg set <alpha2> does not fix this; apparently, the kernel driver does not support this. Instead, edit /usr/lib/firmware/brcm/brcmfmac4356-pcie.gpd-win-pocket.txt and change ccode=X2 to your country (e.g. ccode=DE enables channels 12/13 but not 14) and reboot (hint found in an older mailing list message).\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- https://github.com/njkli/gpd-pocket/\n- https://hansdegoede.livejournal.com/\n\n"
    }
  ]
}