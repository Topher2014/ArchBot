{
  "title": "Journal do systemd",
  "url": "https://wiki.archlinux.org/title/Journal_do_systemd",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "systemd tem o seu próprio sistema de registro chamado de o journal e, portanto, a execução de uma daemon syslog não é mais necessário. Para ler o registro, utilize:\n\n```\n# journalctl\n```\n\nNo Arch Linux, o diretório /var/log/journal/ faz parte do pacote systemd e o journal (quando Storage= está definido para auto em /etc/systemd/journald.conf) vai escrever para /var/log/journal/. Se você ou algum programa excluir esse diretório, systemd não vai recriá-lo automaticamente e, em vez disso,vai escrever seus logs em /run/systemd/journal em uma forma não persistente. Porém, a pasta será recriada quando você definir Storage=persistent e reiniciar systemd-journald.service (ou reinicializar o sistema).\n\nO journal do systemd classifica mensagens por nível de prioridade e facilidade. A classificação de registro de logs corresponde ao clássico protocolo do Syslog (RFC 5424).\n\n"
    },
    {
      "title": "Nível de prioridade",
      "level": 2,
      "content": "Um código de severidade do syslog (em systemd chamado de prioridade) é usado para marcar a importância de uma mensagem RFC 5424 Seção 6.2.1.\n\nTable content:\nValor | Severidade | Palavra-chave | Descrição | Exemplos\n0 | Emergência | emerg | Sistema não está usável | BUG de kernel severo, núcleo do systemd despejado.Esse nível não deve ser usado por aplicativos.\n1 | Alerta | alert | Deve ser corrigido imediatamente | Subsistema vital parou de funcionar. Perda de dados. kernel: BUG: unable to handle kernel paging request at ffffc90403238ffc.\n2 | Crítico | crit | Condições críticas | Travamentos, despejos de núcleo. Como flash familiar:systemd-coredump[25319]: Process 25310 (plugin-containe) of user 1000 dumped coreFalha no aplicativo de sistema principal, como o X11.\n3 | Erro | err | Condições de erro | Erro não severo relatado:kernel: usb 1-3: 3:1: cannot get freq at ep 0x84,systemd[1]: Failed unmounting /var.,libvirtd[1720]: internal error: Failed to initialize a valid firewall backend.\n4 | Aviso | warning | Pode indicar que um erro vai ocorrer se uma ação não for tomada. | Um sistema de arquivos não raiz tem apenas 1GB livre.org.freedesktop. Notifications[1860]: (process:5999): Gtk-WARNING **: Locale not supported by C library. Using the fallback 'C' locale.\n5 | Nota | notice | Eventos que são incomuns, mas não condições de erro. | systemd[1]: var.mount: Directory /var to mount over is not empty, mounting anyway. gcr-prompter[4997]: Gtk: GtkDialog mapped without a transient parent. This is discouraged.\n6 | Informacional | info | Mensagens de operação normais que exigem nenhuma ação. | lvm[585]: 7 logical volume(s) in volume group \"archvg\" now active.\n7 | Depuração | debug | Informações úteis para desenvolvedores para depurar o aplicativo. | kdeinit5[1900]: powerdevil: Scheduling inhibition from \":1.14\" \"firefox\" with cookie 13 and reason \"screen\".\n\nSe você não encontrar uma mensagem no nível de prioridade esperado, pesquise também alguns níveis acima e abaixo: essas regras são recomendações, e o desenvolvedor do aplicativo afetado pode ter uma percepção diferente da importância do problema.\n\n"
    },
    {
      "title": "Facilidade",
      "level": 2,
      "content": "Um código de facilidade syslog é usado para especificar o tipo de programa que está registrando a mensagem RFC 5424 Seção 6.2.1.\n\nTable content:\nCódigo de facilidade | Palavra-chave | Descrição | Informação\n0 | kern | mensagens de kernel\n1 | user | mensagens de nível de usuário\n2 | mail | sistema de correio | O POSIX arcaico ainda tem suporte e é por vezes usado (para mais mail(1))\n3 | daemon | daemons de sistemas | Todos os daemons, incluindo systemd e seus subsistemas\n4 | auth | mensagens de segurança/autorização | Também monitora a facilidade 10\n5 | syslog | mensagens geradas internamente pelo syslogd | Padronizado para syslog, não sendo usado pelo systemd (veja facilidade 3)\n6 | lpr | subsistema de impressora de linha (subsistema arcaico)\n7 | news | subsistema de notícias de rede (subsistema arcaico)\n8 | uucp | subsistema UUCP (subsistema arcaico)\n9 |  | daemon de relógio | systemd-timesyncd\n10 | authpriv | mensagens de segurança/autorização | Também monitora a facilidade 4\n11 | ftp | daemon FTP\n12 | - | subsistema NTP\n13 | - | auditoria de log\n14 | - | alerta de log\n15 | cron | daemon de agendamento\n16 | local0 | uso local 0 (local0)\n17 | local1 | uso local 1 (local1)\n18 | local2 | uso local 2 (local2)\n19 | local3 | uso local 3 (local3)\n20 | local4 | uso local 4 (local4)\n21 | local5 | uso local 5 (local5)\n22 | local6 | uso local 6 (local6)\n23 | local7 | uso local 7 (local7)\n\nEntão, facilidades que é útil monitorar: 0,1,3,4,9,10,15.\n\n"
    },
    {
      "title": "Filtrando saída",
      "level": 2,
      "content": "journalctl permite filtrar a saída por campos específicos. Esteja ciente de que, se houver muitas mensagens para exibir ou filtrar um grande intervalo de tempo, a saída desse comando poderá ser atrasada por algum tempo.\n\n```\n$ strings /mnt/arch/var/log/journal/af4967d77fba44c6b093d0e9862f6ddd/system.journal | grep -i mensagem\n```\n\nExemplos:\n\n- Mostrar todas mensagens desta inicialização: # journalctl -b No entanto, muitas vezes, alguém está interessado em mensagens que não são da atual, mas da inicialização anterior (por exemplo, se uma falha irrecuperável de sistema ocorrer). Isso é possível através do parâmetro de deslocamento opcional da opção -b: journalctl -b -0 mostra mensagens da inicialização atual, journalctl -b -1 da inicialização anterior, journalctl -b -2 da segunda anterior e por aí vai – você pode ver a lista de inicializações com seus números usando journalctl --list-boots. Veja journalctl(1) para descrição completa, a semântica é muito mais poderosa.\n- Mostrar todas as mensagens da data (e hora opcional): # journalctl --since=\"2012-10-30 18:17:16\"\n- Mostrar todas as mensagens desde 20 minutos atrás: # journalctl --since \"20 min ago\"\n- Seguir novas mensagens: # journalctl -f\n- Mostrar novas mensagens por um executável específico: # journalctl /usr/lib/systemd/systemd\n- Mostrar todas as mensagens por um processo específico: # journalctl _PID=1\n- Mostrar todas as mensagens por uma unit específica: # journalctl -u man-db.service\n- Mostrar o ring buffer do kernel: # journalctl -k\n- Mostrar apenas mensagens de prioridade de erro, crítico e alerta # journalctl -p err..alert Números também podem ser usados, journalctl -p 3..1. Se somente um número/uma palavra-chave usado(a), journalctl -p 3 - todos os níveis de prioridade maiores também são incluídos.\n- Mostrar equivalente a auth.log filtrando na facilidade do syslog: # journalctl SYSLOG_FACILITY=10\n- Se o diretório do journal (por padrão, localizado sob /var/log/journal) contém quantidade imensa de dados de log, então journalctl pode levar vários minutos filtrando a saída. Você pode acelerar significativamente usando a opção --file para forçar o journalctl a procurar apenas no journal mais recente: # journalctl --file /var/log/journal/*/system.journal -f\n\n```\n# journalctl -b\n```\n\n```\n# journalctl --since=\"2012-10-30 18:17:16\"\n```\n\n```\n# journalctl --since \"20 min ago\"\n```\n\n```\n# journalctl -f\n```\n\n```\n# journalctl /usr/lib/systemd/systemd\n```\n\n```\n# journalctl _PID=1\n```\n\n```\n# journalctl -u man-db.service\n```\n\n```\n# journalctl -k\n```\n\n```\n# journalctl -p err..alert\n```\n\n```\n# journalctl SYSLOG_FACILITY=10\n```\n\n```\n# journalctl --file /var/log/journal/*/system.journal -f\n```\n\nVeja journalctl(1), systemd.journal-fields(7) ou a publicação de blogue do Lennart para detalhes.\n\nNote: Ao omitir a opção S, a saída estará sob wrap em vez de truncamento. Por exemplo, inicie journalctl da seguinte forma:\n\nAo omitir a opção S, a saída estará sob wrap em vez de truncamento. Por exemplo, inicie journalctl da seguinte forma:\n\n```\n$ SYSTEMD_LESS=FRXMK journalctl\n```\n\n"
    },
    {
      "title": "Limite no tamanho do journal",
      "level": 2,
      "content": "Se o journal é persistente (não volátil), seu tamanho limite é definido para um valor padrão de 10% do tamanho do respectivo sistema de arquivos, mas limitado a 4 GB. Por exemplo, com o /var/log/journal localizado em uma partição de 20 GB, o journal pode usar até 2 GB. Em uma partição de 50 GB, ela usaria no máximo até 4 GB.\n\nO tamanho máximo do journal persistente pode ser controlado removendo o comentário e alterando o seguinte:\n\n```\n/etc/systemd/journald.conf\n```\n\n```\nSystemMaxUse=50M\n```\n\nTambém é possível usar o mecanismo de substituição de configuração de snippets de drop-in, em vez de editar o arquivo de configuração global. Neste caso, não esqueça de colocar as sobrescrições no cabeçalho [Journal]:\n\n```\n/etc/systemd/journald.conf.d/00-journal-size.conf\n```\n\n```\n[Journal]\nSystemMaxUse=50M\n```\n\nReinicie o systemd-journald.service após alterar essa configuração para aplicar imediatamente o novo limite.\n\nVeja journald.conf(5) para mais informações.\n\n"
    },
    {
      "title": "Limpar arquivos de journal manualmente",
      "level": 2,
      "content": "Os arquivos de journal podem ser removidos globalmente de /var/log/journal/ usando, por exemplo, rm ou podem ser aparados de acordo com vários critérios usando journalctl . Exemplos:\n\n- Remova arquivos de journal armazenados até que o espaço em disco que eles usam fique abaixo de 100 MB: # journalctl --vacuum-size=100M\n- Faça com que todos os arquivos de diário não contenham dados com mais de 2 semanas. # journalctl --vacuum-time=2weeks\n\n```\n# journalctl --vacuum-size=100M\n```\n\n```\n# journalctl --vacuum-time=2weeks\n```\n\nVeja journalctl(1) para mais informações.\n\n"
    },
    {
      "title": "Journald em conjunto com o syslog",
      "level": 2,
      "content": "Compatibilidade com uma implementação clássica, sem journald, do syslog pode ser fornecida deixando o systemd encaminhar todas as mensagens pelo soquete /run/systemd/journal/syslog. Para fazer funcionar o daemon do syslog com o journal, ele tem que associar a este soquete em vez de /dev/log (anúncio oficial).\n\nO journald.conf padrão para encaminhar para o soquete é ForwardToSyslog=no para evitar sobrecarga de sistema, porque rsyslog ou syslog-ng obtêm as mensagens do journal eles mesmo.\n\nVeja Syslog-ng#Overview e Syslog-ng#syslog-ng and systemd journal e rsyslog, para detalhes sobre a configuração.\n\n"
    },
    {
      "title": "Encaminhar journald para /dev/tty12",
      "level": 2,
      "content": "Crie um diretório de drop-in /etc/systemd/journald.conf.d e crie um arquivo fw-tty12.conf nele:\n\n```\n/etc/systemd/journald.conf.d/fw-tty12.conf\n```\n\n```\n[Journal]\nForwardToConsole=yes\nTTYPath=/dev/tty12\nMaxLevelConsole=info\n```\n\nEntão, reinicie systemd-journald.service.\n\n"
    },
    {
      "title": "Especificar um journal diferente para ver",
      "level": 2,
      "content": "Pode ser necessário verificar os logs de outro sistema que esteja inativo na água, como a inicialização de um sistema ativo para recuperar um sistema de produção. Nesse caso, pode-se montar o disco em, p. ex., /mnt e especificar o caminho do journal via -D/--directory, assim:\n\n```\n$ journalctl -D /mnt/var/log/journal -xe\n```\n\n"
    }
  ]
}