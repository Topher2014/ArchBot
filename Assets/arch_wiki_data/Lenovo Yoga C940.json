{
  "title": "Lenovo Yoga C940",
  "url": "https://wiki.archlinux.org/title/Lenovo_Yoga_C940",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Table content:\nHardware | PCI/USB ID | Working?\nTouchpad | 06cb:00be | Yes\nKeyboard | PS/2 | Yes\nTouchscreen | 056a:51e6 | Yes\nStylus | 056a:51e6 | Yes\nVideo | 8086:8a52 | Yes\nWebcam (Acer) | 5986:2115 | Yes\nWebcam (IMC) | 13d3:56b2 | Yes\nBluetooth | 8087:0026 | Yes\nAudio | 8086:34c8 | Partial\nWireless | 8086:34f0 | Yes\nFingerprint Reader | 06cb:00be 27c6:55b4 | Partial\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "To access the boot menu and UEFI, use F1. Disable Secure Boot. UEFI boot works fine.\n\n"
    },
    {
      "title": "Accessibility",
      "level": 2,
      "content": "The UEFI user interface (both Vanilla and patched âˆ’ see #Audio) is graphical. An option to switch to a text-based GUI is not provided. However, the options may be selected with the arrow keys and the values changed with F5 and F6 keys.\n\n"
    },
    {
      "title": "Function keys",
      "level": 2,
      "content": "By default, the Fn key does not need to be pressed to toggle the alternative function of the FX keys, and Fn+FX actually sends the FX key signal. This behavior can be reversed in the UEFI.\n\nTable content:\nKey | Visible?1 | Marked?2 | Effect\nF1 | Yes | Yes | XF86AudioMute\nF2 | Yes | Yes | XF86AudioLowerVolume\nF3 | Yes | Yes | XF86AudioRaiseVolume\nF4 | Yes | Yes | XF86AudioMicMute\nF5 | Yes | Yes | F5 (No change, despite the \"Refresh\" pictogram)\nF6 | Yes | Yes | XF86TouchpadOn/XF86TouchpadOff\nF7 | Yes | Yes | XF86RFKill\nF8 | Yes | Yes | XF86WebCam\nF9 | Yes | Yes | Super+l4\nF10 | Yes | Yes | Super+p4\nF11 | Yes | Yes | XF86MonBrightnessUp\nF12 | Yes | Yes | XF86MonBrightnessDown\nFn+Left | Yes | Yes | Home\nFn+Right | Yes | Yes | End\nFn+Up | Yes | Yes | PageUp\nFn+Down | Yes | Yes | PageDown\nFn+Space | No | Yes | Changes keyboard backlight\n\n1. The key is visible to xev and similar tools.\n1. The physical key has a symbol on it, which describes its function.\n1. systemd-logind handles this by default.\n1. Press and release signals are sent on physical key press, nothing occurs on physical release.\n\n"
    },
    {
      "title": "Video",
      "level": 2,
      "content": "By default on Xorg, tearing is apparent when playing videos. See Intel graphics#Tearing.\n\nThere seems to be issues with Chromium based GPU acceleration, see Intel graphics#Corruption or unresponsiveness in Chromium and Firefox.\n\n"
    },
    {
      "title": "Audio",
      "level": 2,
      "content": "This laptop is equipped with 2+2 speaker combo: two on the hinge (\"front speaker\") and two on the bottom (wired on a single \"bass\" channel). The latter requires a custom initialization sequence that is not supported on mainline Linux (see bugzilla.kernel.org#205755). Therefore, two options are possible: either use the vanilla configuration and rely only on the front speakers, or flash a beta BIOS an activate the full speaker array. In both cases, Sound Open Firmware is required in order for the soundcard to work.\n\n"
    },
    {
      "title": "Vanilla configuration",
      "level": 3,
      "content": "You need to blacklist the snd_hda_intel and snd_soc_skl modules for the soundcard to correctly work.\n\n"
    },
    {
      "title": "Using a beta BIOS",
      "level": 3,
      "content": "There exists an unreleased patched BIOS (from Lenovo) that initialize correctly the bass speakers, see comment 59. It is now only available on a mirror, which details the flashing procedure.\n\nIf you did not follow the former advice and bricked your device, a procedure exists to emergency flash the BIOS, which can also be used to downgrade it:\n\n- Format a USB key to FAT32\n- Copy the desired BIOS on the key (or the one provided in this post, guaranteed to work), and rename it to Veyron.fd\n- (Force) shut down the computer, and plug it on AC power.\n- Insert the USB key\n- Boot while maintaining the key Fn+R during 10 seconds\n\nThe power indicator should blink orange rapidly, and the screen backlight will turn on after 2-3 minutes. Then, a scrambled progress bar will appear and slowly filled. Once completed, the computer will reboot with the desired BIOS restored.\n\n"
    },
    {
      "title": "Thermals",
      "level": 2,
      "content": "Thermal shutdowns are a problem unless you install pstate-frequencyAUR or thermald.\n\n"
    },
    {
      "title": "pstate-frequency",
      "level": 3,
      "content": "pstate-frequencyAUR allows the user to define Turbo Boost behavior and maximum clock frequencies. The user should activate pstate-frequency.service and pstate-frequency-sleep.service for the setting to persist after suspend or reboot. Configuration files are located in /etc/pstate-frequency.d/.\n\nChanging the line PLAN_CPU_MAX=100 to PLAN_CPU_MAX=70 in /etc/pstate-frequency.d/02-balanced.plan will throttle the maximum clock speed from 3.90 GHz to 2.70 GHz on AC. Moreover, the default plan of pstate-frequency will throttle the CPU to 30 % (around 1.2 GHz; see /etc/pstate-frequency.d/01-powersave.plan) on battery power, removing the issue of thermal shutdowns.\n\n"
    },
    {
      "title": "thermald",
      "level": 3,
      "content": "A few changes are necessary for thermald to work as intended:\n\nAdd the following thermald config:\n\n```\n/etc/thermald/thermal-conf.xml\n```\n\n```\n<?xml version=\"1.0\"?>\n <!-- BEGIN -->\n <ThermalConfiguration>\n <Platform>\n\t<Name> Auto generated </Name>\n\t<ProductName>81Q9</ProductName>\n\t<Preference>QUIET</Preference>\n\t<ThermalZones>\n\t\t<ThermalZone>\n\t\t\t<Type>auto_zone_0</Type>\n\t\t\t<TripPoints>\n\t\t\t\t<TripPoint>\n\t\t\t\t\t<SensorType>SEN2</SensorType>\n\t\t\t\t\t<Temperature>80000</Temperature>\n\t\t\t\t\t<Type>Passive</Type>\n\t\t\t\t\t<CoolingDevice>\n\t\t\t\t\t\t<Type>B0D4</Type>\n\t\t\t\t\t\t<SamplingPeriod>8</SamplingPeriod>\n\t\t\t\t\t\t<TargetState>2147483647</TargetState>\n\t\t\t\t\t</CoolingDevice>\n\t\t\t\t</TripPoint>\n\t\t\t\t<TripPoint>\n\t\t\t\t\t<SensorType>x86_pkg_temp</SensorType>\n\t\t\t\t\t<Temperature>80000</Temperature>\n\t\t\t\t\t<Type>Passive</Type>\n\t\t\t\t\t<CoolingDevice>\n\t\t\t\t\t\t<Type>Processor</Type>\n\t\t\t\t\t\t<SamplingPeriod>1</SamplingPeriod>\n\t\t\t\t\t</CoolingDevice>\n\t\t\t\t</TripPoint>\n\t\t\t</TripPoints>\n\t\t</ThermalZone>\n\t</ThermalZones>\n</Platform>\n</ThermalConfiguration>\n<!-- END -->\n```\n\nYou might wish to tweak the target temperature (i.e. 64000) if you are OK with your machine running a bit hotter.\n\nEdit thermald.service and remove --adaptive and add --ignore-default-control to the ExecStart line:\n\n```\nExecStart=/usr/bin/thermald --systemd --dbus-enable --ignore-default-control\n```\n\nManual fan control does not work at all.\n\n"
    },
    {
      "title": "Power management",
      "level": 2,
      "content": "Battery Conservation Mode (charge to max 50%) can be set with:\n\n```\n# echo 1 > /sys/bus/platform/drivers/ideapad_acpi/VPC2004\\:00/conservation_mode\n```\n\nwhere VPC2004\\:00 could vary depending on the model.\n\nIf shutdown is not working and the system hangs on \"reboot: Shutting down\", try adding intel_iommu=off to your Kernel parameters.\n\n"
    },
    {
      "title": "Tablet mode",
      "level": 2,
      "content": "By default, the kernel cannot detect when the device is folded keyboard-down (360 tablet mode), yoga-usage-mode-dkms-gitAUR adds a driver. If the desktop environment supports it (eg. KDE, Gnome, Sway) then the touchpad and keyboard will be disabled when the device is folded by default, and may offer more touch-friendly functionality.\n\n"
    },
    {
      "title": "Fingerprint reader",
      "level": 2,
      "content": "Fingerprint reader requires a beta custom library based on a reverse-engineered Windows driver, libfprint-2-tod1-synatudor-gitAUR. Once installed, the fingerprint reader must be configured following fprint's procedure.\n\nIf you have the goodix reader (27c6:55b4), you can use this driver libfprint-goodixtls-55x4AUR. Note: you will need to flash your device with goodix-fp-dump to use this\n\n"
    }
  ]
}