{
  "title": "Valkey",
  "url": "https://wiki.archlinux.org/title/Valkey",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "From Wikipedia:Valkey:\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the valkey package.\n\nStart/enable valkey.service.\n\n"
    },
    {
      "title": "Client-side software",
      "level": 3,
      "content": "- Python: python-redis\n- PHP: php-redis\n- C: hiredis\n\n"
    },
    {
      "title": "Configuration",
      "level": 2,
      "content": "The Valkey configuration file is well-documented and located at /etc/valkey/valkey.conf.\n\n- Accept connections on the specified port (default is 6379), specify port 0 to disable listening on TCP:\n\n```\nport 6379\n```\n\n"
    },
    {
      "title": "Listen on socket",
      "level": 3,
      "content": "Using Valkey over a Unix socket may give a performance increase, compared to TCP/IP [1].\n\nThe following changes should be made in /etc/valkey/valkey.conf to enable use of the unix socket:\n\n- Enable and update the Valkey socket path:\n\n```\nunixsocket /run/valkey/valkey.sock\n```\n\n- Set permission to the socket to all members of the valkey user group:\n\n```\nunixsocketperm 770\n```\n\n- Add users (e.g. \"git\", \"http\") to the valkey user group so they can access and use the socket.\n\nFinally restart the valkey.service.\n\n"
    },
    {
      "title": "Warning about Transparent Huge Pages (THP)",
      "level": 3,
      "content": "To solve warning messages as \"you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Valkey\", you may want to permanently disable this feature:\n\n```\n/etc/tmpfiles.d/valkey.conf\n```\n\n```\nw /sys/kernel/mm/transparent_hugepage/enabled - - - - never\nw /sys/kernel/mm/transparent_hugepage/defrag - - - - never\n```\n\n"
    },
    {
      "title": "Warning about TCP backlog",
      "level": 3,
      "content": "To solve warning messages as \"The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128\", increase the current value:\n\n```\n/etc/sysctl.d/99-sysctl.conf\n```\n\n```\nnet.core.somaxconn=512\n```\n\n"
    },
    {
      "title": "Warning about overcommit_memory is set to 0",
      "level": 3,
      "content": "To solve warning messages as \"overcommit_memory is set to 0! Background save may fail under low memory condition\":\n\n```\n/etc/sysctl.d/99-sysctl.conf\n```\n\n```\nvm.overcommit_memory=1\n```\n\n"
    }
  ]
}