{
  "title": "DNS-over-HTTPS",
  "url": "https://wiki.archlinux.org/title/DNS-over-HTTPS",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Related articles\n\n- DNS over HTTPS servers\n\nDNS-over-HTTPS is an implementation of DNS over HTTPS. It can act as a stub resolver.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the dns-over-https package.\n\n"
    },
    {
      "title": "Disable any services bound to port 53",
      "level": 3,
      "content": "To see if any programs are using port 53, run:\n\n```\n$ ss -lp 'sport = :domain'\n```\n\nIf the output contains more than the first line of column names, you need to disable whatever service is using port 53. You are ready to proceed once the above command outputs nothing more than the following line:\n\n```\nNetid State   Recv-Q  Send-Q   Local Address:Port     Peer Address:Port Process\n```\n\n"
    },
    {
      "title": "Change system DNS server",
      "level": 3,
      "content": "Change your system's DNS server to an address in the listen = section of the configuration file. If you don't know what you're doing, 127.0.0.1 is recommended.\n\nThis can be accomplished either through your Network Manager or through editing /etc/resolv.conf.\n\n"
    },
    {
      "title": "Startup",
      "level": 3,
      "content": "Start or enable doh-client.service.\n\n"
    },
    {
      "title": "Test configuration",
      "level": 3,
      "content": "To test if your system's DNS works, type nslookup www.google.com into the command line. Note that this will work before DNS-over-HTTPS is configured, assuming you had a DNS configuration before installing this.\n\n"
    },
    {
      "title": "Client configuration",
      "level": 2,
      "content": "The client configuration file is /etc/dns-over-https/doh-client.conf by default\n\n"
    },
    {
      "title": "Select preferred upstream DNS server",
      "level": 3,
      "content": "To select a preferred DNS server, uncomment one of the profiles.\n\nIf your preferred server is not listed, you may use the following template in the [upstream] section.\n\n```\n/etc/dns-over-https/doh-client.conf\n```\n\n```\n[[upstream.upstream_ietf]]\n    url = \"https://IP_or_web_address/dns-query\"\n    weight = 20\n```\n\n"
    },
    {
      "title": "Service does not start properly in wired connection",
      "level": 3,
      "content": "As explained by the developer:\n\nUpstream suggests to use a drop-in snippet to your service file to:\n\n```\n/etc/systemd/system/doh-client.service.d/override.conf\n```\n\n```\n[Unit]\nAfter=multi-user.target\n\n[Service]\nType=idle\n```\n\n"
    }
  ]
}