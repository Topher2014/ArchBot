{
  "title": "Wallabag",
  "url": "https://wiki.archlinux.org/title/Wallabag",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "wallabag is a self hostable application for saving web pages.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the wallabag package.\n\n"
    },
    {
      "title": "PHP",
      "level": 3,
      "content": "Configure php to allow wallabag in /usr/share/wallabag to work and configure wallabag using /etc/wallabag/parameters.yml.\n\nGive the wallabag user write permissions to /usr/share/wallabag/var/cache/prod/\n\nA list of required php modules can be found here. The following snippet is provided for brevity.\n\n```\n/etc/php/conf.d/wallabag.ini\n```\n\n```\nextension=bcmath\nextension=gd\nextension=gettext\nextension=iconv\nextension=intl\nextension=tidy\n\n; database - sqlite\n;extension=pdo_sqlite\n;extension=sqlite3\n\n; database - pgsql\n;extension=pdo_pgsql\n;extension=pgsql\n```\n\n"
    },
    {
      "title": "Wallabag",
      "level": 3,
      "content": "Once wallabag has been properly configured, commands must be run as the wallabag user in order to initialise the database and application state.\n\n```\n[wallabag]$ cd /usr/share/wallabag\n[wallabag]$ php bin/console cache:clear\n[wallabag]$ php bin/console wallabag:install\n```\n\n"
    },
    {
      "title": "Database",
      "level": 2,
      "content": "Supported databases are:\n\n- PostgreSQL\n- MariaDB\n\nThe setup and configuration are not covered here.\n\n"
    },
    {
      "title": "php-fpm",
      "level": 3,
      "content": "It is recommended to make a copy of /etc/php/php-fpm.d/www.conf and modify that. If you want to use it, you must change listen to the one which is different from /run/php-fpm/php-fpm.sock\n\n```\n/etc/php/php-fpm.d/wallabag.conf\n```\n\n```\n[wallabag]\n\nuser = wallabag\ngroup = wallabag\nlisten = /run/php-fpm/php-fpm-wallabag.sock\n```\n\n"
    },
    {
      "title": "nginx",
      "level": 3,
      "content": "The below configuration is sourced from upstream documentation and slightly amended and modified based on custom php-fpm configure:\n\n```\n/etc/nginx/example.conf\n```\n\n```\nserver {\n    server_name domain.tld www.domain.tld;\n    root /usr/share/wallabag/web;\n\n    location / {\n        # try to serve file directly, fallback to app.php\n        try_files $uri /app.php$is_args$args;\n    }\n    location ~ ^/app\\.php(/|$) {\n        fastcgi_pass unix:/run/php-fpm/php-fpm-wallabag.sock;\n        fastcgi_split_path_info ^(.+\\.php)(/.*)$;\n        include fastcgi_params;\n        # When you are using symlinks to link the document root to the\n        # current version of your application, you should pass the real\n        # application path instead of the path to the symlink to PHP\n        # FPM.\n        # Otherwise, PHP's OPcache may not properly detect changes to\n        # your PHP files (see https://github.com/zendtech/ZendOptimizerPlus/issues/126\n        # for more information).\n        fastcgi_param  SCRIPT_FILENAME  $realpath_root$fastcgi_script_name;\n        fastcgi_param DOCUMENT_ROOT $realpath_root;\n        # Prevents URIs that include the front controller. This will 404:\n        # http://domain.tld/app.php/some-path\n        # Remove the internal directive to allow URIs like this\n        internal;\n    }\n\n    # return 404 for all other php files not matching the front controller\n    # this prevents access to other php files you don't want to be accessible.\n    location ~ \\.php$ {\n        return 404;\n    }\n\n    error_log /var/log/nginx/wallabag_error.log;\n    access_log /var/log/nginx/wallabag_access.log;\n}\n```\n\nGeneric configuration for other web servers can be found upstream.\n\n"
    },
    {
      "title": "Upgrading between versions",
      "level": 3,
      "content": "There are upgrade instructions available, dependent on the old and new versions. Generally, cache must be cleaned and database migrations performed by the wallabag user, as shown below.\n\n```\n[wallabag]$ cd /usr/share/wallabag\n[wallabag]$ php bin/console cache:clear\n[wallabag]$ php bin/console doctrine:migrations:migrate\n```\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Wallabag documentation\n- Source repository\n\n"
    }
  ]
}