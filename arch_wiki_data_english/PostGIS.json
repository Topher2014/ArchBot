{
  "title": "PostGIS",
  "url": "https://wiki.archlinux.org/title/PostGIS",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.** This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nThis article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nPostGIS adds support for geographic objects in the PostgreSQL database. This document describes the process for installing PostGIS and creating a template PostGIS database. It is assumed that PostgreSQL has been installed. If it has not, please refer to the PostgreSQL page.\n\n"
    },
    {
      "title": "Installing PostGIS",
      "level": 2,
      "content": "Install the postgis package.\n\n"
    },
    {
      "title": "Installing PostGIS Extension",
      "level": 2,
      "content": "Since PostgreSQL 9.1, the preferred approach is to install PostGIS and enable postgis extension for each spatial database.\n\n```\n$ psql\n```\n\n```\n-- verify available extensions\n SELECT name, default_version,installed_version \n FROM pg_available_extensions WHERE name LIKE 'postgis%'Â ;\n \n -- install extension for spatial database mygisdb\n \\c mygisdb\n CREATE EXTENSION postgis;\n CREATE EXTENSION postgis_topology;\n CREATE EXTENSION fuzzystrmatch;\n CREATE EXTENSION postgis_tiger_geocoder;\n```\n\nYou do not need to do the below \"Creating a Template PostGIS Database\" step if you use PostGIS extension.\n\n- upgrade postgis extension\n\n```\n$ psql\n```\n\n```\nALTER EXTENSION postgis UPDATE TO \"2.1.0\";\n```\n\n- migrate spatial database created with postgis_template\n\nDump and drop the spatial database, re-create a spatial database with extension, and restore the dumped database. Follow https://www.postgis.net/docs/postgis_installation.html#hard_upgrade for specific commands.\n\n"
    },
    {
      "title": "Creating a Template PostGIS Database",
      "level": 2,
      "content": "- Become the postgres user.\n\n```\n# su - postgres\n```\n\n- If you have not created a superuser for accessing PostgreSQL, you may want do that now. You will be prompted for granting permissions to that user.\n\n```\n$ createuser [username]\n```\n\n- Create a new database called \"template_postgis\".\n\n```\n$ createdb -O [username] template_postgis -E UTF-8\n```\n\n- Load the PostGIS spatial types for PostgreSQL and spatial reference systems. \"postgis.sql\" and \"spatial_ref_sys.sql\" are part of the installation of PostGIS, and may reside somewhere else besides \"/usr/sharepostgresql/contrib/postgis-2.1/\" depending on the installation. (Below is for default postgis 2.1 installation)\n\n```\n$ psql -d template_postgis -f /usr/share/postgresql/contrib/postgis-2.1/postgis.sql\n$ psql -d template_postgis -f /usr/share/postgresql/contrib/postgis-2.1/spatial_ref_sys.sql\n```\n\n- Make it a real template.\n\n```\n$ psql\n```\n\n```\nUPDATE pg_database SET datistemplate = TRUE WHERE datname = 'template_postgis';\n```\n\n"
    },
    {
      "title": "Creating a PostGIS Database From the Template",
      "level": 2,
      "content": "It is common practice to reserve a bare template for creating new PostGIS databases. As a PostgreSQL superuser, the following command will create a new database:\n\n```\n$ createdb -T template_postgis [new_postgis_db]\n```\n\n"
    },
    {
      "title": "Upgrading PostgreSQL with PostGIS",
      "level": 2,
      "content": "If you want to upgrade PostgreSQL using pg_upgrade with postgresql-old-upgrade, you can install postgis-old-upgradeAUR before upgrade.\n\n"
    },
    {
      "title": "More Resources",
      "level": 2,
      "content": "For additional resources concerning PostGIS, check out the PostGIS Documentation.\n\n"
    },
    {
      "title": "PostGIS failing with json_tokener_error",
      "level": 2,
      "content": "This happends when adding postgis as an extension. The libjson-c package has changed, and PostGIS has not put out a stable release with this yet. It is in 2.1.0rc1, though. The bug-report is https://trac.osgeo.org/postgis/ticket/2213\n\nThe fix is to download the postgis PKGBUILD and then change the version to '2.1.0rc1'. Do not forget to change the sha256sum.\n\n"
    }
  ]
}