{
  "title": "Overlay filesystem",
  "url": "https://wiki.archlinux.org/title/Overlay_filesystem",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "From the initial kernel commit:\n\nOverlayfs has been in the Linux kernel since 3.18.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Overlayfs is enabled in the default kernel and the overlay kernel module is automatically loaded upon issuing a mount command.\n\n"
    },
    {
      "title": "Usage",
      "level": 2,
      "content": "To mount an overlay use the following mount options:\n\n```\n# mount -t overlay overlay -o lowerdir=/lower,upperdir=/upper,workdir=/work /merged\n```\n\n- The lower directory can be read-only or could be an overlay itself.\n- The upper directory is normally writable.\n- The workdir is used to prepare files as they are switched between the layers.\n\nThe lower directory can actually be a list of directories separated by :, all changes in the merged directory are still reflected in upper.\n\nExample:\n\n```\n# mount -t overlay overlay -o lowerdir=/lower1:/lower2:/lower3,upperdir=/upper,workdir=/work /merged\n```\n\nNote: The above example will have the order:\n\nThe above example will have the order:\n\n```\n/upper\n/lower1 \n/lower2\n/lower3\n```\n\nTo add an overlayfs entry to /etc/fstab use the following format:\n\n```\n/etc/fstab\n```\n\n```\noverlay /merged overlay noauto,x-systemd.automount,lowerdir=/lower,upperdir=/upper,workdir=/work 0 0\n```\n\nThe noauto and x-systemd.automount mount options are necessary to prevent systemd from hanging on boot because it failed to mount the overlay. The overlay is now mounted whenever it is first accessed and requests are buffered until it is ready. See fstab#Automount with systemd.\n\n"
    },
    {
      "title": "Read-only overlay",
      "level": 3,
      "content": "Sometimes, it is only desired to create a read-only view of the combination of two or more directories. In that case, it can be created in an easier manner, as the directories upper and work are not required:\n\n```\n# mount -t overlay overlay -o lowerdir=/lower1:/lower2 /merged\n```\n\nWhen upperdir is not specified, the overlay is automatically mounted as read-only.\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Overlay Filesystem documentation\n- Explaining overlayfs - What it does and how it works\n- Wikipedia:OverlayFS\n\n"
    }
  ]
}