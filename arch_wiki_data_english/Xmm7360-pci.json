{
  "title": "Xmm7360-pci",
  "url": "https://wiki.archlinux.org/title/Xmm7360-pci",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Thinkpads with an AMD processor since 2020 (e.g. Lenovo Thinkpad L/T14 (AMD) Gen 1, Lenovo ThinkPad T14s (AMD) Gen 1, Lenovo Thinkpad L15 (AMD) Gen 1) connect only PCIe to the LTE modem.\n\nFibocom \"supports\" Linux only in USB mode. There is no sign of an official driver being developed. For newer generations (L860 ?), Lenovo is developing a driver.\n\nTo get this hardware working on Linux, the only solution is an alpha stage driver, written with Python 3, found at https://github.com/xmm7360/xmm7360-pci.\n\nThis driver is intended to work with Fibocom L850-GL LTE, without switching to USB (since it is not supported on AMD models) but with direct commands to the modem. To verify if you have this hardware, do the following:\n\n```\n$ lspci -nnd 8086:7360\n```\n\n```\n05:00.0 Wireless controller [0d40]: Intel Corporation XMM7360 LTE Advanced Modem [8086:7360] (rev 01)\n```\n\n"
    },
    {
      "title": "Preparation",
      "level": 2,
      "content": "```\nINFO:root:Attach failed - waiting to see if we just weren't ready\n```\n\nInstall linux-headers, base-devel) along with acpi_call, python-pyroute2 and python-configargparse\n\nRemove the PIN in Windows and check that it is a working card.\n\nAlternatively echo the PIN with\n\n```\n# echo \"AT+CPIN=\\\"0000\\\"\" >> /dev/ttyXMM1\n```\n\nafter the make && make load steps.\n\nReplace 0000 with your pin code. (c.f. https://github.com/xmm7360/xmm7360-pci/pull/21/files)\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Note: **The factual accuracy of this article or section is disputed.** The factual accuracy of this article or section is disputed.\n\nThe factual accuracy of this article or section is disputed.\n\n```\n$ git clone https://github.com/xmm7360/xmm7360-pci.git\n$ cd xmm7360-pci\n$ make && make load\n# python3 rpc/open_xdatachannel.py --apn apn.url\n# echo \"nameserver 1.1.1.1\" >> /etc/resolv.conf\n# ip link set wwan0 up\n```\n\n"
    },
    {
      "title": "Linux Kernel support and Modem Manager integration",
      "level": 2,
      "content": "Support for this device has been added since Linux 5.18 (see torvalds/linux@1f52d7b). ModemManager accesses such WWAN modems via MBIM interface, provided by the iosm kernel module. The GL-860 does provide a MBIM interface, the GL-850 does not. Fibocom/Intel don't seem to care, there is no announcement/rumor that they will be implementing it.\n\nThat is why xmm7360-pci/issue/31 correctly states that even with the kernel driver, the modem doesn't work: With iosm kernel module loaded, the interface shows up as /dev/wwan0at0 and /dev/wwan0at1, and is seen by mmcli -L, but journalctl yields SIM not inserted:\n\n```\nModemManager:   <info>  [device /sys/devices/pci0000:00/0000:00:02.5/0000:05:00.0]\n                        creating modem with plugin 'Intel' and '3' ports\nModemManager:   <warn>  [plugin/intel] could not grab port wwan0at0:\n                        Cannot add port 'wwan/wwan0at0', unhandled port type\nModemManager:   <info>  [base-manager] modem for device '/sys/devices/pci0000:00/0000:00:02.5/0000:05:00.0'\n                        successfully created\nModemManager:   <warn>  [modem3] couldn't load supported IP families: SIM not inserted\nModemManager:   <info>  [modem3] state changed (unknown -> locked)\nModemManager:   <warn>  [modem3] modem couldn't be initialized: Couldn't check unlock status: SIM not inserted\nModemManager:   <info>  [modem3] state changed (locked -> failed)\nModemManager:   <warn>  [modem3] error initializing: Modem in failed state: sim-missing\nModemManager:   <info>  [1673136941.3379] manager: (wwan0at1): new Broadband device\n                        (/org/freedesktop/NetworkManager/Devices/11)\nNetworkManager: <info>  [1673136941.3382] device (wwan0at1): state change: unmanaged -> unavailable\n                        (reason 'managed', sys-iface-state: 'external')\nNetworkManager: <info>  [1673136941.3385] device (wwan0at1): modem state 'failed'\nNetworkManager: <info>  [1673136941.3387] modem-broadband[wwan0at1]:\n                        failed to retrieve SIM object: No SIM object available\n```\n\nThere is ongoing development in ModemManager/issue/612: A patch was accepted in Linux 6.2rc1 that adds a low-level mbim.rpc interface intended to ultimately be used as kernel module which shall be script-glued into ModemManager (and be compatible to the xmm7360-pci python3 rpc/open_xdatachannel.py script). However, that repo is no longer maintained. However, some users did manage to get the module to work within ModemManager.\n\n"
    }
  ]
}