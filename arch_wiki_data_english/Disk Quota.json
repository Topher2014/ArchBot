{
  "title": "Disk Quota",
  "url": "https://wiki.archlinux.org/title/Disk_Quota",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "From Wikipedia:\n\nThis article covers the installation and setup of disk quota.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the quota-tools package.\n\n"
    },
    {
      "title": "Set up the filesystem",
      "level": 3,
      "content": "Edit fstab to enable the quota mount option(s) on selected file systems, e.g.:\n\n```\n/etc/fstab\n```\n\n```\n/dev/sda3 /home ext4 defaults,usrquota 0 2\n```\n\nTo additionally enable the group quota mount option:\n\n```\n/etc/fstab\n```\n\n```\n/dev/sda3 /home ext4 defaults,usrquota,grpquota 0 2\n```\n\nIf supported by the kernel and file system it is recommended to use journaled quota instead:\n\n```\n/etc/fstab\n```\n\n```\n/dev/sda3 /home ext4 defaults,usrjquota=aquota.user,jqfmt=vfsv1 0 2\n```\n\nAppend grpjquota=aquota.group to enable group quota.\n\nRemount the partition to apply the change:\n\n```\n# mount -vo remount /home\n```\n\n"
    },
    {
      "title": "Create quota index",
      "level": 3,
      "content": "To create the quota index for /home:\n\n```\n# quotacheck -cum /home\n```\n\nAppend the -g parameter to also create a group index.\n\nTo enable disk quotas for the desired file system:\n\n```\n# quotaon -v /home\n```\n\nTo disable disk quotas for the file system:\n\n```\n# quotaoff -v /home\n```\n\n"
    },
    {
      "title": "Enable quota for user/group",
      "level": 3,
      "content": "- To find out how many 1 kilobyte blocks are there for a partition use $ df.\n- You may use a online bytes converter to calculate the correct amount of blocks [1].\n- The command # setquota may be used as an alternative of # edquota [2].\n\nQuotas are configured using edquota (as the root user) that will be opened in the default configured text editor:\n\n```\n# edquota user\n```\n\n```\nDisk quotas for user user (uid 1000):\n  Filesystem                   blocks       soft       hard     inodes     soft     hard\n  /dev/sda3                        24          0          0          6        0        0\n```\n\nConsider the following configuration for ftpuser1:\n\n```\n# edquota ftpuser1\n```\n\n```\nDisk quotas for user ftpuser1 (uid 1000):\n  Filesystem                   blocks       soft       hard     inodes     soft     hard\n  /dev/sda3                        24    1000000    1048576          6        0        0\n```\n\nIn this case if ftpuser1 uses over 976MB of space a warning will be issued. If the hard limit of 1GB has been reached the user will be unable to write any more data.\n\nSee #Specify a grace period to give users a specific amount of time to reduce storage usage when they hit their soft limit.\n\n"
    },
    {
      "title": "Specify a grace period",
      "level": 3,
      "content": "To give current users some time to reduce their file usage, a grace period can be configured. This specifies the allowed time a user/group can exceed their soft limit and while under their hard limit:\n\n```\n# edquota -t\n```\n\n```\nGrace period before enforcing soft limits for users:\nTime units may be: days, hours, minutes, or seconds\n  Filesystem             Block grace period     Inode grace period\n  /dev/sda3              7days                  7days\n```\n\nThe grace period can be set in seconds, minutes, hours, days, weeks or months.\n\n"
    },
    {
      "title": "Reports",
      "level": 3,
      "content": "Shows all configured quotas:\n\n```\n# repquota -a\n```\n\nShows quotas on a specific partition:\n\n```\n# repquota /home\n```\n\nShow quotas that apply to a user/user group:\n\n```\n# quota -u user\n```\n\n```\n# quota -g group\n```\n\n"
    },
    {
      "title": "To one or several users",
      "level": 4,
      "content": "To copy quota settings from user1 to user2:\n\n```\n# edquota -p user1 user2\n```\n\nTo copy quota settings to several other users, append user3 user4 ...\n\n"
    },
    {
      "title": "To groups",
      "level": 4,
      "content": "To copy quota settings from group1 to group2:\n\n```\n# edquota -g -p group1 group2\n```\n\n"
    },
    {
      "title": "To all users",
      "level": 4,
      "content": "The idea is to modify the quota settings for one user and copy the setting to all other users. Set the quota for user1 and apply the quota to users with a UID greater than 999:\n\n```\n# edquota -p user1 $(awk -F: '$3 > 999 {print $1}' /etc/passwd)\n```\n\n"
    },
    {
      "title": "Quota warnings",
      "level": 3,
      "content": "The command warnquota can be used to warn the users about their quota. Configuration is available in /etc/warnquota.conf.\n\n"
    },
    {
      "title": "Stats",
      "level": 3,
      "content": "The command quotastats can be used to give more information about the current quota usage:\n\n```\n$ quotastats\n```\n\n```\nNumber of dquot lookups: 101289\nNumber of dquot drops: 101271\nNumber of still active inodes with quotaÂ : 18\nNumber of dquot reads: 93\nNumber of dquot writes: 2077\nNumber of quotafile syncs: 134518740\nNumber of dquot cache hits: 7391\nNumber of allocated dquots: 90\nNumber of free dquots: 2036\nNumber of in use dquot entries (user/group): -1946\n```\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- https://tldp.org/HOWTO/Quota.html\n- https://www.sf.net/projects/linuxquota/\n- http://www.yolinux.com/TUTORIALS/LinuxTutorialQuotas.html\n- RHEL7: Disk Quotas\n- https://www.digitalocean.com/community/tutorials/how-to-enable-user-and-group-quotas\n\n"
    }
  ]
}