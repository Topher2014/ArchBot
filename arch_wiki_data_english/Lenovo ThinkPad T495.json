{
  "title": "Lenovo ThinkPad T495",
  "url": "https://wiki.archlinux.org/title/Lenovo_ThinkPad_T495",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article or section does not follow the Laptop page guidelines.** This article or section does not follow the Laptop page guidelines.\n\nThis article or section does not follow the Laptop page guidelines.\n\nTable content:\nHardware | PCI/USB ID | Working?\nGPU | 06:00.0 | Yes\nWireless | 8087:0025 | Yes\nAudio | 06:00.6 | Yes\nTrackPoint |  | Yes\nTouchpad |  | Yes\nWebcam | 13d3:56a6 | Yes\nBluetooth | 8087:0025 | Yes\nMobile broadband |  | Untested\nFingerprint scanner | 06cb:00bd | Yes\nMicroSD Reader |  | Yes\nSmartcard Reader |  | Yes\n\n"
    },
    {
      "title": "Fingerprint Sensor",
      "level": 2,
      "content": "The fingerprint sensor works with some recent firmware and software updates.\n\n1. Use fwupd to install the latest firmware for \"Synaptics Prometheus Fingerprint Reader\". The update might have to be done manually as the released firmware is in testing; or you could enable the testing remote in fwupd to allow automated upgrade. The relevant firmwares are Prometheus Fingerprint Reader and Prometheus Fingerprint Reader Configuration.\n1. fprintd ≥ 1.90.1 and libfprint ≥ 1.90.1 are required.\n\nfprint has more details on how to setup the fingerprint, for PAM-based authentication for example.\n\n"
    },
    {
      "title": "Battery and power management",
      "level": 2,
      "content": "TLP prevents plugged in USB devices from working when running on battery. This can be fixed by blacklisting power management of the USB3.1 PCI device in TLP. Find the proper USB IDs via:\n\n```\n$ lspci\n```\n\n```\n05:00.3 USB controller: Advanced Micro Devices, Inc. [AMD] Raven USB 3.1\n05:00.4 USB controller: Advanced Micro Devices, Inc. [AMD] Raven USB 3.1\n```\n\nand create the following:\n\n```\n/etc/tlp.d/01-usb.conf\n```\n\n```\nRUNTIME_PM_BLACKLIST=\"05:00.3 05:00.4\"\n```\n\n"
    },
    {
      "title": "Ethernet connection",
      "level": 2,
      "content": "Some models might have issues in noticing ethernet's link state changes (cable connect/disconnect events) when running on battery.\n\nThe issue can be noticed by trying to connect the ethernet cable while the computer is running on battery: if there is no connection until you connect the power cable you are affected.\n\nTo fix the issue one can try blacklisting the r8169 module by appending the following line to /etc/modprobe.d/blacklist.conf:\n\n```\nblacklist r8169\n```\n\nInstall then the r8168AUR package (or r8168-lts if running the linux-lts, or r8168-dkmsAUR for other kernels).\n\nReboot and the problem should be gone.\n\n"
    },
    {
      "title": "Known Issues",
      "level": 2,
      "content": "The following issues are commonly seen even with recent kernels such as 5.9.3:\n\n```\n[ 6402.261413] irq 7: nobody cared (try booting with the \"irqpoll\" option)\n[ 6402.261423] CPU: 0 PID: 0 Comm: swapper/0 Tainted: G        W         5.5.0-rc2 #1-NixOS\n[ 6402.261425] Hardware name: LENOVO 20NJCTO1WW/20NJCTO1WW, BIOS R12ET46W(1.16 ) 10/28/2019\n[ 6402.261426] Call Trace:\n[ 6402.261430]  <IRQ>\n[ 6402.261439]  dump_stack+0x66/0x90\n[ 6402.261444]  __report_bad_irq+0x37/0xb1\n[ 6402.261449]  note_interrupt.cold.10+0xa/0x6d\n[ 6402.261452]  handle_irq_event_percpu+0x6a/0x80\n[ 6402.261455]  handle_irq_event+0x3c/0x5c\n[ 6402.261459]  handle_fasteoi_irq+0xa3/0x150\n[ 6402.261463]  do_IRQ+0x51/0xe0\n[ 6402.261465]  common_interrupt+0xf/0xf\n[ 6402.261467]  </IRQ>\n[ 6402.261472] RIP: 0010:cpuidle_enter_state+0xbe/0x3f0\n[ 6402.261476] Code: e8 27 c6 b3 ff 80 7c 24 13 00 74 17 9c 58 0f 1f 44 00 00 f6 c4 02 0f 85 d5 02 00 00 31 ff e8 f9 d3 b9 ff fb 66 0f 1f 44 00 00 <85> ed 0f 88 42 02 00 00 48 63 c5 4c 8b 3c 24 4c 2b 7c 24 08 48 8d\n[ 6402.261478] RSP: 0018:ffffffff95a03e48 EFLAGS: 00000246 ORIG_RAX: ffffffffffffffc8\n[ 6402.261482] RAX: ffff8e4a38a2c300 RBX: ffff8e4a3482b800 RCX: 000000000000001f\n[ 6402.261483] RDX: 000005d2a483e85f RSI: 0000000037c1c5c9 RDI: 0000000000000000\n[ 6402.261485] RBP: 0000000000000002 R08: 0000000000000002 R09: 000000000002bb80\n[ 6402.261486] R10: 0000000270e10990 R11: ffff8e4a38a2b3e4 R12: ffffffff95ab9da0\n[ 6402.261487] R13: ffffffff95ab9e88 R14: 0000000000000002 R15: 0000000000000002\n[ 6402.261493]  ? cpuidle_enter_state+0x99/0x3f0\n[ 6402.261496]  cpuidle_enter+0x29/0x40\n[ 6402.261501]  do_idle+0x22b/0x260\n[ 6402.261506]  cpu_startup_entry+0x19/0x20\n[ 6402.261509]  start_kernel+0x4e2/0x504\n[ 6402.261514]  secondary_startup_64+0xb6/0xc0\n[ 6402.261517] handlers:\n[ 6402.261524] [<000000002329e34f>] amd_gpio_irq_handler [pinctrl_amd]\n[ 6402.261527] Disabling IRQ #7\n```\n\nPlease see https://bugzilla.kernel.org/show_bug.cgi?id=201817 for more information.\n\n```\n[ 6390.413248] ------------[ cut here ]------------\n[ 6390.413259] WARNING: CPU: 4 PID: 13706 at kernel/irq/chip.c:210 irq_startup+0xe1/0xf0\n[ 6390.413260] Modules linked in: cpufreq_powersave fuse ctr ccm af_packet cmac algif_hash bnep uvcvideo videobuf2_vmalloc videobuf2_memops videobuf2_v4l2 videobuf2_common videodev mc joydev mousedev btusb btrtl btbcm btintel bluetooth uas ecdh_generic ecc crc16 amdgpu wmi_bmof iwlmvm amd_iommu_v2 gpu_sched mac80211 ttm edac_mce_amd edac_core snd_hda_codec_realtek drm_kms_helper libarc4 snd_hda_codec_generic snd_hda_codec_hdmi deflate efi_pstore pstore nls_iso8859_1 drm evdev crct10dif_pclmul nls_cp437 iwlwifi snd_hda_intel mac_hid ghash_clmulni_intel vfat sp5100_tco fat psmouse snd_intel_dspcfg agpgart serio_raw tpm_crb r8169 i2c_algo_bit snd_hda_codec efivars watchdog fb_sys_fops tpm_tis realtek tpm_tis_core snd_hda_core syscopyarea k10temp ucsi_acpi thinkpad_acpi sysfillrect i2c_piix4 snd_pci_acp3x cfg80211 sysimgblt snd_hwdep typec_ucsi ipmi_devintf libphy nvram tpm 8250_pci ledtrig_audio ipmi_msghandler typec rng_core wmi rfkill video i2c_scmi battery ac backlight i2c_core pinctrl_amd\n[ 6390.413323]  button acpi_cpufreq ip6table_nat iptable_nat nf_nat xt_conntrack nf_conntrack nf_defrag_ipv4 libcrc32c crc32c_generic ip6t_rpfilter ipt_rpfilter ip6table_raw iptable_raw xt_pkttype nf_log_ipv6 nf_log_ipv4 nf_log_common xt_LOG xt_tcpudp ip6table_filter ip6_tables iptable_filter sch_fq_codel snd_pcm_oss snd_mixer_oss snd_pcm snd_timer snd soundcore msr loop cpufreq_ondemand tun tap macvlan bridge stp llc kvm_amd kvm irqbypass efivarfs ip_tables x_tables ipv6 nf_defrag_ipv6 crc_ccitt autofs4 f2fs dm_crypt algif_skcipher af_alg sd_mod usb_storage scsi_mod input_leds rtsx_pci_sdmmc led_class mmc_core atkbd libps2 crc32_pclmul crc32c_intel xhci_pci xhci_hcd ehci_pci aesni_intel ehci_hcd crypto_simd usbcore cryptd glue_helper nvme rtsx_pci nvme_core usb_common i8042 rtc_cmos serio dm_mod\n[ 6390.413371] CPU: 4 PID: 13706 Comm: kworker/u32:9 Tainted: G        W         5.5.0-rc2 #1-NixOS\n[ 6390.413372] Hardware name: LENOVO 20NJCTO1WW/20NJCTO1WW, BIOS R12ET46W(1.16 ) 10/28/2019\n[ 6390.413378] Workqueue: events_unbound async_run_entry_fn\n[ 6390.413380] RIP: 0010:irq_startup+0xe1/0xf0\n[ 6390.413383] Code: 31 f6 4c 89 ef e8 8f 3e 00 00 85 c0 75 20 48 89 ee 31 d2 4c 89 ef e8 5e cd ff ff 48 89 df e8 a6 fe ff ff 89 c5 e9 54 ff ff ff <0f> 0b eb b6 0f 0b eb b2 0f 1f 80 00 00 00 00 0f 1f 44 00 00 55 48\n[ 6390.413384] RSP: 0018:ffffa3bb03717c38 EFLAGS: 00010002\n[ 6390.413385] RAX: 0000000000000180 RBX: ffff8e4a324e9000 RCX: 0000000000000180\n[ 6390.413386] RDX: 0000000000000005 RSI: ffffffff95b13a20 RDI: ffff8e4a324e9018\n[ 6390.413387] RBP: ffff8e4a324e9018 R08: 0000000000000000 R09: ffff8e4a36bd7718\n[ 6390.413388] R10: 0000000000000000 R11: ffffffff95a4cba8 R12: 0000000000000001\n[ 6390.413388] R13: 0000000000000001 R14: ffff8e4a349c9000 R15: 0000000000000000\n[ 6390.413389] FS:  0000000000000000(0000) GS:ffff8e4a38b00000(0000) knlGS:0000000000000000\n[ 6390.413390] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[ 6390.413391] CR2: 00007fce04010826 CR3: 0000000137940000 CR4: 00000000003406e0\n[ 6390.413391] Call Trace:\n[ 6390.413398]  enable_irq+0x49/0x90\n[ 6390.413405]  nvme_poll_irqdisable+0x2d0/0x350 [nvme]\n[ 6390.413408]  __nvme_disable_io_queues+0x1b2/0x1f0 [nvme]\n[ 6390.413410]  ? nvme_del_queue_end+0x20/0x20 [nvme]\n[ 6390.413412]  nvme_dev_disable+0x17c/0x240 [nvme]\n[ 6390.413414]  nvme_suspend+0x51/0x150 [nvme]\n[ 6390.413418]  pci_pm_suspend+0x73/0x150\n[ 6390.413420]  ? pci_pm_freeze+0xb0/0xb0\n[ 6390.413424]  dpm_run_callback+0x4f/0x140\n[ 6390.413426]  __device_suspend+0x103/0x450\n[ 6390.413428]  async_suspend+0x1a/0x90\n[ 6390.413430]  async_run_entry_fn+0x37/0x140\n[ 6390.413433]  process_one_work+0x206/0x3c0\n[ 6390.413435]  worker_thread+0x2d/0x3e0\n[ 6390.413436]  ? process_one_work+0x3c0/0x3c0\n[ 6390.413439]  kthread+0x112/0x130\n[ 6390.413440]  ? kthread_park+0x80/0x80\n[ 6390.413444]  ret_from_fork+0x22/0x40\n[ 6390.413447] ---[ end trace 9878c5f80dece12a ]---\n```\n\nPlease see https://bugzilla.kernel.org/show_bug.cgi?id=202891 for more information.\n\n```\n[  112.406635] ------------[ cut here ]------------\n[  112.406641] STA 00:xx:xx:xx:xx:xx AC 2 txq pending airtime underflow: 4294967200, 96\n[  112.406694] WARNING: CPU: 2 PID: 913 at net/mac80211/sta_info.c:1933 ieee80211_sta_update_pending_airtime+0x110/0x120 [mac80211]\n[  112.406695] Modules linked in: fuse ctr ccm af_packet cmac algif_hash bnep uvcvideo videobuf2_vmalloc videobuf2_memops videobuf2_v4l2 videobuf2_common videodev mc joydev mousedev btusb btrtl btbcm btintel bluetooth uas ecdh_generic ecc crc16 amdgpu wmi_bmof iwlmvm amd_iommu_v2 gpu_sched mac80211 ttm edac_mce_amd edac_core snd_hda_codec_realtek drm_kms_helper libarc4 snd_hda_codec_generic snd_hda_codec_hdmi deflate efi_pstore pstore nls_iso8859_1 drm evdev crct10dif_pclmul nls_cp437 iwlwifi snd_hda_intel mac_hid ghash_clmulni_intel vfat sp5100_tco fat psmouse snd_intel_dspcfg agpgart serio_raw tpm_crb r8169 i2c_algo_bit snd_hda_codec efivars watchdog fb_sys_fops tpm_tis realtek tpm_tis_core snd_hda_core syscopyarea k10temp ucsi_acpi thinkpad_acpi sysfillrect i2c_piix4 snd_pci_acp3x cfg80211 sysimgblt snd_hwdep typec_ucsi ipmi_devintf libphy nvram tpm 8250_pci ledtrig_audio ipmi_msghandler typec rng_core wmi rfkill video i2c_scmi battery ac backlight i2c_core pinctrl_amd button acpi_cpufreq\n[  112.406743]  ip6table_nat iptable_nat nf_nat xt_conntrack nf_conntrack nf_defrag_ipv4 libcrc32c crc32c_generic ip6t_rpfilter ipt_rpfilter ip6table_raw iptable_raw xt_pkttype nf_log_ipv6 nf_log_ipv4 nf_log_common xt_LOG xt_tcpudp ip6table_filter ip6_tables iptable_filter sch_fq_codel snd_pcm_oss snd_mixer_oss snd_pcm snd_timer snd soundcore msr loop cpufreq_ondemand tun tap macvlan bridge stp llc kvm_amd kvm irqbypass efivarfs ip_tables x_tables ipv6 nf_defrag_ipv6 crc_ccitt autofs4 f2fs dm_crypt algif_skcipher af_alg sd_mod usb_storage scsi_mod input_leds rtsx_pci_sdmmc led_class mmc_core atkbd libps2 crc32_pclmul crc32c_intel xhci_pci xhci_hcd ehci_pci aesni_intel ehci_hcd crypto_simd usbcore cryptd glue_helper nvme rtsx_pci nvme_core usb_common i8042 rtc_cmos serio dm_mod\n[  112.406788] CPU: 2 PID: 913 Comm: irq/81-iwlwifi: Not tainted 5.5.0-rc2 #1-NixOS\n[  112.406789] Hardware name: LENOVO 20NJCTO1WW/20NJCTO1WW, BIOS R12ET46W(1.16 ) 10/28/2019\n[  112.406798] RIP: 0010:ieee80211_sta_update_pending_airtime+0x110/0x120 [mac80211]\n[  112.406800] Code: ba d3 0f 0b 8b 44 24 04 eb a0 48 83 c6 40 41 89 e8 89 c1 48 c7 c7 28 71 f3 c0 89 44 24 04 c6 05 32 27 09 00 01 e8 db 4a ba d3 <0f> 0b 8b 44 24 04 eb 8f 0f 1f 84 00 00 00 00 00 0f 1f 44 00 00 55\n[  112.406802] RSP: 0018:ffffa3bb00737ba8 EFLAGS: 00010286\n[  112.406803] RAX: 0000000000000000 RBX: 00000000ffffffa0 RCX: 0000000000000000\n[  112.406804] RDX: 0000000000000000 RSI: ffffffff95fc05c8 RDI: 0000000000000246\n[  112.406805] RBP: 0000000000000060 R08: ffffffff95fc0580 R09: 000000000002bb80\n[  112.406806] R10: 00000042845c12d5 R11: 0000000000000391 R12: ffff8e49c87a87c0\n[  112.406806] R13: 0000000000000002 R14: ffff8e49c569c5c0 R15: ffffa3bb00737c58\n[  112.406808] FS:  0000000000000000(0000) GS:ffff8e4a38a80000(0000) knlGS:0000000000000000\n[  112.406809] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[  112.406810] CR2: 00002a29a779c000 CR3: 0000000182128000 CR4: 00000000003406e0\n[  112.406811] Call Trace:\n[  112.406825]  __ieee80211_tx_status+0x67d/0x800 [mac80211]\n[  112.406833]  ieee80211_tx_status+0x6a/0x90 [mac80211]\n[  112.406842]  iwl_mvm_tx_reclaim+0x2ad/0x3c0 [iwlmvm]\n[  112.406849]  iwl_mvm_rx_ba_notif+0x10c/0x2e0 [iwlmvm]\n[  112.406854]  iwl_mvm_rx_common+0xae/0x2c0 [iwlmvm]\n[  112.406867]  iwl_pcie_rx_handle+0x3fd/0xa60 [iwlwifi]\n[  112.406875]  ? irq_finalize_oneshot.part.46+0xf0/0xf0\n[  112.406879]  iwl_pcie_irq_rx_msix_handler+0x54/0x100 [iwlwifi]\n[  112.406881]  ? irq_finalize_oneshot.part.46+0xf0/0xf0\n[  112.406883]  irq_thread_fn+0x1f/0x60\n[  112.406885]  irq_thread+0xe7/0x170\n[  112.406887]  ? irq_forced_thread_fn+0x70/0x70\n[  112.406889]  ? irq_thread_check_affinity+0xc0/0xc0\n[  112.406892]  kthread+0x112/0x130\n[  112.406894]  ? kthread_park+0x80/0x80\n[  112.406898]  ret_from_fork+0x22/0x40\n[  112.406900] ---[ end trace 9878c5f80dece128 ]---\n[  112.406901] ------------[ cut here ]------------\n```\n\nPlease see https://bugzilla.kernel.org/show_bug.cgi?id=205869 for more information.\n\nIt seems like this message could be ignored, i.e. treated as a warning.\n\nPlease see Gentoo:Lenovo Thinkpad T495#Unable to write to IOMMU and https://bugzilla.kernel.org/show_bug.cgi?id=201753 for more information.\n\n```\ntpm tpm0: tpm_try_transmit: send(): error -5\ntpm tpm0: [Firmware Bug]: TPM interrupt not working, polling instead\n```\n\nAs a workaround you can turn off the TPM in BIOS settings.\n\nPlease see https://bugzilla.kernel.org/show_bug.cgi?id=204121 and https://bugzilla.redhat.com/show_bug.cgi?id=1770021 for more information.\n\n```\ntpm tpm0: tpm_try_transmit: send(): error -5\ntpm tpm0: [Firmware Bug]: TPM interrupt not working, polling instead\n```\n\nAs a workaround you can turn off the TPM in BIOS settings.\n\nPlease see https://bugzilla.kernel.org/show_bug.cgi?id=204121 and https://bugzilla.redhat.com/show_bug.cgi?id=1770021 for more information.\n\n```\n[drm:drm_dp_mst_dpcd_read [drm_kms_helper]] *ERROR* mstb 000000002ef7ea2e port 3: DPCD read on addr 0x60 for 1 bytes NAKed\n```\n\nPlease see https://bugzilla.redhat.com/show_bug.cgi?id=1874782 for more information.\n\nYou can comment or remove loading of platform-integrity module.\n\nPlease see https://forum.endeavouros.com/t/failed-to-find-module-platform-integrity-after-update/9279/10 for more information.\n\nOccasionally after resuming from sleep, the display freezes with the following showing up in the kernel log:\n\n```\n[drm:drm_atomic_helper_wait_for_flip_done [drm_kms_helper]] *ERROR* [CRTC:67:crtc-0] flip_done timed out\n[drm:drm_atomic_helper_wait_for_dependencies [drm_kms_helper]] *ERROR* [CRTC:67:crtc-0] flip_done timed out\n[drm:drm_atomic_helper_wait_for_dependencies [drm_kms_helper]] *ERROR* [PLANE:55:plane-3] flip_done timed out\n```\n\nThere is currently no known workarounds for this issue. https://gitlab.freedesktop.org/drm/amd/-/issues/1000\n\n"
    }
  ]
}