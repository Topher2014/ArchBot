{
  "title": "Varnish",
  "url": "https://wiki.archlinux.org/title/Varnish",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Varnish Cache is a web application accelerator also known as a caching HTTP reverse proxy. You install it in front of any HTTP server and configure it to cache the contents.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Install the varnish package.\n\n"
    },
    {
      "title": "Customizing Varnish",
      "level": 2,
      "content": "By default, varnish comes configured in /etc/varnish/default.vcl to use localhost:8080 as the only backend, default.vcl is called by the default varnish.service file.\n\nYou can enable the unit as-is, or override the defaults by editing it.\n\n```\n[Service]\nExecStart=\nExecStart=/usr/bin/varnishd -j unix,user=nobody -F -a :6081 -T localhost:6082 -f /etc/varnish/default.vcl -S /etc/varnish/secret -s malloc,1G\n```\n\nAlso, if you change the configuration file /etc/varnish/default.vcl you will need to reload varnish.service:\n\n"
    },
    {
      "title": "Manual VCL load",
      "level": 3,
      "content": "If the previous VCL configuration reload failed, try loading the VCL file manually:\n\n1. Connect to the varnish console: $ varnishadm -T localhost:6082\n1. Load the default VCL. Make sure it has at least one backend: varnish> vcl.load default /etc/varnish/default.vcl\n1. Make it active: varnish> vcl.use default\n1. Start the child proccess (optional): varnish> start\n\n```\n$ varnishadm -T localhost:6082\n```\n\n```\nvarnish> vcl.load default /etc/varnish/default.vcl\n```\n\n```\nvarnish> vcl.use default\n```\n\n```\nvarnish> start\n```\n\n"
    }
  ]
}