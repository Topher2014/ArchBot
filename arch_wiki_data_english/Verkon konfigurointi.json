{
  "title": "Verkon konfigurointi",
  "url": "https://wiki.archlinux.org/title/Verkon_konfigurointi",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Aiheeseen liittyen\n\n- Network Debugging\n- Firewalls\n- Internet sharing\n- Router\n\nTässä artikkelissa kerrotaan kuinka verkkoyhteydet pystyy konfiguroimaan OSI kerroksella 3 ja ylöspäin. Ethernettiin ja langattomaan paneutudaan paremmin niiden alasivuilla.\n\n"
    },
    {
      "title": "Tarkista yhteys",
      "level": 2,
      "content": "Määrittääksesi vian yhteydessä, käy seuraava lista läpi ja varmista että kaikki tapaukset täyttyvät:\n\n1. Verkon käyttöliittymä on listattu ja otettu käyttöön. Muussa tapauksessa tarkista laitteen ajuri – katso ethernet ajuri tai langaton ajuri.\n1. Olet yhdistettynä verkkoon: kaapeli on kytketty kiinni tai olet yhdistettynä langattomasti LAN verkkoon.\n1. Sinun verkon käyttöliittymään on asetettu IP osoite.\n1. Reititystaulu on asetettu oikein.\n1. Voit pingata verkon sisäisen IP osoitteen (kuten sinun yhdyskäytävä).\n1. Voit pingata julkisen IP osoitteen (kuten 8.8.8.8, joka on Googlen DNS palvelin ja on kätevä osoite testailulle).\n1. Tarkista jotta voit selvittää verkkotunnuksia (kuten archlinux.org).\n\n"
    },
    {
      "title": "Ping",
      "level": 3,
      "content": "Pingausta käytetään yhteyden selvittämiseen palvelimelle.\n\n```\n$ ping www.example.com\n```\n\n```\nPING www.example.com (93.184.216.34): 56(84) data bytes\n\n64 bytes from 93.184.216.34: icmp_seq=0 ttl=56 time=11.632 ms\n\n64 bytes from 93.184.216.34: icmp_seq=1 ttl=56 time=11.726 ms\n\n64 bytes from 93.184.216.34: icmp_seq=2 ttl=56 time=10.683 ms\n\n...\n```\n\nJokaisesta vastauksesta pingaus apuväline printtaa samanlaisen rivin kuin ylhäällä esimerkissä on. Lisätietoa löytyy ping(8) manuaalista. Huomaa, että tietokoneet voivat olla konfiguroituja olemaan vastaamatta ICMP echo pyyntöihin. [1]\n\nJos et saa vastausta, oletusyhdyskäytävä tai ISP eli palveluntarjoaja saattaa olla ongelmana. Voit suorittaa traceroute-työkalun tarkistellaksesi polkua palvelimelle.\n\n"
    },
    {
      "title": "Verkon hallinnointi",
      "level": 2,
      "content": "Muodostaaksesi verkkoyhteyden käy seuraavat askeleet läpi:\n\n1. Varmistu siitä, että verkon käyttöliittymä on listattuna ja otettuna käyttöön.\n\n1. Yhdistä verkkoon. Kiinnitä Ethernet kaapeli tai yhdistä langattomaan LAN verkkoon.\n\n1. Konfiguroi verkkoyhteys:\n\n1. staattinen IP osoite\n\n- staattinen IP osoite\n\n1. dynaaminen IP osoite: käytä DHCP:tä\n\n- dynaaminen IP osoite: käytä DHCP:tä\n\n"
    },
    {
      "title": "net-tools",
      "level": 3,
      "content": "Arch Linux on merkinnyt vanhentuneeksi net-tools paketin korvatakseen sen iproute2 paketilla.[2]\n\nTable content:\nVanhentunut komento | Korvaava komento\narp | ip neighbor\nifconfig | ip address, ip link\nnetstat | ss\nroute | ip route\n\nLaajemmalle selvitykselle asiasta, katso tämä blogi päivitys.\n\n"
    },
    {
      "title": "iproute2",
      "level": 3,
      "content": "iproute2 on riippuvuutena base meta paketissa ja antaa ip(8) komentorivi käyttöliittymän, jolla hallitaan verkon käyttöliittymiä, IP osotteita ja polku taulun. Ole tietoinen kumminkin siitä, ettei ip säilytä asetuksia uudelleen käynnistyksessä. Konfiguroimiseen voidaan käyttää verkon hallintajärjestelmää tai voidaan automatisoida ip komentoja käyttämällä skriptejä ja systemd yksiköillä. Huomioi myös, että ip komennot voidaan yleensä lyhentää. Selkeyden vuoksi ne kumminkin tässä artikkelissa ovat pidemmässä muodossa.\n\n"
    },
    {
      "title": "Verkon käyttöliittymät",
      "level": 3,
      "content": "Oletukselta udev antaa nimiä verkon käyttöliittymille käyttäen Ennalta arvattavia verkko käyttölliittymien nimiä, joka antaa käyttöliittymien nimille etuliitteen en (wired/Ethernet), wl (wireless/WLAN), tai ww (WWAN).\n\n"
    },
    {
      "title": "Verkon käyttöliittymien listaus",
      "level": 4,
      "content": "Langalliset ja langattomat käyttöliittymänimet saa listattua komennolla ls /sys/class/net tai komennolla ip link. Huomioi että lo on rengas laite ja sitä ei todellisuudessa käytetä yhteyksien muodostamiseen.\n\nLangattomat laitenimet voidaan myös hakea käyttämällä iw dev. Katso myös Network configuration/Wireless#Get the name of the interface.\n\nJos sinun verkonkäyttöliittymää ei ole listalla varmista, että laitteen ajuri latautui onnistuneesti. Katso Network configuration/Ethernet#Device driver tai Network configuration/Wireless#Device driver.\n\n"
    },
    {
      "title": "Verkkokäyttöliittymien aktivointi ja käytöstä poistaminen",
      "level": 4,
      "content": "Verkkokäyttöliittymät voidaan ottaa pois käytöstä tai laittaa takaisin käyttöön komennolla ip link set käyttöliittymä up|down, katso ip-link(8).\n\nTarkistaaksesi käyttöliittymän status eth0:\n\n```\n$ ip link show dev eth0\n```\n\n```\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br0 state DOWN mode DEFAULT qlen 1000\n...\n```\n\nUP kohdassa <BROADCAST,MULTICAST,UP,LOWER_UP> indikoi käyttöliittymän toiminnasta, ei tuo myöhempi ilmenevistä state DOWN.\n\n"
    },
    {
      "title": "Staattinen IP osoite",
      "level": 3,
      "content": "Staattinen IP osoite voidaan konfiguroida kaikkein tavallisimmilla verkonhallintajärjestelmillä ja myös dhcpcd:n avulla.\n\nStaattisen IP osoitteen konfiguroimiseen manuaalisesti, lisää IP osoite kuten kuvattu #IP osoitteet kohdassa, pohjusta reititystaulu ja konfiguroi DNS palvelimet.\n\n"
    },
    {
      "title": "IP osoitteet",
      "level": 3,
      "content": "IP osoitteita hallitaan käyttämällä komentoa ip-address(8).\n\nListaa IP osoitteet:\n\n```\n$ ip address show\n```\n\nLisää IP osoite käyttöliittymään:\n\n```\n# ip address add osoite/prefix_len broadcast + dev käyttöliittymä\n```\n\n- osoite annetaan CIDR notaationa täydentämään aliverkonpeitettä\n- + on erikoismerkki joka pakottaa ip:n päättelemään aliverkonpeitteen lähettävän osoitteen IP osoitteesta.\n\nPoista IP osoite käyttöliittymästä:\n\n```\n# ip address del osoite/prefix_len dev käyttöliittymä\n```\n\nPoista kaikki osoitteet jotka vastaavat kriteerejä, eli jostain erityisestä käyttöliittymästä:\n\n```\n# ip address flush dev käyttöliittymä\n```\n\n"
    },
    {
      "title": "Reititystaulu",
      "level": 3,
      "content": "reititystaulua käytetään määrittämään jos yhteys IP osoitteeseen suoraan on saatavissa tai mitä yhdyskäytävää (reititin) tulisi käyttää. Jos mikään muu reitti ei täsmää IP osoitetta, oletus yhdyskäytävää käytetään.\n\nReititystaulua hallitaan komennolla ip-route(8).\n\nPREFIX on joko CIDR notaatio tai default oletus yhdyskäytävälle.\n\nListaa IPv4 reitit:\n\n```\n$ ip route show\n```\n\nListaa IPv6 reitit:\n\n```\n$ ip -6 route\n```\n\nLisää reitti:\n\n```\n# ip route add PREFIX via osoite dev käyttöliittymä\n```\n\nPoista reitti:\n\n```\n# ip route del PREFIX via osoite dev käyttöliittymä\n```\n\n"
    },
    {
      "title": "DHCP",
      "level": 3,
      "content": "DHCP (lyhenne sanoista Dynamic Host Configuration Protocol) palvelin antaa asiakasohjelmalle dynaamisen IP osoitteen, aliverkkopeitteen, oletus yhdyskäytävän IP osoitteen ja mahdollisesti myös DNS nimi palvelimen.\n\nDHCP käyttöä varten tarvitaan DHCP palvelin sisäisestä verkosta ja DHCP asiakasohjelma:\n\nTable content:\nAsiakasohjelma | Paketti | Archiso | Huomioitavaa | Systemd yksiköt\ndhcpcd | dhcpcd | Kyllä | DHCP, DHCPv6, ZeroConf, static IP | dhcpcd.service, dhcpcd@käyttäjäliittymä.service\nISC dhclient | dhclient | Kyllä | DHCP, DHCPv6, BOOTP, static IP | dhclient@käyttäjäliittymä.service\n\n- Kahta DHCP asiakasohjelmaa ei pitäisi käyttää samanaikaisesti.\n- Erillisen DHCP asiakasohjelman sijasta voi myös käyttää verkonhallintajärjestelmää, joista osalla on sisäänrakennettu DHCP asiakasohjelma.\n- Vaihtoehtoisesti, iwd sisältää sisäänrakennetun DHCP asiakasohjelman, jota voidaan käyttää joissakin konfiguraatioissa: iwd#Enable built-in network configuration.\n\n- Voit tarkistaa mikäli DHCP palvelin on käynnissä paketilla dhcping.\n- Kun IP:n muodostaminen on vielä prosessissa, jotain samanlaista voi suorittaa watch -n 1 ping -c 1 archlinux.org.\n\n"
    },
    {
      "title": "Palvelimet",
      "level": 4,
      "content": "Table content:\nPalvelin | Paketti | IPv4 | IPv6 | GUI | Käyttäjäliittymät | Varaston takapää(t) | Huomioitavaa\ndhcpd | dhcp | Kyllä | Kyllä | Glass-ISC-DHCP | ? | Tiedosto | \ndnsmasq | dnsmasq | Kyllä | Kyllä | Ei | ? | Tiedosto | Myös DNS, PXE ja TFTP\nKea | kea | Kyllä | Kyllä | Kea-Anterius (Kokeellinen) | REST, RADIUS ja NETCONF | Tiedosto, MySQL, PostgreSQL ja Cassandra | Myös DNS\n\n"
    },
    {
      "title": "Verkonhallintajärjestelmät",
      "level": 3,
      "content": "Verkonhallintajärjestelmä mahdollistaa verkkoyhteyksien asetusten hallinnan niin sanotuissa verkkoprofiileissa helpottaakseen verkkojen vaihtelua.\n\nTable content:\nVerkonhallintajärjestelmä | GUI | Archiso [3] | CLI työkalut | PPP tuki (esim 3G modeemi) | DHCP asiakasohjelma | Systemd yksiköt\nConnMan | 8 epävirallinen | Ei | connmanctl(1) | Kyllä (ofonoAUR kanssa) | sisäinen | connman.service\nnetctl | 2 epävirallinen | Ei | netctl(1), wifi-menu | Kyllä | dhcpcd tai dhclient | netctl-ifplugd@interface.service, netctl-auto@interface.service\nNetworkManager | Kyllä | Ei | nmcli(1), nmtui(1) | Kyllä | sisäinen tai dhclient | NetworkManager.service\nsystemd-networkd | Ei | Kyllä (base) | networkctl(1) | Ei | sisäinen | systemd-networkd.service, systemd-resolved.service\n\n"
    },
    {
      "title": "Aseta isäntänimi",
      "level": 2,
      "content": "Isäntänimi on yksilöllinen nimi luotu tunnistamaan laite verkossa, joka on konfiguroitu tiedostossa /etc/hostname. katso hostname(5) ja hostname(7) yksityiskohdille. Tiedosto voi sisältää järjestelmän verkkotunnuksen, jos yhtään. Isäntänimen asettamiseksi, muokkaa /etc/hostname sisältääksesi yhden rivin isäntänimeni:\n\n```\n/etc/hostname\n```\n\n```\nisäntänimeni\n```\n\nVaihtoehtoisesti käyttäen hostnamectl(1):\n\n```\n# hostnamectl set-hostname isäntänimeni\n```\n\nVäliaikaisesti asettaaksesi isäntänimen (uudelleen käynnistykseen saakka), käytä hostname(1) paketista inetutils:\n\n```\n# hostname isäntänimeni\n```\n\nLaittaaksesi \"sievän\" isäntänimen ja muuta koneen metadataa, katso machine-info(5).\n\n"
    },
    {
      "title": "Paikallinen isäntänimen resoluutio",
      "level": 3,
      "content": "myhostname Name Service Switch (NSS) systemd moduuli tarjoaa paikallisen isäntänimen resoluution ilman muokkausta tiedostossa /etc/hosts (hosts(5)). Se on aktivoituna oletukselta.\n\nJotkin asiakasohjelmat voivat kumminkin silti luottaa /etc/hosts, katso [4] [5] esimerkeille.\n\nKonfiguroidaksesi hosts tiedostoa, lisää seuraavat rivit /etc/hosts:\n\n```\n127.0.0.1        localhost\n::1              localhost\n127.0.1.1        isäntänimeni.localdomain        isäntänimeni\n```\n\nTämän seurauksena järjestelmä selvittää molempiin kirjauksiin:\n\n```\n$ getent hosts\n```\n\n```\n127.0.0.1       localhost\n127.0.0.1       localhost\n127.0.1.1       isäntänimeni.localdomain isäntänimeni\n```\n\nPysyvällä IP osoitteella olevassa järjestelmässä tulisi käyttää tätä pysyvää IP osoitetta 127.0.1.1 sijasta.\n\n"
    },
    {
      "title": "Paikallisen verkon isäntänimen resoluutio",
      "level": 3,
      "content": "Liittääkseen kone LAN verkkoon isäntänimen kautta voidaan:\n\n- muokata /etc/hosts tiedostoa jokaiselle koneelle LAN verkossa, katso hosts(5)\n- asettaa DNS palvelin selvittämään isäntänimen ja pistämällä LAN laitteet käyttämään sitä (esimerkiksi #DHCP:n kautta)\n- tai helpolla tavalla: käyttää Zeroconf palvelua: Isäntänimen resoluutio Microsoftin NetBIOS:sin kautta. Samba Linuxissa hoitaa saman. Tämä tarvitsee vain nmb.service. Tietokoneet, joissa on Windows, macOS, tai Linux ja nmb pyörimässä, löytävät tämän koneen. Isäntänimen resoluutio mDNS:sän kautta. Tulee joko nss_mdns Avahi:n kautta (katso Avahi#Hostname resolution asetuksen varalta) tai systemd-resolved:in kautta. Tietokoneet, joissa on macOS tai Linux Avahi tai systemd-resolved pyörimässä, pystyvät löytämään tämän koneen. Vanhempi Win32 API ei tue mDNSää, joka voi estää pääsyn joiltain vanhoilta Windows ohjelmilta.\n\n- Isäntänimen resoluutio Microsoftin NetBIOS:sin kautta. Samba Linuxissa hoitaa saman. Tämä tarvitsee vain nmb.service. Tietokoneet, joissa on Windows, macOS, tai Linux ja nmb pyörimässä, löytävät tämän koneen.\n- Isäntänimen resoluutio mDNS:sän kautta. Tulee joko nss_mdns Avahi:n kautta (katso Avahi#Hostname resolution asetuksen varalta) tai systemd-resolved:in kautta. Tietokoneet, joissa on macOS tai Linux Avahi tai systemd-resolved pyörimässä, pystyvät löytämään tämän koneen. Vanhempi Win32 API ei tue mDNSää, joka voi estää pääsyn joiltain vanhoilta Windows ohjelmilta.\n\n"
    },
    {
      "title": "Vaihda käyttöliittymän nimeä",
      "level": 3,
      "content": "Laitteen nimi voidaan vaihtaa määrittämällä sen nimi manuaalisesti udev-rule:n avulla. Esimerkiksi:\n\n```\n/etc/udev/rules.d/10-network.rules\n```\n\n```\nSUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"aa:bb:cc:dd:ee:ff\", NAME=\"net1\"\nSUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"ff:ee:dd:cc:bb:aa\", NAME=\"net0\"\n```\n\nNämä säännöt tulevat käyttöön automaattisesti bootatessa.\n\nMuutama huomioitava asia:\n\n- Jos halutaan esittää MAC osoite jokaisesta kortista, käytä tätä komentoa: cat /sys/class/net/laitteen_nimi/address\n- Muista käyttää pieniä kirjaimia heksaluvussa udev säännöissä. Se ei pidä isoista kirjaimista.\n\nJos verkkokortilla on dynaaminen MAC osoite, voidaan käyttää DEVPATH muuttujaa, esimerkiksi:\n\n```\n/etc/udev/rules.d/10-network.rules\n```\n\n```\nSUBSYSTEM==\"net\", DEVPATH==\"/devices/platform/wemac.*\", NAME=\"int\"\nSUBSYSTEM==\"net\", DEVPATH==\"/devices/pci*/*1c.0/*/net/*\", NAME=\"en\"\n```\n\n```\nDEVPATH kaikista sillä hetkellä liitetyistä korteista, katso mihin symlinks polussa /sys/class/net/ johtaa. Esimerkiksi:\n```\n\n```\nfile /sys/class/net/*\n```\n\n```\n/sys/class/net/enp0s20f0u4u1: symbolic link to ../../devices/pci0000:00/0000:00:14.0/usb2/2-4/2-4.1/2-4.1:1.0/net/enp0s20f0u4u1\n/sys/class/net/enp0s31f6:     symbolic link to ../../devices/pci0000:00/0000:00:1f.6/net/enp0s31f6\n/sys/class/net/lo:            symbolic link to ../../devices/virtual/net/lo\n/sys/class/net/wlp4s0:        symbolic link to ../../devices/pci0000:00/0000:00:1c.6/0000:04:00.0/net/wlp4s0\n```\n\nLaitteen polun pitäisi vastata sekä uutta että vanhaa laitteen nimeä, sillä se sääntö voidaan suorittaa useammin kuin vain kerran bootatessa. Esimerkiksi, toisessa säännössä, \"/devices/pci*/*1c.0/*/net/enp*\" olisi väärin, koska se lopettaa hakemisen kun nimi on vaihdettu en. Vain järjestelmän oletus-sääntö pyörähtää toisen kerran, aiheuttaen nimen muutoksen takaisin kuten esimerkiksi enp1s0.\n\nJos käytetään USB verkkolaitetta ( kuten Android puhelimen tethering), jolla on dynaaminen MAC osoite ja halutaan myös käyttää muita USB portteja, voitaisiin ennemmin käyttää sääntöä, joka vastaa riippuen tavarantoimittajasta tai tuotteen ID:stä:\n\n```\n/etc/udev/rules.d/10-network.rules\n```\n\n```\nSUBSYSTEM==\"net\", ACTION==\"add\", ATTRS{idVendor}==\"12ab\", ATTRS{idProduct}==\"3cd4\", NAME=\"net2\"\n```\n\nTestatakseen sääntöjä, ne voidaan käynnistää suoraan käyttäjätilasta, esimerkiksi udevadm --debug test /sys/class/net/* avulla. Ensin pitää muistaa ottaa alas käyttöliittymä, jota ollaan nimeämässä (esim. ip link set enp1s0 down).\n\nNote: **nimiä jotka vastaavat tyyliä \"ethX\" ja \"wlanX\" pitäisi välttää** \n\n"
    },
    {
      "title": "Palauta perinteisiin käyttöliittymän nimiin",
      "level": 3,
      "content": "Jos perinteisemmät käyttöliittymänimet kuten eth0 ovat parempia omaan käyttöön, ennalta arvattavat nimet voidaan poistaa käytöstä peittämällä udev sääntö:\n\n```\n# ln -s /dev/null /etc/udev/rules.d/80-net-setup-link.rules\n```\n\nVaihtoehtoisesti, lisää net.ifnames=0 kernelin parametreihin.\n\n"
    },
    {
      "title": "Kannan tutkiminen",
      "level": 3,
      "content": "ss on työkalu verkkoporttien tutkimiseen ja on osana iproute2 pakettia. Sillä on samallainen toiminnallisuus verraten vanhentuneeseen netstat työkaluun.\n\nYleisiä käyttökohteita ovat:\n\nNäytä kaikki TCP Kannat palvelunimillä:\n\n```\n$ ss -at\n```\n\nNäytä kaikki TCP Kannat porttien numeroilla:\n\n```\n$ ss -atn\n```\n\nNäytä kaikki UDP Kannat:\n\n```\n$ ss -au\n```\n\nLisätietoa löytyy ss(8) manuaalisivulta.\n\n"
    },
    {
      "title": "Katso myös",
      "level": 2,
      "content": "- Linuxin verkon ylläpitäjän käsikirja\n- Debian referenssi: Verkon pohjustus\n- RHEL7: Verkkotyöskentelyn käsikirja\n- Linux kodin verkkotyöskentely\n- Linux verkkotyöskentely pinon valvominen ja säätö: Datan vastaanottaminen\n- Linux verkkotyöskentely pinon valvominen ja säätö: Datan lähettäminen\n- Paketin matkan jäljittäminen käyttäen tracepointteja, perf ja eBPF\n\n"
    }
  ]
}