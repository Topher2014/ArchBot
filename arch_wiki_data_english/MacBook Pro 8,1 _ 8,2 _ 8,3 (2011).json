{
  "title": "MacBook Pro 8,1 / 8,2 / 8,3 (2011)",
  "url": "https://wiki.archlinux.org/title/MacBook_Pro_8,1_/_8,2_/_8,3_(2011)",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.** This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nThis article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nThis page contains tips on installing Arch Linux on an Early 2011 MacBook Pro.\n\ndiscuss at https://bbs.archlinux.org/viewtopic.php?pid=1021706\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "Following the installation guide works for the most part, but it is necessary to add some kernel parameters when booting due to issues with the graphics card as well as potentially switch kernel module to get the wireless network to work:\n\n"
    },
    {
      "title": "8,1",
      "level": 3,
      "content": "Forum thread: BBS#136833\n\nAdd following to kernel parameters.\n\n```\ni915.enable_fbc=1 usbcore.autosuspend=1 h\n```\n\n"
    },
    {
      "title": "8,2 and 8,3",
      "level": 3,
      "content": "Note: **BCM4331** \n\nIf, after installation, the screen freezes after boot, try booting with the kernel parameter\n\n```\nradeon.modeset=0\n```\n\nin order to disable the ATI Radeon graphics card.\n\n"
    },
    {
      "title": "Using rEFInd and an EFI boot stub",
      "level": 3,
      "content": "Using rEFInd as a boot manager as an alternative to GRUB or systemd-boot is possible, but may need some configuration.\n\n"
    },
    {
      "title": "Install rEFInd",
      "level": 4,
      "content": "Consult Installing rEFInd\n\nBoot into Mac OS X\n\n```\n# mkdir -p /efi/refind\n # cp -r refind/* /efi/refind/\n # rm /efi/refind/refind_ia32.efi\n # mv /efi/refind/refind.conf-sample /efi/refind/refind.conf and adjust it\n # bless --setBoot --folder /efi/refind --file /efi/refind/refind_x64.efi\n```\n\n"
    },
    {
      "title": "Setting up the EFI boot stub",
      "level": 4,
      "content": "Follow EFI boot stub.\n\n"
    },
    {
      "title": "Add kernel modules",
      "level": 3,
      "content": "Without this, you will get root fs not found error.\n\nEdit /etc/mkinitcpio.conf:\n\n```\nMODULES=\"..ahci libahci..\"\n```\n\nThen regenerate the initramfs.\n\n"
    },
    {
      "title": "BIOS boot",
      "level": 3,
      "content": "Boot into BIOS emulation mode. AMD card works, but intel card does not.\n\nUse rEFInd to load GRUB legacy.\n\n"
    },
    {
      "title": "Wireless network",
      "level": 2,
      "content": "See Broadcom wireless for b43 installation and usage.\n\n"
    },
    {
      "title": "Keyboard",
      "level": 3,
      "content": "Default F1 key represents XF86MonBrightnessDown, if you want it represents to F1. Set fnmode=2 parameters to hid_apple module. See Kernel modules#Setting module options for more information.\n\n"
    },
    {
      "title": "Touchpad",
      "level": 3,
      "content": "Two finger scrolling and left-click works out of the box. Unfortunately the right-click is not functional.\n\nThere are two drivers to provide features to the touchpad (including right and middle click): mtrack which is reported to work well and Synaptics which provides more features but might require some tuning.\n\nmtrack:\n\nMtrack is available in xf86-input-mtrackAUR. The configuration is done via the /etc/X11/xorg.conf.d/10-mtrack.conf file. Check if the mtrack module is properly loaded in the /var/log/Xorg.0.log file. Sometimes xorg loads other drivers before, like eg. synpatics, and the mtrack driver is not used at all.\n\nFor an MBP 8,3 I needed to use the following config (in /etc/X11/xorg.conf.d/10-mtrack.conf) to stop it picking up other input devices by mistake:\n\n```\nSection \"InputClass\"\n  Identifier \"Multitouch Touchpad\"\n  Driver \"mtrack\"\n  MatchDevicePath \"/dev/input/event*\"\n  MatchProduct \"bcm5974\"\n  MatchIsTouchpad \"true\"\nEndSection\n```\n\nsynaptics:\n\nSee Touchpad Synaptics#Installation for synaptics installation and configuration instructions.\n\n```\n#list all possible configurable parameters.\n synclient\n \n #To change a value for a command use `synclient command=X`\n #Example:\n synclient HorizTwoFingerScroll=1\n```\n\nAfter you have successfully tried and tested your options through synclient, you can make these changes permanent by adding them to /etc/X11/xorg.conf.d/50-synaptics.conf\n\n"
    },
    {
      "title": "Video and screen",
      "level": 2,
      "content": "13-inch\n\nIntel HD Graphics 3000: works with xf86-video-intel.\n\nAdjust Brightness: works with xorg-xbacklight.\n\nFor example:\n\n```\n$ xbacklight -inc 7 # increase brightness\n$ xbacklight -dec 7 # decrease brightness\n```\n\nor you can use a simple bash script that provides screen and keyboard backlight management by simple cli (-d for display / -k for keyboard)\n\n```\n#!/bin/bash\ncase $1 in\n       -d|--display)\n           if [ \"$2\" != \"0\" ]\n               then\n                   echo \"$[(($2 * 4882) / 100) % 4883]\" > /sys/class/backlight/intel_backlight/brightness\n           fi;;\n       -k|--keyboard)\n           echo \"$[(($2 * 255) / 100) % 256]\" > /sys/class/leds/smc\\:\\:kbd_backlight/brightness;;\n       -h|--help)\n           echo -e \"MacBook 8.1 brightness helper\\n\\t-d\\tset display brightness (0-100%)\\n\\t-k\\tset keyboard brightness (0-100%)\\n\";;\n       *)\n           echo -e \"Unknown option try -h or --help\";;\nesac\n```\n\nSave it in /usr/local/bin/macbackl and mark it as executable.\n\nFor usage, run:\n\n```\n$ macbackl --help\n```\n\n15-inch and 17-inch\n\nAMD Radeon HD 6490M: Unknown.\n\nAMD Radeon HD 6750M and 6770M: works with xf86-video-ati.\n\n"
    },
    {
      "title": "Sound",
      "level": 2,
      "content": "8,3\n\nSome applications (e.g. VLC) have intermittent crackling; appending 'tsched=0' to 'module-udev-detect' in /etc/pulse/default.pa fixes this.\n\n"
    },
    {
      "title": "Suspend and hibernate",
      "level": 2,
      "content": "8,1\n\nFor s2ram install uswsusp-gitAUR and add to file /etc/pm/config.d/module following content:\n\n```\nSUSPEND_MODULES=\"bcma b43\" \n SLEEP_MODULE=uswsusp\n```\n\nWithout this, system hangs after the machine wakes up and tries to reconnect to the wireless network.\n\n"
    },
    {
      "title": "HFS+",
      "level": 2,
      "content": "HFS is mounted as Read-Only. By turning journaling off in OS X, the HFS+ file system will be read/write under Linux.\n\n"
    },
    {
      "title": "Bluetooth",
      "level": 2,
      "content": "I had problems pairing devices, nothing was detected with\n\n```\nhcitool scan\n```\n\nThere seems to be a conflict between the bluetooth module and the b43 one (wifi). The solution is creating /etc/modprobe.d/b43.conf with the following content:\n\n```\noptions b43 btcoex=0\n```\n\n"
    },
    {
      "title": "Broken integrated GPU",
      "level": 3,
      "content": "The 8.2 macbook pro models with integrated graphics card have a manufacturing issue that causes the lead-free solder of the GPU to crack, inhibiting its ability to function. The problem begins by seeing red lines on the monitor and then failing to boot OS X. Apple issued a repair program, but the odds are that your GPU will die again soon.\n\nIt is still possible to boot linux using the outb 0x750 lines in grub2 as described above, however this is a nuisance because it may be impossible to read the monitor when the problem is severe, making installation impossible. In addition, you may also wish to use another boot loader other than GRUB.\n\nIt is possible to fix the problem by forcing the EFI to use the integrated graphics card.\n\nIf you want to force the EFI to use the integrated graphics card, then check the following topic: force 2011 macbook to use integrated card. You may need to append radeon.modeset=0 to your kernel command line so that linux does not attempt to use it:\n\n```\nradeon.modeset=0\n```\n\n"
    },
    {
      "title": "Grub2-EFI boot: Intel invalid ROM contents",
      "level": 3,
      "content": "If you see this error on boot and notice the screen output seemingly frozen, you need to disable KMS.\n\nYou have two options, use grub to disable the discrete GPU or disable the discrete GPU in the EFI.\n\n' use grub '\n\nAppend the following to your /etc/grub/defaults LINUX line:\n\n```\ni915.modeset=0 radeon.modeset=0\n```\n\nHowever, newer versions of the Xorg Intel/i915 driver require KMS to work; without it the X server will fallback to framebuffer mode, with poor performance. The underlying issue is that the Intel KMS driver selects the wrong video output; to fix this try the following settings (tested on an 8,3/17\" MBP):\n\n```\nradeon.modeset=0 i915.modeset=1 i915.lvds_channel_mode=2\n```\n\nThis should give you Intel graphics output. Note that this requires kernel 3.5rc1 or higher; use linux-mainline from Aur if necessary. See this bug for more details.\n\nYou may find you need to enable the Intel device; if using Grub, the following should enable it at boot time:\n\n```\nset gfxpayload=keep\n# Switch gmux to IGD\noutb 0x728 1\noutb 0x710 2\noutb 0x740 2\n```\n\nAlternatively, if you have OS X available you can use gfxCardStatus to switch to the Intel device before booting into Linux.\n\n' Force EFI to use integrated '\n\nIf you want to force the EFI to use the integrated graphics card, then check the following topic: force 2011 macbook to use integrated card. You may need to append radeon.modeset=0 to your kernel command line so that linux does not attempt to use it:\n\n```\nradeon.modeset=0\n```\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Debian Wiki: Adjusting a Linux installation for Macbook 8,2 to only use an integrated graphics card (2023)\n\n"
    }
  ]
}