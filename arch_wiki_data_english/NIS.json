{
  "title": "NIS",
  "url": "https://wiki.archlinux.org/title/NIS",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Note: **This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.** This article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nThis article or section needs language, wiki syntax or style improvements. See Help:Style for reference.\n\nNetwork Information Service (NIS) is a protocol developed by Sun to allow one to defer user authentication to a server. The server software is in the ypservAUR package, and the client software is in the yp-toolsAUR package. ypbind-mtAUR is also available, which is a multi threaded version of the client daemon.\n\n"
    },
    {
      "title": "Install Packages",
      "level": 3,
      "content": "Install the ypbind-mtAUR, ypservAUR, and yp-toolsAUR packages.\n\n"
    },
    {
      "title": "/etc/hosts",
      "level": 4,
      "content": "Add your server's external (not 127.0.0.1) IP address to the hosts file. Make sure it is the first non-commented line in the file, yes, even above the localhost line, like so:\n\n```\n/etc/hosts\n```\n\n```\n#<ip-address>\t<hostname.domain.org>\t<hostname>\n#::1\t\tlocalhost.localdomain\tlocalhost\n192.168.1.10   nis_server.domain.com   nis_server\n127.0.0.1\tlocalhost.localdomain\tlocalhost nis_server\n# End of file\n```\n\nThis is due to a peculiarity in ypinit (maybe it is a bug, maybe it is a feature), which will always add the first line in /etc/hosts to the list of ypservers.\n\n"
    },
    {
      "title": "/etc/nisdomainname",
      "level": 4,
      "content": "Add the domain name:\n\n```\n/etc/nisdomainname\n```\n\n```\n# NISDOMAINNAME=\"nis-domain-name\"\n```\n\n"
    },
    {
      "title": "/etc/ypserv.conf",
      "level": 4,
      "content": "Add rules to /etc/ypserv.conf for your your nis clients of this form:\n\n```\n/etc/ypserv.conf\n```\n\n```\n# ip-address-of-client : nis-domain-name : rule : security\n```\n\nFor example:\n\n```\n/etc/ypserv.conf\n```\n\n```\n# 192.168. : home-domain : * : port\n```\n\nFor more information see man ypserv.conf.\n\n"
    },
    {
      "title": "/var/yp/Makefile",
      "level": 4,
      "content": "Add or remove files you would like NIS to use to /var/yp/Makefile under the \"all\" rule.\n\nDefault:\n\n```\n# all:  passwd group hosts rpc services netid protocols netgrp \\\n#         shadow # publickey networks ethers bootparams printcap mail \\\n#         # amd.home auto.master auto.home auto.local passwd.adjunct \\\n#         # timezone locale netmasks\n```\n\nAfter that you have to build your NIS database:\n\n```\n# cd /var/yp\n# make\n```\n\nOr you can do it in a more automated fashion:\n\n```\n# /usr/lib/yp/ypinit -m\n```\n\nIf you use this way you may skip manually adding lines to /var/yp/ypservers.\n\n"
    },
    {
      "title": "/var/yp/securenets",
      "level": 4,
      "content": "Add rules to /var/yp/securenets to restrict access:\n\n```\n/var/yp/securenets\n```\n\n```\n# 255.255.0.0 192.168.0.0 # Gives access to anyone in 192.168.0.0/16\n```\n\nBe sure to comment out this line, as it gives access to anyone.\n\n```\n/var/yp/securenets\n```\n\n```\n# 0.0.0.0      0.0.0.0\n```\n\n"
    },
    {
      "title": "/var/yp/ypservers",
      "level": 4,
      "content": "Add your server to /var/yp/ypservers:\n\n```\n/var/yp/ypservers\n```\n\n```\n# your.nis.server\n```\n\n"
    },
    {
      "title": "Set your domain name",
      "level": 4,
      "content": "```\n# ypdomainname EXAMPLE.COM\n```\n\nNow edit the /etc/yp.conf file and add your ypserver or nis server.\n\n```\n/etc/yp.conf\n```\n\n```\nypserver nis_server\n```\n\n"
    },
    {
      "title": "Start NIS Daemons",
      "level": 3,
      "content": "Start/enable the following systemd units:\n\n- rpcbind.service\n- ypbind.service\n- ypserv.service\n- yppasswdd.service (to allow clients to change their password with passwd)\n\n"
    },
    {
      "title": "Install Packages",
      "level": 3,
      "content": "The first step is to install the tools that you need. This provides the configuration files and general tools needed to use NIS. Install yp-toolsAUR ypbind-mtAUR.\n\n"
    },
    {
      "title": "Set your domain name",
      "level": 4,
      "content": "```\n# ypdomainname EXAMPLE.COM\n```\n\nYou can apply this permanently by editing /etc/nisdomainname and adding:\n\n```\n# NISDOMAINNAME=\"EXAMPLE.COM\"\n```\n\nNow edit the /etc/yp.conf file and add your ypserver or nis server.\n\n```\nypserver nis_server\n```\n\n"
    },
    {
      "title": "/etc/hosts",
      "level": 4,
      "content": "It may be a good idea to add your NIS server to /etc/hosts\n\n```\n192.168.1.10   nis_server.domain.com   nis_server\n```\n\n"
    },
    {
      "title": "Start NIS Daemons",
      "level": 4,
      "content": "Start/enable the rpcbind.service and ypbind.service systemd units.\n\n"
    },
    {
      "title": "Early testing",
      "level": 4,
      "content": "To test the setup so far you can run the command yptest:\n\n```\n# yptest\n```\n\nIf it works you will, among other things, see the contents of the NIS user database (which is printed in the same format as /etc/passwd).\n\n"
    },
    {
      "title": "/etc/nsswitch.conf",
      "level": 4,
      "content": "To actually use NIS to log in you have to edit /etc/nsswitch.conf. Modify the lines for passwd, group and shadow to read:\n\n```\npasswd: files nis\ngroup: files nis\nshadow: files nis\n```\n\nAnd then do not forget to restart ypbind.service.\n\n"
    },
    {
      "title": "/etc/pam.d/passwd",
      "level": 4,
      "content": "To allow a user on a client machine to change their password on the server, be sure that yppasswdd.service is started/enabled on the server.\n\nEdit /etc/pam.d/passwd on the client to add the nis parameter to password/pam_unix.so:\n\n```\npassword     required     pam_unix.so sha512 shadow nullok nis\n```\n\nSee section 7 of The Linux NIS HOWTO for further information on configuring NIS clients.\n\n"
    },
    {
      "title": "Connections after Systemd V235",
      "level": 4,
      "content": "Due to sandboxing on systemd-logind, any IP connections from and to the systemd-logind service are now denied. This will cause failures to log in, even though yptest works as expected, and can also cause accounts-daemon to crash outright. The basic problem is that the default systemd-logind.service file that ships with systemd specifies IPAddressDeny=any, and this prevents it from communicating with the NIS server at login. Moreover, since V239, that file also specifies RestrictAddressFamilies=AF_UNIX AF_NETLINK, dropping AF_INET AF_INET6 from the list.\n\nThe solution is to whitelist the address or address range of your NIS server.\n\nAnother systemd sandboxing element related to namespace management (\"ProtectHostname\") may prevent proper operation. The following snippet turns that off too.\n\nUse a drop-in unit file for systemd-logind.service, with these lines (the following allows connections from 10.0.*.*, edit as appropriate):\n\n```\n/etc/systemd/system/systemd-logind.service.d/open_network_interface.conf\n```\n\n```\n[Service]\nRestrictAddressFamilies=AF_UNIX AF_NETLINK AF_INET AF_INET6\nIPAddressAllow=10.0.0.0/16\nProtectHostname=no\n```\n\nAfter updating nis clients to systemd 245-1, the systemd-userdbd.service can be affected by a similar issue as the systemd-logind.service which can cause 25 second login delays.\n\nUse a drop-in unit file for systemd-userdbd.service containing your NIS server IP address to correct the issue.\n\n```\n/etc/systemd/system/systemd-userdbd.service.d/override.conf\n```\n\n```\n[Service]\nIPAddressAllow=n.n.n.n/32\n```\n\n(Alternately, the same drop-in file used for systemd-logind.service could be used.)\n\n"
    },
    {
      "title": "More resources",
      "level": 2,
      "content": "- The Linux NIS HOWTO,very helpful and generally applicable to Arch Linux.\n- YoLinux NIS tutorial\n- Quick HOWTO, Configuring NIS\n\n"
    }
  ]
}