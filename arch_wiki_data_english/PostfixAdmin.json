{
  "title": "PostfixAdmin",
  "url": "https://wiki.archlinux.org/title/PostfixAdmin",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "PostfixAdmin is a web interface for Postfix used to manage mailboxes, virtual domains and aliases.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "To use PostfixAdmin, you need a working web server setup. You can either choose a web server, that can serve the web application directly (such as Apache HTTP Server), or a setup in which a web server (e.g Nginx) forwards requests to an application server (e.g. UWSGI or php-fpm).\n\nNext, install the postfixadmin package.\n\n"
    },
    {
      "title": "Configuration",
      "level": 2,
      "content": "Edit the PostfixAdmin configuration file, globally change all instances of change-this-to-your.domain.tld to an appropriate value:\n\n```\n/etc/webapps/postfixadmin/config.local.php\n```\n\n```\n<?php\n$CONF['configured'] = true;\n// correspond to dovecot maildir path /home/vmail/%d/%u \n$CONF['domain_path'] = 'YES';\n$CONF['domain_in_mailbox'] = 'NO';\n$CONF['database_type'] = 'mysqli';\n$CONF['database_host'] = 'localhost';\n$CONF['database_user'] = 'postfix_user';\n$CONF['database_password'] = 'hunter2';\n$CONF['database_name'] = 'postfix_db';\n\n$CONF['default_aliases'] = array (\n    'abuse' => 'abuse@change-this-to-your.domain.tld',\n    'hostmaster' => 'hostmaster@change-this-to-your.domain.tld',\n    'postmaster' => 'postmaster@change-this-to-your.domain.tld',\n    'webmaster' => 'webmaster@change-this-to-your.domain.tld'\n);\n\n$CONF['vacation_domain'] = 'autoreply.change-this-to-your.domain.tld';\n\n$CONF['footer_text'] = 'Return to change-this-to-your.domain.tld';\n$CONF['footer_link'] = 'http://change-this-to-your.domain.tld';\n```\n\nIf installing dovecot and you changed the password scheme in dovecot (to SHA512-CRYPT for example), reflect that with Postfix\n\n```\n/etc/webapps/postfixadmin/config.local.php\n```\n\n```\n$CONF['encrypt'] = 'dovecot:SHA512-CRYPT';\n```\n\nAs of dovecot 2, dovecotpw has been deprecated. You will also want to ensure that your configuration reflects the new binary name.\n\n```\n/etc/webapps/postfixadmin/config.local.php\n```\n\n```\n$CONF['dovecotpw'] = \"/usr/sbin/doveadm pw\";\n```\n\n"
    },
    {
      "title": "Apache",
      "level": 3,
      "content": "Note: **This article or section needs expansion.** This article or section needs expansion.\n\nThis article or section needs expansion.\n\nThe apache web server can serve dynamic web applications with the help of modules, such as mod_proxy_fcgi or mod_proxy_uwsgi.\n\n"
    },
    {
      "title": "php-fpm",
      "level": 4,
      "content": "Install and configure Apache HTTP Server with php-fpm. Use a pool run as user and group postfixadmin. The socket file should be accessible by the http user and/or group.\n\nInclude the following configuration in your Apache HTTP Server configuration (i.e. /etc/httpd/conf/httpd.conf) and restart the web server:\n\n```\n/etc/httpd/conf/postfixadmin.conf\n```\n\n```\nAlias /postfixadmin \"/usr/share/webapps/postfixadmin/public\"\n<Directory \"/usr/share/webapps/postfixadmin/public\">\n    DirectoryIndex index.html index.php\n    <FilesMatch \\.php$>\n        SetHandler \"proxy:unix:/run/postfixadmin/postfixadmin.sock|fcgi://localhost/\"\n    </FilesMatch>\n    AllowOverride All\n    Options FollowSymlinks\n    Require all granted\n    SetEnv PHP_ADMIN_VALUE \"open_basedir = /tmp/:/usr/share/webapps/postfixadmin:/etc/webapps/postfixadmin/:/var/cache/postfixadmin/templates_c\"\n</Directory>\n```\n\nCreate a pool for postfixadmin and restart php-fpm.service:\n\n```\n/etc/php/php-fpm.d/postfixadmin.conf\n```\n\n```\n[postfixadmin]\nuser = postfixadmin\ngroup = postfixadmin\nlisten = /run/postfixadmin/postfixadmin.sock\nlisten.owner = root\nlisten.group = http\nlisten.mode = 0660\npm = ondemand\npm.max_children = 4\nphp_admin_value['date.timezone'] = Europe/Berlin\nphp_admin_value['session.save_path'] = /tmp\nphp_admin_value['open_basedir'] = /tmp/:/usr/share/webapps/postfixadmin/:/etc/webapps/postfixadmin/:/usr/bin/doveadm:/var/cache/postfixadmin\n```\n\nTo only allow localhost access to postfixadmin (for heightened security), add this to the previous <Directory> directive:\n\n```\nOrder Deny,Allow\n   Deny from all\n   Allow from 127.0.0.1\n```\n\n"
    },
    {
      "title": "Nginx",
      "level": 3,
      "content": "Nginx can proxy application servers such as php-fpm and uWSGI, that run a dynamic web application. The following examples describe a folder based setup over a non-default port (for simplicity).\n\n- For server entry management in nginx have a look at Nginx#Managing server entries.\n- PostfixAdmin ships a configuration for uWSGI.\n\n"
    },
    {
      "title": "php-fpm",
      "level": 4,
      "content": "Install php-fpm and php-imapAUR. Setup nginx with php-fpm and use a pool run as user and group postfixadmin. The socket file should be accessible by the http user and/or group, but needs to be located below /run/postfixadmin. This can be achieved by adding the following lines.\n\n```\n/etc/php/php-fpm.d/postfixadmin.conf\n```\n\n```\n[postfixadmin]\nuser = postfixadmin\ngroup = postfixadmin\nlisten = /run/postfixadmin/postfixadmin.sock\nlisten.owner = root\nlisten.group = http\nlisten.mode = 0660\npm = ondemand\npm.max_children = 4\nphp_admin_value['date.timezone'] = Europe/Berlin\nphp_admin_value['session.save_path'] = /tmp\nphp_admin_value['open_basedir'] = /tmp/:/usr/share/webapps/postfixadmin/:/etc/webapps/postfixadmin/:/usr/bin/doveadm:/var/cache/postfixadmin\n```\n\nYou will need to at least activate imap, pdo_mysql and mysqli extensions in /etc/php/php.ini. Make sure you also add /var/cache/postfixadmin to open_basedir in your php.ini. Restart php-fpm for all these to take effect.\n\nAdd the following configuration for nginx and restart it.\n\n```\n/etc/nginx/sites-available/postfixadmin.conf\n```\n\n```\nserver {\n      listen 8081;\n      server_name postfixadmin;\n      root /usr/share/webapps/postfixadmin/public/;\n      index index.php;\n      charset utf-8;\n     \n      access_log /var/log/nginx/postfixadmin-access.log;\n      error_log /var/log/nginx/postfixadmin-error.log;\n     \n      location / {\n        try_files $uri $uri/ index.php;\n      }\n     \n      location ~* \\.php$ {\n        fastcgi_split_path_info ^(.+\\.php)(/.+)$;\n        include fastcgi_params;\n        fastcgi_pass unix:/run/postfixadmin/postfixadmin.sock;\n        fastcgi_index index.php;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_buffer_size 16k;\n        fastcgi_buffers 4 16k;\n      }\n    }\n```\n\n"
    },
    {
      "title": "uWSGI",
      "level": 4,
      "content": "Install uwsgi-plugin-php, create a per-application socket for uWSGI (see UWSGI#Accessibility of uWSGI socket for reference) and activate the uwsgi-secure@postfixadmin.socket unit.\n\nAdd the following configuration for nginx and restart nginx.\n\n```\n/etc/nginx/sites-available/postfixadmin.conf\n```\n\n```\nserver {\n      listen 8081;\n      server_name postfixadmin;\n      root /usr/share/webapps/postfixadmin/public/;\n      index index.php;\n      charset utf-8;\n     \n      access_log /var/log/nginx/postfixadmin-access.log;\n      error_log /var/log/nginx/postfixadmin-error.log;\n     \n      location / {\n        try_files $uri $uri/ index.php;\n      }\n\n      # pass all .php or .php/path urls to uWSGI\n      location ~ ^(.+\\.php)(.*)$ {\n        include uwsgi_params;\n        uwsgi_modifier1 14;\n        uwsgi_pass unix:/run/postfixadmin/postfixadmin.sock;\n      }\n    }\n```\n\n"
    },
    {
      "title": "Setup",
      "level": 2,
      "content": "Finally, navigate to http://127.0.0.1/postfixadmin/setup.php if having used Apache or http://127.0.0.1:8081/setup.php for Nginx to finish the setup. Generate your setup password hash at the bottom of the page once it is done. Write the hash to the configuration file\n\n```\n/etc/webapps/postfixadmin/config.local.php\n```\n\n```\n$CONF['setup_password'] = 'yourhashhere';\n```\n\nNow you can create a superadmin account at http://127.0.0.1/postfixadmin/setup.php if having used Apache or http://127.0.0.1:8081/setup.php for Nginx.\n\n"
    },
    {
      "title": "Pacman hook",
      "level": 3,
      "content": "Sometimes the database needs to be upgraded after a version bump. You will see a message saying 'The PostfixAdmin database layout is outdated' on the login page in such case.\n\nYou can set up a hook that runs the needed upgrade.php script automatically via a pacman hook:\n\n```\n/etc/pacman.d/hooks/postfixadmin.hook\n```\n\n```\n[Trigger]\nOperation = Install\nOperation = Upgrade\nType = Package\nTarget = postfixadmin\n\n[Action]\nDescription = Run Postfixadmin upgrade.php to make sure database is up to date\nWhen = PostTransaction\nExec = /usr/bin/runuser -u postfixadmin -- /usr/bin/php /usr/share/webapps/postfixadmin/public/upgrade.php\n```\n\n"
    },
    {
      "title": "Configuration not found",
      "level": 3,
      "content": "If you go to yourdomain/postfixadmin/setup.php and the application states, that it is unable to find config.inc.php, add /etc/webapps/postfixadmin to the open_basedir line in /etc/php/php.ini (see PHP#Configuration for reference).\n\n"
    },
    {
      "title": "Blank page on access",
      "level": 3,
      "content": "If you get a blank page check the syntax of the configuration with php -l /etc/webapps/postfixadmin/config.inc.php.\n\n"
    }
  ]
}