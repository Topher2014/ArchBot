{
  "title": "Galera",
  "url": "https://wiki.archlinux.org/title/Galera",
  "sections": [
    {
      "title": "Introduction",
      "level": 1,
      "content": "Galera is a synchronous multi-master cluster for MySQL/InnoDB databases.\n\n"
    },
    {
      "title": "Installation",
      "level": 2,
      "content": "The two components Galera cluster comprised of are Galera plugin itself and a patched version of MySQL server which connect using wsrep API.\n\nInstall the galera package. Also you will need rsync and lsof packages for rsync method.\n\nStart/Enable the mysqld.service daemon.\n\n"
    },
    {
      "title": "Configuration",
      "level": 2,
      "content": "You need to configure the cluster.\n\nOn each node edit /etc/my.cnf.d/server.cnf and update the wsrep_cluster_address variable so it contains the list of all nodes in the cluster:\n\n```\n/etc/my.cnf.d/server.cnf\n```\n\n```\nwsrep_cluster_address=\"gcomm://192.168.1.4,192.168.1.5,192.168.1.6\"\n```\n\nChange the variables wsrep_node_address and wsrep_node_name to the IP address/hostname and name (this does not need to be unique) for each node, e.g.:\n\n```\n/etc/my.cnf.d/server.cnf\n```\n\n```\nwsrep_node_address='192.168.1.4'\nwsrep_node_name='node1'\n```\n\nThe wsrep_cluster_name variable should contain the same name for all cluster nodes:\n\n```\n/etc/my.cnf.d/server.cnf\n```\n\n```\nwsrep_cluster_name='my_galera_cluster'\n```\n\nAlso, set wsrep_sst_method to the desired state snapshot transfer method, the preferred one is rsync.\n\n```\n/etc/my.cnf.d/server.cnf\n```\n\n```\nwsrep_sst_method=rsync\n```\n\nMake sure you also set the following options:\n\n```\n/etc/my.cnf.d/server.cnf\n```\n\n```\nwsrep_on=ON\nwsrep_provider=/usr/lib/galera/libgalera_smm.so\ndefault_storage_engine=InnoDB\ninnodb_autoinc_lock_mode=2\nbinlog_format=row\n```\n\nWhen you have finished with /etc/my.cnf.d/server.cnf, bootstrap the mysqld service on the first node (ONLY on the first node):\n\n```\n# galera_new_cluster\n```\n\nThis will bootstrap the cluster. Use MySQL's command line tool to log in as root into your MySQL server:\n\n```\n$ mysql -p -u root\n```\n\nCheck the status of the cluster, this will show you wsrep-related status variables:\n\n```\nmysql> SHOW STATUS LIKE 'wsrep_%';\n```\n\n```\n| wsrep_local_state          | 4                                    |\n| wsrep_local_state_comment  | Synced                               |\n| wsrep_cert_index_size      | 0                                    |\n| wsrep_causal_reads         | 0                                    |\n| wsrep_incoming_addresses   | 192.168.1.4:3306                     |\n| wsrep_cluster_conf_id      | 1                                    |\n| wsrep_cluster_size         | 1                                    |\n| wsrep_cluster_state_uuid   | 6cd96745-2ea8-11e3-bbc8-d666651b51ef |\n| wsrep_cluster_status       | Primary                              |\n| wsrep_connected            | ON                                   |\n| wsrep_local_index          | 0                                    |\n| wsrep_provider_name        | Galera                               |\n```\n\nIf you use the xtrabackup or mysqldump SST method, you will need to create a MySQL user for sst transfers.\n\nOnce you configured the first node, you should be able to start mysqld.service.\n\n"
    },
    {
      "title": "See also",
      "level": 2,
      "content": "- Galera Wiki\n- Percona XtraDB Cluster's documentation\n- How to Bootstrap MySQL or MariaDB Galera Cluster\n- How To Recover MariaDB Galera Cluster After Partial or Full Crash[dead link 2024-10-12 â“˜]\n\n"
    }
  ]
}